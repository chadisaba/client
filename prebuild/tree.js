Ext.define("Plugins.panel.TreeMultiSelect",{extend:"Ext.AbstractPlugin",alias:"widget.plugin.treemultiselect",config:{toolbarSelector:null},showConfirmationOnSave:!0,pluginId:"treemultiselect",init:function(t){this.panel=t,this.selectedTree=this.panel.down("#selectedTreePanel"),this.availableTree=this.panel.down("#availableTreePanel"),t.inEdition=!1;var e=t.query("#editingtoolbar");1==e.length?(this.tb=e[0],this.fillToolbar()):0==e.length&&(this.tb=this.createNewToolbar(),this.fillToolbar(),t.addDocked(this.tb))},lockPanel:function(t){this.restorePanel(),t&&this.editBtnCtn.hide()},restorePanel:function(){var t=this;t.editBtnCtn.show(),t.saveBtnCtn.hide(),t.cancelBtnCtn.hide(),t.quitBtnCtn.hide(),t.chHistBtnCtn.show()},createNewToolbar:function(){var t=Ext.create("Ext.toolbar.Toolbar",{dock:"top",itemId:"editingtoolbar"});return t},fillToolbar:function(){this.createEditBtnCtn(),this.createCancelBtnCtn(),this.createSaveBtnCtn(),this.createChHistBtnCtn(),this.createQuitBtnCtn(),this.tb.add(this.editBtnCtn),this.tb.add({xtype:"tbfill"}),this.tb.add(this.saveBtnCtn),this.tb.add(this.cancelBtnCtn),this.tb.add(this.quitBtnCtn),this.tb.add(this.chHistBtnCtn)},createEditBtnCtn:function(){var t=this;this.editBtnCtn=Ext.create("Ext.container.Container",{itemId:"editBtnCtn",hidden:!0,items:[{xtype:"button",tooltip:"${Editer}",itemId:"editBtn",glyph:"xf040@FontAwesome",listeners:{click:function(e,n,i){t.enterEditMode(),t.panel.fireEvent("inEdit",t.panel)}}}]})},createCancelBtnCtn:function(){var t=this;this.cancelBtnCtn=Ext.create("Ext.container.Container",{itemId:"cancelBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"cancelBtn",glyph:"xf0e2@FontAwesome",disabled:!0,tooltip:"${Cancel}",listeners:{click:function(e,n,i){var a=Ext.create("Common.ux.window.PromptWindow",{withClose:!1});a.setTitle("${panelEdit.cancelTitle}"),a.down("#confirmMsg").setText("${panelEdit.cancelMsg}"),a.down("#description").hide(),a.down("#inputText").hide(),a.query("button")[0].setText("${yes}"),a.query("button")[1].setText("${no}"),a.callbackFunction=function(e,n){"ok"===e?(t.cancelEdit(),t.panel.fireEvent("resetEdit"),a.close()):a.close()},a.show()}}}]})},createSaveBtnCtn:function(){var t=this;this.saveBtnCtn=Ext.create("Ext.container.Container",{itemId:"saveBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"saveBtn",disabled:!0,glyph:"xf0c7@FontAwesome",tooltip:"Enregistrer les modifications",listeners:{click:function(e,n,i){if(t.showConfirmationOnSave){var a=[],s=[];Ext.each(t.selectedTree.getStore().query("added",!0).items,function(e){if(e.validate().isValid())a.push(e.data);else{var n=t.panel.store.indexOf(e);n++,s.push(n)}}),Ext.each(t.selectedTree.getStore().query("modified",!0).items,function(e){if(!e.get("added"))if(e.validate().isValid())a.push(e.data);else{var n=t.panel.store.indexOf(e);n++,s.push(n)}});var o;if(Ext.each(t.availableTree.getStore().query("added",!0).items,function(t){o=t,o.set("toDelete",!0),o.set("added",!1),a.push(o.data)}),s.length>0)Ext.MessageBox.show({title:"${saveError}",msg:"${saveErrorMsg}"+s,icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK});else{var l=Ext.create("Common.ux.window.PromptWindow",{withClose:!1,closable:!1});l.setTitle("${panelEdit.applyChTitle}"),l.down("#confirmMsg").setText("${panelEdit.applyChMsg}"),l.query("button")[0].setText("${yes}"),l.query("button")[1].setText("${no}"),l.down("#description").setText("${panelEdit.comment}"),l.callbackFunction=function(e,n){"ok"===e?(Utility.loading.start(l.query("button")[0]),t.panel.fireEvent("saveEdit",t.panel,l,a,n)):l.close()},l.show()}}else t.panel.fireEvent("saveEdit",t.panel)}}}]})},createChHistBtnCtn:function(){var t=this;this.chHistBtnCtn=Ext.create("Ext.container.Container",{itemId:"chHistBtnCtn",items:[{xtype:"button",itemId:"chHistBtn",glyph:"xf073@FontAwesome",tooltip:"${chHist}",listeners:{click:function(e,n,i){t.panel.fireEvent("chHist",t.panel)}}}]})},createQuitBtnCtn:function(){var t=this;this.quitBtnCtn=Ext.create("Ext.container.Container",{itemId:"quitBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"quitBtn",glyph:"xf08b@FontAwesome",tooltip:"${Quitter}",listeners:{click:function(e,n,i){var a=Ext.create("Common.ux.window.PromptWindow",{withClose:!1});a.setTitle("${panelEdit.quitEditionTitle}"),a.down("#confirmMsg").setText("${panelEdit.quitEditionMsg}"),a.down("#description").hide(),a.down("#inputText").hide(),a.query("button")[0].setText("${yes}"),a.query("button")[1].setText("${no}"),a.callbackFunction=function(e,n){"ok"===e?(a.close(),t.panel.fireEvent("quitEdit")):a.close()},a.show()}}}]})},enterEditMode:function(){var t=this;t.panel.inEdition=!0,t.editBtnCtn.hide(),t.cancelBtnCtn.show(),t.saveBtnCtn.show(),t.quitBtnCtn.show(),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0)},quitEditMode:function(){var t=this;t.panel.inEdition=!1,t.restorePanel()},cancelEdit:function(){var t=this;t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.editBtnCtn.hide()},checkIfModifications:function(t,e){var n=this;t.query("added",!0).items.length>0||e.query("added",!0).items.length>0||e.query("modified",!0).items.length>0?(n.saveBtnCtn.down("#saveBtn").setDisabled(!1),n.cancelBtnCtn.down("#cancelBtn").setDisabled(!1)):(n.saveBtnCtn.down("#saveBtn").setDisabled(!0),n.cancelBtnCtn.down("#cancelBtn").setDisabled(!0))}});