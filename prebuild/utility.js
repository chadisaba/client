var Connection={directApi:"http://localhost:3000/directapi"};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Dexie=t()}(this,function(){"use strict";function e(){}function t(e){return e}function n(e,n){return null==e||e===t?n:function(t){return n(e(t))}}function r(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function i(t,n){return t===e?n:function(){var e=t.apply(this,arguments);void 0!==e&&(arguments[0]=e);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=n.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?r(i,this.onsuccess):i),o&&(this.onerror=this.onerror?r(o,this.onerror):o),void 0!==a?a:e}}function o(t,n){return t===e?n:function(){t.apply(this,arguments);var e=this.onsuccess,i=this.onerror;this.onsuccess=this.onerror=null,n.apply(this,arguments),e&&(this.onsuccess=this.onsuccess?r(e,this.onsuccess):e),i&&(this.onerror=this.onerror?r(i,this.onerror):i)}}function a(t,n){return t===e?n:function(){var e=t.apply(this,arguments);l(arguments[0],e);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=n.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?r(i,this.onsuccess):i),o&&(this.onerror=this.onerror?r(o,this.onerror):o),void 0===e?void 0===a?void 0:a:l(e,a)}}function u(t,n){return t===e?n:function(){return t.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function s(t,n){return t===e?n:function(){return n.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function c(t,n){return t===e?n:function(){var e=t.apply(this,arguments);if(e&&"function"==typeof e.then){var r=this,i=arguments;return e.then(function(){return n.apply(r,i)})}return n.apply(this,arguments)}}function l(e,t){return"object"!=typeof t?e:(ie(t).forEach(function(n){e[n]=t[n]}),e)}function f(e,t){"function"==typeof t&&(t=t(Object.getPrototypeOf(e))),ie(t).forEach(function(n){d(e,n,t[n])})}function d(e,t,n,r){Object.defineProperty(e,t,l("function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function h(e){return{from:function(t){return e.prototype=Object.create(t.prototype),d(e.prototype,"constructor",e),{extend:f.bind(null,e.prototype)}}}}function v(e,t,n){return ue.call(e,t,n)}function p(e,t){return t(e)}function g(e){var t=setTimeout(e,1e3);clearTimeout(t)}function y(e){if(!e)throw new ve.Internal("Assertion failed")}function m(e){ae.setImmediate?setImmediate(e):setTimeout(e,0)}function b(e,t){try{e()}catch(e){t&&t(e)}}function w(e){var t=e&&e.stack;return t?t.indexOf(e+"")>0?t:e+". "+t:e}function _(e){if(e.stack)return e;try{var t=new Error(e.message||e);if(t.stack)return e.stack=t.stack,e;throw t}catch(t){e.stack=t.stack}return e}function S(e){return F.reject(_(e))}function x(e,t){if(e.hasOwnProperty(t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var o=x(e,t[r]);n.push(o)}return n}var a=t.indexOf(".");if(a!==-1){var u=e[t.substr(0,a)];return void 0===u?void 0:x(u,t.substr(a+1))}}function P(e,t,n){if(e&&void 0!==t&&!("isFrozen"in Object&&Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){y("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)P(e,t[r],n[r])}else{var o=t.indexOf(".");if(o!==-1){var a=t.substr(0,o),u=t.substr(o+1);if(""===u)void 0===n?delete e[a]:e[a]=n;else{var s=e[a];s||(s=e[a]={}),P(s,u,n)}}else void 0===n?delete e[t]:e[t]=n}}function D(e,t){"string"==typeof t?P(e,t,void 0):"length"in t&&[].map.call(t,function(t){P(e,t,void 0)})}function k(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function E(e){if(!e||"object"!=typeof e)return e;var t;if(oe(e)){t=[];for(var n=0,r=e.length;n<r;++n)t.push(E(e[n]))}else if(e instanceof Date)t=new Date,t.setTime(e.getTime());else{t=e.constructor?Object.create(e.constructor.prototype):{};for(var i in e)e.hasOwnProperty(i)&&(t[i]=E(e[i]))}return t}function I(e,t,n,r){n=n||{},r=r||"";for(var i in e)if(e.hasOwnProperty(i))if(t.hasOwnProperty(i)){var o=e[i],a=t[i];"object"==typeof o&&"object"==typeof a?I(o,a,n,r+i+"."):o!==a&&(n[r+i]=t[i])}else n[r+i]=void 0;for(i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(n[r+i]=t[i]);return n}function C(e,t){this.name=e,this.message=t}function O(e,t){return e+". Errors: "+t.map(function(e){return e.toString()}).filter(function(e,t,n){return n.indexOf(e)===t}).join("\n")}function A(e,t,n,r){this.name="ModifyError",this.failures=t,this.failedKeys=r,this.successCount=n,this.message=O(e,t)}function T(e,t){this.name="BulkError",this.failures=t,this.message=O(e,t)}function j(e,t){var n=e;return e instanceof C||!e.name||!pe[e.name]||(n=new pe[e.name](t||e.message,e),e.stack&&(n.stack=e.stack)),n}function B(t){function n(t,n,o){if(oe(t))return i(t);if("object"==typeof t)return r(t);n||(n=u),o||(o=e);var c={subscribers:[],fire:o,subscribe:function(e){c.subscribers.push(e),c.fire=n(c.fire,e)},unsubscribe:function(e){c.subscribers=c.subscribers.filter(function(t){return t!==e}),c.fire=c.subscribers.reduce(n,o)}};return a[t]=s[t]=c,c}function r(e){ie(e).forEach(function(t){var r=e[t];if(oe(r))n(t,e[t][0],e[t][1]);else{if("asap"!==r)throw new ve.InvalidArgument("Invalid event config");var i=n(t,null,function(){var e=arguments;i.subscribers.forEach(function(t){m(function(){t.apply(ae,e)})})});i.subscribe=function(e){i.subscribers.indexOf(e)===-1&&i.subscribers.push(e)},i.unsubscribe=function(e){var t=i.subscribers.indexOf(e);t!==-1&&i.subscribers.splice(t,1)}}})}function i(e){function t(){return!r&&void(r=!0)}var r=!1;e.forEach(function(e){n(e).subscribe(t)})}var o=arguments,a={},s=function(e,n){if(n){var r=v(arguments,1),i=a[e];return i.subscribe.apply(i,r),t}if("string"==typeof e)return a[e]};s.addEventType=n;for(var c=1,l=o.length;c<l;++c)n(o[c]);return s}function N(){var e=we;we=[];for(var t=0,n=e.length;t<n;++t){var r=e[t];r[0].apply(ae,r[1])}}function F(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],this._catched=!1;var t=this,n=!0;this._PSD=F.PSD;try{W(this,e,function(e){n?me(R,t,e):R(t,e)},function(e){return n?(me(U,t,e),!1):U(t,e)})}finally{n=!1}}function K(e,t){if(null===e._state)return void e._deferreds.push(t);var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);var r,i=be;be=!1,me=Se;try{var o=F.PSD;F.PSD=e._PSD,r=n(e._value),e._state||r&&"function"==typeof r.then&&r._state===!1||V(e),t.resolve(r)}catch(e){t.reject(e)}finally{if(F.PSD=o,i){do{for(;we.length>0;)N();var a=_e.pop();if(a)try{a()}catch(e){}}while(_e.length>0||we.length>0);me=ye,be=!0}}}function M(e){var t=be;be=!1,me=Se;try{return e()}finally{if(t){do{for(;we.length>0;)N();var n=_e.pop();if(n)try{n()}catch(e){}}while(_e.length>0||we.length>0);me=ye,be=!0}}}function V(e){e._catched=!0,e._parent&&!e._parent._catched&&V(e._parent)}function R(e,t){var n=F.PSD;F.PSD=e._PSD;try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then)return t instanceof F&&null!==t._state?(e._state=t._state,e._value=t._value,void q.call(e)):void W(e,function(e,n){t.then(e,n)},function(t){R(e,t)},function(t){U(e,t)});e._state=!0,e._value=t,q.call(e)}catch(e){U(e)}finally{F.PSD=n}}function U(e,t){var n=F.PSD;if(F.PSD=e._PSD,e._state=!1,e._value=t,q.call(e),!e._catched)try{e.onuncatched?e.onuncatched(e._value):F.on.error.fire(e._value)}catch(e){}return F.PSD=n,e._catched}function q(){for(var e=0,t=this._deferreds.length;e<t;e++)K(this,this._deferreds[e]);this._deferreds=[]}function L(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}function W(e,t,n,r){var i=!1;try{t(function(e){i||(i=!0,n(e))},function(t){return i?e._catched:(i=!0,r(t))})}catch(e){if(i)return;return r(e)}}function z(e){console.warn("Uncaught Promise: "+w(e))}function H(r,u){function g(){Xe.on("versionchange",function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '"+Xe.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+Xe.name+"'. Closing db now to resume the delete request."),Xe.close()}),Xe.on("blocked",function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+Xe.name+"') was blocked"):console.warn("Upgrade '"+Xe.name+"' blocked by other connection holding version "+e.oldVersion/10)})}function y(e){this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function w(e,t,n,r){if(0===e){ie(Ue).forEach(function(e){C(t,e,Ue[e].primKey,Ue[e].indexes)});var i=Xe._createTransaction(Qe,Le,Ue);i.idbtrans=t,i.idbtrans.onerror=J(n,["populating database"]),i.on("error").subscribe(n),F.newPSD(function(){F.PSD.trans=i;try{Xe.on("populate").fire(i)}catch(e){r.onerror=t.onerror=function(e){e.preventDefault()};try{t.abort()}catch(e){}t.db.close(),n(e)}})}else{var o=[],a=qe.filter(function(t){return t._cfg.version===e})[0];if(!a)throw new ve.Upgrade("Dexie specification of currently installed DB version is missing");Ue=Xe._dbSchema=a._cfg.dbschema;var u=!1,s=qe.filter(function(t){return t._cfg.version>e});s.forEach(function(e){var r=Ue,i=e._cfg.dbschema;je(r,t),je(i,t),Ue=Xe._dbSchema=i;var a=D(r,i);a.add.forEach(function(e){o.push(function(t,n){C(t,e[0],e[1].primKey,e[1].indexes),n()})}),a.change.forEach(function(e){if(e.recreate)throw new ve.Upgrade("Not yet support for changing primary key");o.push(function(t,n){var r=t.objectStore(e.name);e.add.forEach(function(e){K(r,e)}),e.change.forEach(function(e){r.deleteIndex(e.name),K(r,e)}),e.del.forEach(function(e){r.deleteIndex(e)}),n()})}),e._cfg.contentUpgrade&&o.push(function(t,r){u=!0;var o=Xe._createTransaction(Qe,v(t.db.objectStoreNames),i);o.idbtrans=t;var a=0;o._promise=p(o._promise,function(e){return function(t,n,i){function o(e){return function(){e.apply(this,arguments),0===--a&&r()}}return++a,e.call(this,t,function(e,t){arguments[0]=o(e),arguments[1]=o(t),n.apply(this,arguments)},i)}}),t.onerror=J(n,["running upgrader function for version",e._cfg.version]),o.on("error").subscribe(n),e._cfg.contentUpgrade(o),0===a&&r()}),u&&!Ce||o.push(function(e,t){N(i,e),t()})});var c=function(){try{o.length?o.shift()(t,c):O(Ue,t)}catch(e){r.onerror=t.onerror=function(e){e.preventDefault()};try{t.abort()}catch(e){}t.db.close(),n(e)}};c()}}function D(e,t){var n={del:[],add:[],change:[]};for(var r in e)t[r]||n.del.push(r);for(r in t){var i=e[r],o=t[r];if(i){var a={name:r,def:t[r],recreate:!1,del:[],add:[],change:[]};if(i.primKey.src!==o.primKey.src)a.recreate=!0,n.change.push(a);else{var u=i.indexes.reduce(function(e,t){return e[t.name]=t,e},{}),s=o.indexes.reduce(function(e,t){return e[t.name]=t,e},{});for(var c in u)s[c]||a.del.push(c);for(c in s){var l=u[c],f=s[c];l?l.src!==f.src&&a.change.push(f):a.add.push(f)}(a.recreate||a.del.length>0||a.add.length>0||a.change.length>0)&&n.change.push(a)}}else n.add.push([r,o])}return n}function C(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(e){K(i,e)}),i}function O(e,t){ie(e).forEach(function(n){t.db.objectStoreNames.contains(n)||C(t,n,e[n].primKey,e[n].indexes)})}function N(e,t){for(var n=0;n<t.db.objectStoreNames.length;++n){var r=t.db.objectStoreNames[n];null!==e[r]&&void 0!==e[r]||t.db.deleteObjectStore(r)}}function K(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function M(){$e.forEach(function(e){e.resume()})}function V(e,t){throw new ve.InvalidTable("Table "+t[0]+" not part of transaction. Original Scope Function Source: "+H.Promise.PSD.trans.scopeFunc.toString())}function R(r,u,s,c){this.name=r,this.schema=s,this.hook=We[r]?We[r].hook:B(null,{creating:[i,e],reading:[n,t],updating:[a,e],deleting:[o,e]}),this._tpf=u,this._collClass=c||ue}function U(e,t,n,r){R.call(this,e,t,n,r||se)}function q(e,t){var n=F.PSD;return function(r){try{r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault();var i=r.target.error;e.push(i),r.target._err&&F.usePSD(n,r.target._err.bind(null,i))}finally{t&&t()}}}function L(e){var t=F.PSD;return function(n){var r;try{r=n.target.error,n.target._err&&F.usePSD(t,n.target._err.bind(null,r))}finally{e(r)}}}function W(e,t){var n=F.PSD;return t?function(t){var r;try{r=t.target.result,t.target._suc&&F.usePSD(n,t.target._suc.bind(null,r))}finally{e&&e(r)}}:function(t){e(t.target.result)}}function z(e,t,n,r,i){return new F(function(o,a){var u=n.length,s=u-1;if(0===u)return o();if(r){var c={onsuccess:null,onerror:null},l=L(function(e){return a(j(e))}),f=W(null,!0);b(function(){for(var r=0;r<u;++r){var a=n[r];i.call(c,a[0],a[1],t);var d=e.delete(a[0]);c.onerror&&(d._err=c.onerror),c.onsuccess&&(d._suc=c.onsuccess),d.onerror=l,r===s?d.onsuccess=W(o,!0):d.onsuccess=f,c.onsuccess=null,c.onerror=null}},function(e){throw c.onerror&&c.onerror(e),e})}else for(var d=0;d<u;++d){var h=e.delete(n[d]);h.onerror=function(e){return a(j(e.target.error))},d===s&&(h.onsuccess=function(){return o()})}})}function G(e,t,n,r){function i(e,t,n,r){return o._promise(e,n,r)}var o=this;this.db=Xe,this.mode=e,this.storeNames=t,this.idbtrans=null,this.on=B(this,["complete","error"],"abort"),this._reculock=0,this._blockedFuncs=[],this._psd=null,this.active=!0,this._dbschema=n,r&&(this.parent=r),this._tpf=i,this.tables=Object.create(ze);for(var a=t.length-1;a!==-1;--a){var u=t[a],s=Xe._tableFactory(e,n[u],i);this.tables[u]=s,this[u]||(this[u]=s)}}function ae(e,t,n){this._ctx={table:e,index:":id"===t?null:t,collClass:e._collClass,or:n}}function ue(e,t){var n=null,r=null;if(t)try{n=t()}catch(e){r=_(j(e))}var i=e._ctx,o=i.table;this._ctx={table:o,index:i.index,isPrimKey:!i.index||o.schema.primKey.keyPath&&i.index===o.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueFilter:o.hook.reading.fire}}function se(){ue.apply(this,arguments)}function ce(e,t){return e._cfg.version-t._cfg.version}function le(e,t,n,r,i,o){n.forEach(function(n){var a=Xe._tableFactory(r,i[n],t);e.forEach(function(e){e[n]||(o?d(e,n,{get:function(){var e=F.PSD&&F.PSD.trans;return e&&e.db===Xe?e.tables[n]:a}},{enumerable:!0}):e[n]=a)})})}function fe(e){e.forEach(function(e){for(var t in e)e[t]instanceof R&&delete e[t]})}function de(e,n,r,i,o,a){a=a||t,e.onerror||(e.onerror=J(o)),n?e.onsuccess=Y(function(){var t=e.result;if(t){var u=function(){t.continue()};n(t,function(e){u=e},i,o)&&r(a(t.value),t,function(e){u=e}),u()}else i()},o):e.onsuccess=Y(function(){var t=e.result;if(t){var n=function(){t.continue()};r(a(t.value),t,function(e){n=e}),n()}else i()},o)}function he(e){var t=[];return e.split(",").forEach(function(e){e=e.trim();var n=e.replace("&","").replace("++","").replace("*",""),r=0!==n.indexOf("[")?n:e.substring(e.indexOf("[")+1,e.indexOf("]")).split("+");t.push(new ee(n,r||null,e.indexOf("&")!==-1,e.indexOf("*")!==-1,e.indexOf("++")!==-1,oe(r),r.indexOf(".")!==-1))}),t}function pe(e,t){return Ve.cmp(e,t)}function ge(e,t){return pe(e,t)<0?e:t}function ye(e,t){return pe(e,t)>0?e:t}function me(e,t){return Ve.cmp(e,t)}function be(e,t){return Ve.cmp(t,e)}function we(e,t){return e<t?-1:e===t?0:1}function _e(e,t){return e>t?-1:e===t?0:1}function Se(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}function Ie(){if(Xe.verno=He.version/10,Xe._dbSchema=Ue={},Le=v(He.objectStoreNames,0),0!==Le.length){var e=He.transaction(ne(Le),"readonly");Le.forEach(function(t){for(var n=e.objectStore(t),r=n.keyPath,i=r&&"string"==typeof r&&r.indexOf(".")!==-1,o=new ee(r,r||"",(!1),(!1),(!!n.autoIncrement),r&&"string"!=typeof r,i),a=[],u=0;u<n.indexNames.length;++u){var s=n.index(n.indexNames[u]);r=s.keyPath,i=r&&"string"==typeof r&&r.indexOf(".")!==-1;var c=new ee(s.name,r,(!!s.unique),(!!s.multiEntry),(!1),r&&"string"!=typeof r,i);a.push(c)}Ue[t]=new te(t,o,a,{})}),le([We],Xe._transPromiseFactory,ie(Ue),Qe,Ue)}}function je(e,t){for(var n=t.db.objectStoreNames,r=0;r<n.length;++r)for(var i=n[r],o=t.objectStore(i),a=0;a<o.indexNames.length;++a){var u=o.indexNames[a],s=o.index(u).keyPath,c="string"==typeof s?s:"["+v(s).join("+")+"]";if(e[i]){var l=e[i].idxByName[c];l&&(l.name=u)}}}function Be(e){Xe.on("blocked").fire(e),Ee.filter(function(e){return e.name===Xe.name&&e!==Xe&&!e._vcFired}).map(function(t){return t.on("versionchange").fire(e)})}var Ne=H.dependencies,Fe=l({addons:H.addons,autoOpen:!0,indexedDB:Ne.indexedDB,IDBKeyRange:Ne.IDBKeyRange},u),Ke=Fe.addons,Me=Fe.autoOpen,Ve=Fe.indexedDB,Re=Fe.IDBKeyRange,Ue=this._dbSchema={},qe=[],Le=[],We={},ze={},He=null,Ye=!0,Ge=null,Ze=!1,Je="readonly",Qe="readwrite",Xe=this,$e=[],et=!0,tt=!!re(Ve);this.version=function(e){if(He||Ze)throw new ve.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=qe.filter(function(t){return t._cfg.version===e})[0];return t?t:(t=new y(e),qe.push(t),qe.sort(ce),t)},l(y.prototype,{stores:function(e){this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,e):e;var t={};qe.forEach(function(e){l(t,e._cfg.storesSource)});var n=this._cfg.dbschema={};return this._parseStoresSpec(t,n),Ue=Xe._dbSchema=n,fe([We,Xe,ze]),le([ze],V,ie(n),Qe,n),le([We,Xe,this._cfg.tables],Xe._transPromiseFactory,ie(n),Qe,n,!0),Le=ie(n),this},upgrade:function(e){var t=this;return Ae(function(){e(Xe._createTransaction(Qe,ie(t._cfg.dbschema),t._cfg.dbschema))}),this._cfg.contentUpgrade=e,this},_parseStoresSpec:function(e,t){ie(e).forEach(function(n){if(null!==e[n]){var r={},i=he(e[n]),o=i.shift();if(o.multi)throw new ve.Schema("Primary key cannot be multi-valued");o.keyPath&&P(r,o.keyPath,o.auto?0:o.keyPath),i.forEach(function(e){if(e.auto)throw new ve.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new ve.Schema("Index must have a name and cannot be an empty string");P(r,e.keyPath,e.compound?e.keyPath.map(function(){return""}):"")}),t[n]=new te(n,o,i,r)}})}}),this._allTables=We,this._tableFactory=function(e,t,n){return e===Je?new R(t.name,n,t,ue):new U(t.name,n,t)},this._createTransaction=function(e,t,n,r){return new G(e,t,n,r)},this._transPromiseFactory=function(t,n,r){if(!Ye||F.PSD&&F.PSD.letThrough){var i=Xe._createTransaction(t,n,Ue);return i._promise(t,function(e,t){i.error(function(e){Xe.on("error").fire(e)}),F.newPSD(function(){F.PSD.trans=i,r(function(t){i.complete(function(){e(t)})},t,i)})})}if(!Ze&&!Me)return S(new ve.DatabaseClosed);var o=new F(function(e,i){$e.push({resume:function(){var a=Xe._transPromiseFactory(t,n,r);o.onuncatched=a.onuncatched,a.then(e,i)}})});return Me&&!Ze&&Xe.open().catch(e),o},this._whenReady=function(t){if(!Te&&Ye&&(!F.PSD||!F.PSD.letThrough)){if(!Ze){if(!Me)return S(new ve.DatabaseClosed);Xe.open().catch(e)}return new F(function(e,n){$e.push({resume:function(){t(e,n)}})})}return new F(t)},this.verno=0,this.open=function(){return He?F.resolve(Xe):Ze?new F(function(e,t){return Xe._whenReady(function(){e(Xe)},function(e){t(e)})}):(Ge=null,Ze=!0,Ye=!0,new F(function(e,t){function n(e){try{i.transaction.abort()}catch(e){}if(He)try{He.close()}catch(e){}He=null,Ze=!1,Ge=j(e),Ye=!1,t(Ge),M()}Te&&e();var i;try{if(qe.length>0&&(et=!1),!Ve)throw new ve.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");if(i=et?Ve.open(r):Ve.open(r,Math.round(10*Xe.verno)),!i)throw new ve.MissingAPI("IndexedDB API not available");i.onerror=J(n,["opening database",r]),i.onblocked=Be,i.onupgradeneeded=Y(function(e){if(et&&!Xe._allowEmptyDB){i.onerror=function(e){e.preventDefault()},i.transaction.abort(),i.result.close();var t=Ve.deleteDatabase(r);t.onsuccess=t.onerror=function(){n(new ve.NoSuchDatabase("Database "+r+" doesnt exist"))}}else{i.transaction.onerror=J(n);var o=e.oldVersion>Math.pow(2,62)?0:e.oldVersion;w(o/10,i.transaction,n,i)}},n),i.onsuccess=Y(function(){if(Ze=!1,He=i.result,et)Ie();else if(He.objectStoreNames.length>0)try{je(Ue,He.transaction(ne(He.objectStoreNames),Je))}catch(e){}He.onversionchange=function(e){Xe._vcFired=!0,Xe.on("versionchange").fire(e)},tt||X(function(e){if(e.indexOf(r)===-1)return e.push(r)}),F.newPSD(function(){function t(){Ye=!1,M(),e()}F.PSD.letThrough=!0;try{var r=Xe.on.ready.fire();r&&"function"==typeof r.then?r.then(t,function(e){He.close(),He=null,n(e)}):m(t)}catch(e){n(e)}})},n)}catch(e){n(e)}}).then(function(){return Ee.push(Xe),Xe}))},this.close=function(){var e=Ee.indexOf(Xe);e>=0&&Ee.splice(e,1),He?(He.close(),He=null,Me=!1,Ye&&M(),Ye=!1,Ge=new ve.DatabaseClosed):Ze&&Xe.on("ready",function(){return F.reject(new ve.DatabaseClosed)})},this.delete=function(){var e=arguments;return new F(function(t,n){function i(){Xe.close();var e=Ve.deleteDatabase(r);e.onsuccess=function(){tt||X(function(e){var t=e.indexOf(r);if(t>=0)return e.splice(t,1)}),t()},e.onerror=J(n,["deleting",r]),e.onblocked=Be}if(e.length>0)throw new ve.InvalidArgument("Arguments not allowed in db.delete()");Ze?$e.push({resume:i}):i()})},this.backendDB=function(){return He},this.isOpen=function(){return null!==He},this.hasFailed=function(){return null!==Ge},this.dynamicallyOpened=function(){return et},this.name=r,d(this,"tables",{get:function(){return ie(We).map(function(e){return We[e]})}}),this.on=B(this,"error","populate",{blocked:[s,e],ready:[c,e],versionchange:[s,e]}),this.on.ready.subscribe=p(this.on.ready.subscribe,function(e){return function(t,n){function r(){return n||Xe.on.ready.unsubscribe(r),t.apply(this,arguments)}e.call(this,r),Xe.isOpen()&&(Ye?$e.push({resume:r}):r())}}),Ae(function(){Xe.on("populate").fire(Xe._createTransaction(Qe,Le,Ue)),Xe.on("error").fire(new Error)}),this.transaction=function(e,t,n){function r(t,r){var o=null,a=!0;try{if(u)throw u;o=Xe._createTransaction(e,s,Ue,i);var c=s.map(function(e){return o.tables[e]});c.push(o);var l,f=0;F.newPSD(function(){F.PSD.trans=o,o.scopeFunc=n,i&&(o.idbtrans=i.idbtrans,o._promise=p(o._promise,function(e){return function(t,n,r){function i(e){return function(t){var n;return F._rootExec(function(){n=e(t),F._tickFinalize(function(){0===--f&&o.active&&(o.active=!1,o.on.complete.fire())})}),n}}return++f,e.call(this,t,function(e,t,r){return n(i(e),i(t),r)},r)}})),o.complete(function(){t(l)}),o.error(function(e){function t(){var t=r(e);i||t||Xe.on.error.fire(e)}o.idbtrans&&(o.idbtrans.onerror=Q);try{o.abort()}catch(e){}i&&(i.active=!1,i.on.error.fire(e)),a?m(t):t()}),F._rootExec(function(){if(l=n.apply(o,c))if("function"==typeof l.next&&"function"==typeof l.throw)l=$(l);else if("function"==typeof l.then&&!l.hasOwnProperty("_PSD"))throw new ve.IncompatiblePromise})}),(!o.idbtrans||i&&0===f)&&o._nop()}catch(e){o&&o.idbtrans&&(o.idbtrans.onerror=Q),o&&o.abort(),i&&i.on.error.fire(e),m(function(){r(e)||Xe.on("error").fire(e)})}a=!1}t=v(arguments,1,arguments.length-1),n=arguments[arguments.length-1];var i=F.PSD&&F.PSD.trans;i&&i.db===Xe&&e.indexOf("!")===-1||(i=null);var o=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");var a=oe(t[0])?t.reduce(function(e,t){return e.concat(t)}):t,u=null,s=a.map(function(e){return"string"==typeof e?e:(e instanceof R||(u=u||new TypeError("Invalid type. Arguments following mode must be instances of Table or String")),e.name)});return"r"==e||e==Je?e=Je:"rw"==e||e==Qe?e=Qe:u=new ve.InvalidArgument("Invalid transaction mode: "+e),i&&(u||(i&&i.mode===Je&&e===Qe&&(o?i=null:u=u||new ve.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")),i&&s.forEach(function(e){i.tables.hasOwnProperty(e)||(o?i=null:u=u||new ve.SubTransaction("Table "+e+" not included in parent transaction. Parent Transaction function: "+i.scopeFunc.toString()))}))),i?i._promise(e,r,"lock"):Xe._whenReady(r)},this.table=function(e){if(Te&&et)return new U(e);if(!We.hasOwnProperty(e))throw new ve.InvalidTable("Table "+e+" does not exist");return We[e]},f(R.prototype,function(){function e(){throw new ve.ReadOnly("Current Transaction is READONLY")}return{_trans:function(e,t,n){return this._tpf(e,[this.name],t,n)},_idbstore:function(e,t,n){if(Te)return new F(t);var r=this;return this._tpf(e,[this.name],function(e,n,i){t(e,n,i.idbtrans.objectStore(r.name),i)},n)},get:function(e,t){var n=this;return this._idbstore(Je,function(t,r,i){Te&&t(n.schema.instanceTemplate);var o=i.get(e);o.onerror=J(r,["getting",e,"from",n.name]),o.onsuccess=function(){t(n.hook.reading.fire(o.result))}}).then(t)},where:function(e){return new ae(this,e)},count:function(e){return this.toCollection().count(e)},offset:function(e){return this.toCollection().offset(e)},limit:function(e){return this.toCollection().limit(e)},reverse:function(){return this.toCollection().reverse()},filter:function(e){return this.toCollection().and(e)},each:function(e){return this.toCollection().each(e)},toArray:function(e){return this.toCollection().toArray(e)},orderBy:function(e){return new this._collClass(new ae(this,e))},toCollection:function(){return new this._collClass(new ae(this))},mapToClass:function(e,t){this.schema.mappedClass=e;var n=Object.create(e.prototype);t&&Z(n,t),this.schema.instanceTemplate=n;var r=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),e},defineClass:function(e){return this.mapToClass(H.defineClass(e),e)},add:e,put:e,delete:e,clear:e,update:e}}),h(U).from(R).extend(function(){return{bulkDelete:function(t){return this.hook.deleting.fire===e?this._idbstore(Qe,function(n,r,i,o){n(z(i,o,t,!1,e))}):this.where(":id").anyOf(t).delete().then(function(){})},bulkPut:function(t,n){var r=this;return this._idbstore(Qe,function(i,o,a,u){if(!a.keyPath&&!r.schema.primKey.auto&&!n)throw new ve.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(a.keyPath&&n)throw new ve.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(n&&n.length!==t.length)throw new ve.InvalidArgument("Arguments objects and keys must have the same length");if(0===t.length)return i();var s,c,l=function(e){0===f.length?i(e):o(new T(r.name+".bulkPut(): "+f.length+" of "+d+" operations failed",f))},f=[],d=t.length,h=u.tables[r.name];if(r.hook.creating.fire===e&&r.hook.updating.fire===e){c=q(f);for(var v=0,p=t.length;v<p;++v)s=n?a.put(t[v],n[v]):a.put(t[v]),s.onerror=c;s.onerror=q(f,l),s.onsuccess=W(l)}else{var g=n||a.keyPath&&t.map(function(e){return x(e,a.keyPath)}),y=g&&g.reduce(function(e,n,r){return null!=n&&(e[n]=t[r]),e},{}),m=g?h.where(":id").anyOf(g.filter(function(e){return null!=e})).modify(function(){this.value=y[this.primKey],y[this.primKey]=null}).catch(A,function(e){f=e.failures}).then(function(){for(var e=[],r=n&&[],i=g.length-1;i>=0;--i){var o=g[i];(null==o||y[o])&&(e.push(t[i]),n&&r.push(o),null!=o&&(y[o]=null))}return e.reverse(),n&&r.reverse(),h.bulkAdd(e,r)}).then(function(e){var t=g[g.length-1];return null!=t?t:e}):h.bulkAdd(t);m.then(l).catch(T,function(e){f=f.concat(e.failures),l()}).catch(o)}},"locked")},bulkAdd:function(t,n){var r=this,i=this.hook.creating.fire;return this._idbstore(Qe,function(o,a,u,s){function c(e){0===h.length?o(e):a(new T(r.name+".bulkAdd(): "+h.length+" of "+v+" operations failed",h))}if(!u.keyPath&&!r.schema.primKey.auto&&!n)throw new ve.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(u.keyPath&&n)throw new ve.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(n&&n.length!==t.length)throw new ve.InvalidArgument("Arguments objects and keys must have the same length");if(0===t.length)return o();var l,f,d,h=[],v=t.length;if(i!==e){var p=u.keyPath,g={onerror:null,onsuccess:null};f=q(h,null),d=W(null,!0),b(function(){for(var e=0,r=t.length;e<r;++e){var o=n&&n[e],a=t[e],c=n?o:p?x(a,p):void 0,h=i.call(g,c,a,s);null==c&&null!=h&&(p?(a=E(a),P(a,p,h)):o=h),l=null!=o?u.add(a,o):u.add(a),g.onerror&&(l._err=g.onerror),g.onsuccess&&(l._suc=g.onsuccess),e<r-1&&(l.onerror=f,g.onsuccess&&(l.onsuccess=d),g.onerror=null,g.onsuccess=null)}},function(e){throw g.onerror&&g.onerror(e),e}),l.onerror=q(h,c),l.onsuccess=W(c,!0)}else{f=q(h);for(var y=0,m=t.length;y<m;++y)l=n?u.add(t[y],n[y]):u.add(t[y]),l.onerror=f;l.onerror=q(h,c),l.onsuccess=W(c)}})},add:function(t,n){var r=this,i=this.hook.creating.fire;return this._idbstore(Qe,function(o,a,u,s){var c={onsuccess:null,onerror:null};if(i!==e){var l=null!=n?n:u.keyPath?x(t,u.keyPath):void 0,f=i.call(c,l,t,s);null==l&&null!=f&&(u.keyPath?P(t,u.keyPath,f):n=f)}try{var d=null!=n?u.add(t,n):u.add(t),h=F.PSD;d.onerror=J(function(e){return c.onerror&&F.usePSD(h,c.onerror.bind(c,e)),a(e)},["adding",t,"into",r.name]),d.onsuccess=function(e){var n=u.keyPath;n&&P(t,n,e.target.result),c.onsuccess&&F.usePSD(h,c.onsuccess.bind(c,e.target.result)),o(d.result)}}catch(e){throw c.onerror&&c.onerror(e),e}})},put:function(t,n){var r=this,i=this.hook.creating.fire,o=this.hook.updating.fire;return i!==e||o!==e?this._trans(Qe,function(e,i,o){var a=void 0!==n?n:r.schema.primKey.keyPath&&x(t,r.schema.primKey.keyPath);null==a?o.tables[r.name].add(t).then(e,i):(o._lock(),t=E(t),o.tables[r.name].where(":id").equals(a).modify(function(){this.value=t}).then(function(e){return 0===e?o.tables[r.name].add(t,n):a}).finally(function(){o._unlock()}).then(e,i))}):this._idbstore(Qe,function(e,i,o){var a=void 0!==n?o.put(t,n):o.put(t);a.onerror=J(i,["putting",t,"into",r.name]),a.onsuccess=function(n){var r=o.keyPath;r&&P(t,r,n.target.result),e(a.result)}})},delete:function(e){return this.hook.deleting.subscribers.length?this.where(":id").equals(e).delete():this._idbstore(Qe,function(t,n,r){var i=r.delete(e);i.onerror=J(n,["deleting",e,"from",r.name]),i.onsuccess=function(){t(i.result)}})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(Qe,function(e,t,n){var r=n.clear();r.onerror=J(t,["clearing",n.name]),r.onsuccess=function(){e(r.result)}})},update:function(e,t){if("object"!=typeof t||oe(t))throw new ve.InvalidArgument("db.update(keyOrObject, modifications). modifications must be an object.");if("object"!=typeof e||oe(e))return this.where(":id").equals(e).modify(t);ie(t).forEach(function(n){P(e,n,t[n])});var n=x(e,this.schema.primKey.keyPath);return void 0===n&&F.reject(new ve.InvalidArgument("Given object does not contain its primary key")),this.where(":id").equals(n).modify(t)}}}),f(G.prototype,{_lock:function(){return++this._reculock,1===this._reculock&&F.PSD&&(F.PSD.lockOwnerFor=this),this},_unlock:function(){if(0===--this._reculock)for(F.PSD&&(F.PSD.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{e()}catch(e){}}return this},_locked:function(){return this._reculock&&(!F.PSD||F.PSD.lockOwnerFor!==this)},_nop:function(e){this.tables[this.storeNames[0]].get(0).then(e)},_promise:function(e,t,n){var r=this;return F.newPSD(function(){var i;return r._locked()?i=new F(function(i,o){r._blockedFuncs.push(function(){r._promise(e,t,n).then(i,o)})}):(i=r.active?new F(function(i,o){if(!r.idbtrans&&e){if(!He)throw!Ge||["DatabaseClosedError","MissingAPIError"].indexOf(Ge.name)>=0?Ge:new ve.OpenFailed(Ge);var a=r.idbtrans=He.transaction(ne(r.storeNames),r.mode);a.onerror=function(e){r.on("error").fire(e&&e.target.error),e.preventDefault(),r.abort()},a.onabort=function(e){m(function(){r.on("error").fire(new ve.Abort("Transaction aborted for unknown reason"))}),r.active=!1,r.on("abort").fire(e)},a.oncomplete=function(e){r.active=!1,r.on("complete").fire(e)}}n&&r._lock();try{t(i,o,r)}catch(e){var u=_(j(e));H.ignoreTransaction(function(){
r.on("error").fire(u)}),r.abort(),o(u)}}):F.reject(_(new ve.TransactionInactive("Transaction is inactive. Original Scope Function Source: "+r.scopeFunc.toString()))),r.active&&n&&i.finally(function(){r._unlock()})),i.onuncatched=function(e){H.ignoreTransaction(function(){r.on("error").fire(e)}),r.abort()},i})},complete:function(e){return this.on("complete",e)},error:function(e){return this.on("error",e)},abort:function(){if(this.idbtrans&&this.active)try{this.active=!1,this.idbtrans.abort(),this.on.error.fire(new ve.Abort("Transaction Aborted"))}catch(e){}},table:function(e){if(!this.tables.hasOwnProperty(e))throw new ve.InvalidTable("Table "+e+" not in transaction");return this.tables[e]}}),f(ae.prototype,function(){function e(e,t,n){var r=e instanceof ae?new e._ctx.collClass(e):e;try{throw n?new n(t):new TypeError(t)}catch(e){r._ctx.error=e}return r}function t(e){return new e._ctx.collClass(e,function(){return Re.only("")}).limit(0)}function n(e){return v(1===e.length&&oe(e[0])?e[0]:e)}function r(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function i(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function o(e,t,n,r,i,o){for(var a=Math.min(e.length,r.length),u=-1,s=0;s<a;++s){var c=t[s];if(c!==r[s])return i(e[s],n[s])<0?e.substr(0,s)+n[s]+n.substr(s+1):i(e[s],r[s])<0?e.substr(0,s)+r[s]+n.substr(s+1):u>=0?e.substr(0,u)+t[u]+n.substr(u+1):null;i(e[s],c)<0&&(u=s)}return a<r.length&&"next"===o?e+n.substr(e.length):a<e.length&&"prev"===o?e.substr(0,n.length):u<0?null:e.substr(0,u)+r[u]+n.substr(u+1)}function a(e,t,n,a){function u(e){s=r(e),c=i(e),l="next"===e?we:_e;var t=n.map(function(e){return{lower:c(e),upper:s(e)}}).sort(function(e,t){return l(e.lower,t.lower)});f=t.map(function(e){return e.upper}),d=t.map(function(e){return e.lower}),h=e,v="next"===e?"":a}var s,c,l,f,d,h,v,p=n.length;u("next");var g=new e._ctx.collClass(e,function(){return Re.bound(f[0],d[p-1]+a)});g._ondirectionchange=function(e){u(e)};var y=0;return g._addAlgorithm(function(e,n,r){var i=e.key;if("string"!=typeof i)return!1;var a=c(i);if(t(a,d,y))return!0;for(var u=null,s=y;s<p;++s){var g=o(i,a,f[s],d[s],l,h);null===g&&null===u?y=s+1:(null===u||l(u,g)>0)&&(u=g)}return n(null!==u?function(){e.continue(u+v)}:r),!1}),g}return{between:function(n,r,i,o){i=i!==!1,o=o===!0;try{return pe(n,r)>0||0===pe(n,r)&&(i||o)&&(!i||!o)?t(this):new this._ctx.collClass(this,function(){return Re.bound(n,r,!i,!o)})}catch(t){return e(this,De)}},equals:function(e){return new this._ctx.collClass(this,function(){return Re.only(e)})},above:function(e){return new this._ctx.collClass(this,function(){return Re.lowerBound(e,!0)})},aboveOrEqual:function(e){return new this._ctx.collClass(this,function(){return Re.lowerBound(e)})},below:function(e){return new this._ctx.collClass(this,function(){return Re.upperBound(e,!0)})},belowOrEqual:function(e){return new this._ctx.collClass(this,function(){return Re.upperBound(e)})},startsWith:function(t){return"string"!=typeof t?e(this,ke):this.between(t,t+xe,!0,!0)},startsWithIgnoreCase:function(t){return"string"!=typeof t?e(this,ke):""===t?this.startsWith(t):a(this,function(e,t){return 0===e.indexOf(t[0])},[t],xe)},equalsIgnoreCase:function(t){return"string"!=typeof t?e(this,ke):a(this,function(e,t){return e===t[0]},[t],"")},anyOfIgnoreCase:function(){var r=n(arguments);return 0===r.length?t(this):r.every(function(e){return"string"==typeof e})?a(this,function(e,t){return t.indexOf(e)!==-1},r,""):e(this,"anyOfIgnoreCase() only works with strings")},startsWithAnyOfIgnoreCase:function(){var r=n(arguments);return 0===r.length?t(this):r.every(function(e){return"string"==typeof e})?a(this,function(e,t){return t.some(function(t){return 0===e.indexOf(t)})},r,xe):e(this,"startsWithAnyOfIgnoreCase() only works with strings")},anyOf:function(){var r=n(arguments),i=me;try{r.sort(i)}catch(t){return e(this,De)}if(0===r.length)return t(this);var o=new this._ctx.collClass(this,function(){return Re.bound(r[0],r[r.length-1])});o._ondirectionchange=function(e){i="next"===e?me:be,r.sort(i)};var a=0;return o._addAlgorithm(function(e,t,n){for(var o=e.key;i(o,r[a])>0;)if(++a,a===r.length)return t(n),!1;return 0===i(o,r[a])||(t(function(){e.continue(r[a])}),!1)}),o},notEqual:function(e){return this.inAnyRange([[-(1/0),e],[e,Pe]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var t=n(arguments);if(0===t.length)return new this._ctx.collClass(this);try{t.sort(me)}catch(t){return e(this,De)}var r=t.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[-(1/0),t]]},null);return r.push([t[t.length-1],Pe]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(n,r){function i(e,t){for(var n=0,r=e.length;n<r;++n){var i=e[n];if(pe(t[0],i[1])<0&&pe(t[1],i[0])>0){i[0]=ge(i[0],t[0]),i[1]=ye(i[1],t[1]);break}}return n===r&&e.push(t),e}function o(e,t){return f(e[0],t[0])}function a(e){return!h(e)&&!v(e)}var u=this._ctx;if(0===n.length)return t(this);if(!n.every(function(e){return void 0!==e[0]&&void 0!==e[1]&&me(e[0],e[1])<=0}))return e(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ve.InvalidArgument);var s,c=!r||r.includeLowers!==!1,l=r&&r.includeUppers===!0,f=me;try{s=n.reduce(i,[]),s.sort(o)}catch(t){return e(this,De)}var d=0,h=l?function(e){return me(e,s[d][1])>0}:function(e){return me(e,s[d][1])>=0},v=c?function(e){return be(e,s[d][0])>0}:function(e){return be(e,s[d][0])>=0},p=h,g=new u.collClass(this,function(){return Re.bound(s[0][0],s[s.length-1][1],!c,!l)});return g._ondirectionchange=function(e){"next"===e?(p=h,f=me):(p=v,f=be),s.sort(o)},g._addAlgorithm(function(e,t,n){for(var r=e.key;p(r);)if(++d,d===s.length)return t(n),!1;return!!a(r)||0!==pe(r,s[d][1])&&0!==pe(r,s[d][0])&&(t(function(){f===me?e.continue(s[d][0]):e.continue(s[d][1])}),!1)}),g},startsWithAnyOf:function(){var r=n(arguments);return r.every(function(e){return"string"==typeof e})?0===r.length?t(this):this.inAnyRange(r.map(function(e){return[e,e+xe]})):e(this,"startsWithAnyOf() only works with strings")}}}),f(ue.prototype,function(){function e(e,t){e.filter=Se(e.filter,t)}function t(e,t){var n=e.replayFilter;e.replayFilter=n?function(){return Se(n(),t())}:t}function n(e,t){e.isMatch=Se(e.isMatch,t)}function r(e,t){if(e.isPrimKey)return t;var n=e.table.schema.idxByName[e.index];if(!n)throw new ve.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return t.index(n.name)}function i(e,t){var n=r(e,t);return e.keysOnly&&"openKeyCursor"in n?n.openKeyCursor(e.range||null,e.dir+e.unique):n.openCursor(e.range||null,e.dir+e.unique)}function o(e,t,n,r,o){var a=e.replayFilter?Se(e.filter,e.replayFilter()):e.filter;e.or?!function(){function u(){2===++l&&n()}function s(e,n,i){if(!a||a(n,i,u,r)){var o=n.primaryKey.toString();c.hasOwnProperty(o)||(c[o]=!0,t(e,n,i))}}var c={},l=0;e.or._iterate(s,u,r,o),de(i(e,o),e.algorithm,s,u,r,!e.keysOnly&&e.valueFilter)}():de(i(e,o),Se(e.algorithm,a),t,n,r,!e.keysOnly&&e.valueFilter)}function a(e){return e.table.schema.instanceTemplate}return{_read:function(e,t){var n=this._ctx;return n.error?n.table._trans(null,function(e,t){t(n.error)}):n.table._idbstore(Je,e).then(t)},_write:function(e){var t=this._ctx;return t.error?t.table._trans(null,function(e,n){n(t.error)}):t.table._idbstore(Qe,e,"locked")},_addAlgorithm:function(e){var t=this._ctx;t.algorithm=Se(t.algorithm,e)},_iterate:function(e,t,n,r){return o(this._ctx,e,t,n,r)},clone:function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&l(n,e),t._ctx=n,t},raw:function(){return this._ctx.valueFilter=null,this},each:function(e){var t=this._ctx;return Te&&e(a(t)),this._read(function(n,r,i){o(t,e,n,r,i)})},count:function(e){if(Te)return F.resolve(0).then(e);var t=this,n=this._ctx;if(n.filter||n.algorithm||n.or||n.replayFilter){var i=0;return this._read(function(e,t,r){o(n,function(){return++i,!1},function(){e(i)},t,r)},e)}return this._read(function(e,i,o){var a=r(n,o),u=n.range?a.count(n.range):a.count();u.onerror=J(i,["calling","count()","on",t.name]),u.onsuccess=function(t){e(t.target.result)}},e)},sortBy:function(e,t){function n(e,t){return t?n(e[i[t]],t-1):e[o]}function r(e,t){var r=n(e,a),i=n(t,a);return r<i?-u:r>i?u:0}var i=e.split(".").reverse(),o=i[0],a=i.length-1,u="next"===this._ctx.dir?1:-1;return this.toArray(function(e){return e.sort(r)}).then(t)},toArray:function(e){var t=this._ctx;return this._read(function(e,n,r){Te&&e([a(t)]);var i=[];o(t,function(e){i.push(e)},function(){e(i)},n,r)},e)},offset:function(e){var n=this._ctx;return e<=0?this:(n.offset+=e,n.or||n.algorithm||n.filter||n.replayFilter?t(n,function(){var t=e;return function(){return--t<0}}):t(n,function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n(function(){e.advance(t),t=0}),!1))}}),this)},limit:function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),t(this._ctx,function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),this},until:function(t,n){var r=this._ctx;return Te&&t(a(r)),e(this._ctx,function(e,r,i){return!t(e.value)||(r(i),n)}),this},first:function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},last:function(e){return this.reverse().first(e)},filter:function(t){return Te&&t(a(this._ctx)),e(this._ctx,function(e){return t(e.value)}),n(this._ctx,t),this},and:function(e){return this.filter(e)},or:function(e){return new ae(this._ctx.table,e,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(e){var t=this._ctx;return Te&&e(x(a(this._ctx),this._ctx.index?this._ctx.table.schema.idxByName[this._ctx.index].keyPath:this._ctx.table.schema.primKey.keyPath)),t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.key,n)})},eachUniqueKey:function(e){return this._ctx.unique="unique",this.eachKey(e)},keys:function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return Te?new F(this.eachKey.bind(this)).then(function(e){return[e]}).then(e):this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)},uniqueKeys:function(e){return this._ctx.unique="unique",this.keys(e)},firstKey:function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},lastKey:function(e){return this.reverse().firstKey(e)},distinct:function(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return e(this._ctx,function(e){var t=e.primaryKey.toString(),n=r.hasOwnProperty(t);return r[t]=!0,!n}),this}}}),h(se).from(ue).extend({modify:function(t){var n=this,r=this._ctx,i=r.table.hook,o=i.updating.fire,a=i.deleting.fire;return Te&&"function"==typeof t&&t.call({value:r.table.schema.instanceTemplate},r.table.schema.instanceTemplate),this._write(function(i,u,s,c){function f(e,t){function n(e){return S.push(e),D.push(i.primKey),i.onerror&&F.newPSD(function(){F.PSD.trans=c,i.onerror(e)}),h(),!0}C=t.primaryKey;var i={primKey:t.primaryKey,value:e,onsuccess:null,onerror:null};if(v.call(i,e,i)!==!1){var o=!i.hasOwnProperty("value");++m,b(function(){var a=o?t.delete():t.update(i.value);a.onerror=J(n,o?["deleting",e,"from",r.table.name]:["modifying",e,"on",r.table.name]),a.onsuccess=function(){i.onsuccess&&F.newPSD(function(){F.PSD.trans=c,i.onsuccess(i.value)}),++w,h()}},n)}else i.onsuccess&&i.onsuccess(i.value)}function d(e){return e&&(S.push(e),D.push(C)),u(new A("Error modifying one or more objects",S,w,D))}function h(){_&&w+S.length===m&&(S.length>0?d():i(w))}var v;if("function"==typeof t)v=o===e&&a===e?t:function(e){var n=E(e);if(t.call(this,e,this)===!1)return!1;if(this.hasOwnProperty("value")){var r=I(n,this.value),i=o.call(this,r,this.primKey,n,c);i&&(e=this.value,ie(i).forEach(function(t){P(e,t,i[t])}))}else a.call(this,this.primKey,e,c)};else if(o===e){var p=ie(t),g=p.length;v=function(e){for(var n=!1,r=0;r<g;++r){var i=p[r],o=t[i];x(e,i)!==o&&(P(e,i,o),n=!0)}return n}}else{var y=t;t=k(y),v=function(e){var n=!1,r=o.call(this,t,this.primKey,E(e),c);return r&&l(t,r),ie(t).forEach(function(r){var i=t[r];x(e,r)!==i&&(P(e,r,i),n=!0)}),r&&(t=k(y)),n}}var m=0,w=0,_=!1,S=[],D=[],C=null;n.clone().raw()._iterate(f,function(){_=!0,h()},d,s)})},delete:function(){var t=this,n=this._ctx,r=n.range,i=n.table.hook.deleting.fire,o=i!==e;if(!o&&!n.or&&!n.algorithm&&!n.filter&&!n.replayFilter&&(n.isPrimKey&&!Oe||!r))return this._write(function(e,t,i){var o=J(t,["deleting range from",n.table.name]),a=r?i.count(r):i.count();a.onerror=o,a.onsuccess=function(){var n=a.result;b(function(){var t=r?i.delete(r):i.clear();t.onerror=o,t.onsuccess=function(){return e(n)}},function(e){return t(j(e))})}});var a=o?2e3:1e4;return this._write(function(e,r,u,s){var c=0,l=Object.create(n.table);l._tpf=s._tpf;var f=t.clone({table:l,keysOnly:!n.isMatch&&!o}).distinct().limit(a).raw(),d=[],h=function(){return f.each(o?function(e,t){d.push([t.primaryKey,t.value])}:function(e,t){d.push(t.primaryKey)}).then(function(){return o?d.sort(function(e,t){return me(e[0],t[0])}):d.sort(me),z(u,s,d,o,i)}).then(function(){var e=d.length;return c+=e,d=[],e<a?c:h()})};e(h())})}}),l(this,{Collection:ue,Table:R,Transaction:G,Version:y,WhereClause:ae,WriteableCollection:se,WriteableTable:U}),g(),Ke.forEach(function(e){e(Xe)})}function Y(e,t){var n=F.PSD;return function(){var r=F.PSD;F.PSD=n;try{e.apply(this,arguments)}catch(e){t(e)}finally{F.PSD=r}}}function G(e){if("function"==typeof e)return new e;if(oe(e))return[G(e[0])];if(e&&"object"==typeof e){var t={};return Z(t,e),t}return e}function Z(e,t){return ie(t).forEach(function(n){var r=G(t[n]);e[n]=r}),e}function J(e,t){return function(n){var r=n&&n.target.error||new Error("");if(t){var i=" occurred when "+t.map(function(e){switch(typeof e){case"function":return e();case"string":return e;default:return JSON.stringify(e)}}).join(" ");r.message&&r.message!=r.name&&(i+=". "+r.message),r.name?r=j(r,r.name+i):r+=i}return e(r),n&&(n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()),!1}}function Q(e){e.preventDefault()}function X(e){var t,n=H.dependencies.localStorage;if(!n)return e([]);try{t=JSON.parse(n.getItem("Dexie.DatabaseNames")||"[]")}catch(e){t=[]}e(t)&&n.setItem("Dexie.DatabaseNames",JSON.stringify(t))}function $(e){function t(e){return function(t){var r=e(t),i=r.value;return r.done?i:i&&"function"==typeof i.then?i.then(o,a):Array.isArray(i)?n(i,0):o(i)}}function n(e,t){if(t===e.length)return o(e);var r=e[t];return r.constructor&&"function"==typeof r.constructor.all?r.constructor.all(e).then(o,a):n(e,t+1)}var r=function(t){return e.next(t)},i=function(t){return e.throw(t)},o=t(r),a=t(i);return t(r)()}function ee(e,t,n,r,i,o,a){this.name=e,this.keyPath=t,this.unique=n,this.multi=r,this.auto=i,this.compound=o,this.dotted=a;var u="string"==typeof t?t:t&&"["+[].join.call(t,"+")+"]";this.src=(n?"&":"")+(r?"*":"")+(i?"++":"")+u}function te(e,t,n,r){this.name=e,this.primKey=t||new ee,this.indexes=n||[new ee],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=n.reduce(function(e,t){return e[t.name]=t,e},{})}function ne(e){return 1===e.length?e[0]:e}function re(e){var t=e&&(e.getDatabaseNames||e.webkitGetDatabaseNames);return t&&t.bind(e)}var ie=Object.keys,oe=Array.isArray,ae="undefined"!=typeof self?self:"undefined"!=typeof window?window:global,ue=[].slice,se=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","IncompatiblePromise"],ce=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],le=se.concat(ce),fe={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",IncompatiblePromise:"Incompatible Promise used in transaction scope. See http://tinyurl.com/znyqjqc"};h(C).from(Error).extend({dump:function(){return w(this)}}),h(A).from(C),h(T).from(C);var de=le.reduce(function(e,t){return e[t]=t+"Error",e},{}),he=C,ve=le.reduce(function(e,t){function n(e,n){this.name=r,"string"==typeof e?(this.message=e,this.inner=n||null):"object"==typeof e?(this.message=e.name+" "+e.message,this.inner=e):(this.message=fe[t],this.inner=null)}var r=t+"Error";return h(n).from(he),e[t]=n,e},{});ve.Syntax=SyntaxError,ve.Type=TypeError,ve.Range=RangeError;var pe=ce.reduce(function(e,t){return e[t+"Error"]=ve[t],e},{}),ge=le.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=ve[t]),e},{});ge.ModifyError=A,ge.DexieError=C,ge.BulkError=T;var ye=ae.setImmediate||function(e){var t=v(arguments,1);setTimeout(function(){e.apply(ae,t)},0)};g(function(){ye=me=Se=function(e){var t=arguments;setTimeout(function(){e.apply(ae,v(t,1))},0)}});var me=ye,be=!0,we=[],_e=[],Se=function(e){we.push([e,v(arguments,1)])};F.all=function(){var e=v(1===arguments.length&&oe(arguments[0])?arguments[0]:arguments);return new F(function(t,n){function r(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,function(e){r(o,e)},n)}e[o]=a,0===--i&&t(e)}catch(e){n(e)}}if(0===e.length)return t([]);for(var i=e.length,o=0;o<e.length;o++)r(o,e[o])})},F.prototype.then=function(e,t){var n=this,r=new F(function(r,i){null===n._state?K(n,new L(e,t,r,i)):me(K,n,new L(e,t,r,i))});return r._PSD=this._PSD,r.onuncatched=this.onuncatched,r._parent=this,r},F.prototype._then=function(t,n){K(this,new L(t,n,e,e))},F.prototype.catch=function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,function(e){return e instanceof t?n(e):F.reject(e)}):this.then(null,function(e){return e&&e.name===t?n(e):F.reject(e)})},F.prototype.finally=function(e){return this.then(function(t){return e(),t},function(t){return e(),F.reject(t)})},F.prototype.onuncatched=null,F.resolve=function(e){if(e&&"function"==typeof e.then)return e;var t=new F(function(){});return t._state=!0,t._value=e,t},F.reject=function(e){var t=new F(function(){});return t._state=!1,t._value=e,t},F.race=function(e){return new F(function(t,n){e.map(function(e){e.then(t,n)})})},F.PSD=null,F.newPSD=function(e){var t=F.PSD;F.PSD=t?Object.create(t):{};try{return e()}finally{F.PSD=t}},F.usePSD=function(e,t){var n=F.PSD;F.PSD=e;try{return t()}finally{F.PSD=n}},F._rootExec=M,F._tickFinalize=function(e){if(be)throw new Error("Not in a virtual tick");_e.push(e)},F.on=B(null,{error:[function(e,t){return t},z]});var xe=String.fromCharCode(65535),Pe=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(e){return xe}}(),De="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ke="String expected.",Ee=[],Ie="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ce=Ie,Oe=Ie,Ae=function(){},Te=!1;H.delete=function(e){var t=new H(e),n=t.delete();return n.onblocked=function(e){return t.on("blocked",e),this},n},H.exists=function(e){return new H(e).open().then(function(e){return e.close(),!0}).catch(H.NoSuchDatabaseError,function(){return!1})},H.getDatabaseNames=function(e){return new F(function(e,t){var n=re(indexedDB);if(n){var r=n();r.onsuccess=function(t){e(v(t.target.result,0))},r.onerror=J(t)}else X(function(t){return e(t),!1})}).then(e)},H.defineClass=function(e){function t(t){t?l(this,t):Te&&Z(this,e)}return t},H.applyStructure=Z,H.ignoreTransaction=function(e){return F.newPSD(function(){return F.PSD.trans=null,e()})},H.vip=function(e){return F.newPSD(function(){return F.PSD.letThrough=!0,e()})},H.async=function(e){return function(){try{var t=$(e.apply(this,arguments));return t&&"function"==typeof t.then?t:H.Promise.resolve(t)}catch(e){return H.Promise.reject(e)}}},H.spawn=function(e,t,n){try{var r=$(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:H.Promise.resolve(r)}catch(e){return H.Promise.reject(e)}},d(H,"currentTransaction",{get:function(){return F.PSD&&F.PSD.trans||null}}),H.Promise=F,H.derive=h,H.extend=l,H.extendProto=f,H.override=p,H.Events=H.events=B,H.getByKeyPath=x,H.setByKeyPath=P,H.delByKeyPath=D,H.shallowClone=k,H.deepClone=E,H.addons=[],H.fakeAutoComplete=Ae,H.asap=m,H.maxKey=Pe,H.connections=Ee,H.dump=w,l(H,ge),H.MultiModifyError=H.ModifyError,H.errnames=de,H.IndexSpec=ee,H.TableSchema=te;var je=ae.idbModules&&ae.idbModules.shimIndexedDB?ae.idbModules:{};return H.dependencies={indexedDB:je.shimIndexedDB||ae.indexedDB||ae.mozIndexedDB||ae.webkitIndexedDB||ae.msIndexedDB,IDBKeyRange:je.IDBKeyRange||ae.IDBKeyRange||ae.webkitIDBKeyRange},b(function(){H.dependencies.localStorage=null!=("undefined"!=typeof chrome&&null!==chrome?chrome.storage:void 0)?null:ae.localStorage}),H.semVer="1.3.6",H.version=H.semVer.split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)}),g(function(){H.fakeAutoComplete=Ae=g,H.fake=Te=!0}),H.default=H,H}),Ext.define("Utility.form",{statics:{fillCityFromZipCode:function(e,t,n,r,i){var o=e,a=o.getViewModel(),u=a.getStore(t),s=o.getView().down("#"+n);if(u.clearFilter(),s.setValue(null),5==i.length){var c=[],l={name:"cityZipCode",value:i};c.push(l);var f={table:"CITY",filters:c},d=[];Server.CommonQueries.read(f,function(e){e.success?(d=e.data,u.loadData(d),s.select(u.getAt(0))):console.log(e.msg)},o)}}}}),Ext.define("Utility.grid",{statics:{addItem:function(e,t){var n=e,r=t,i=n.store.getAt(0);return!(Ext.isDefined(i)&&i&&i.get("added")&&!i.isValid())&&(n.store.insert(0,r),n.getView().focusNode(r),n.getPlugin("rowEdit").startEdit(r,0),this.inEditor(n),void 0)},beforeEdit:function(e,t){return Ext.each(t.grid.store.query("added",!0).items,function(e){var n=e.copy();n.isValid()||!e.get("added")||t.record.get("added")||t.grid.store.remove(e)}),!t.grid.inEdition||t.record.get("locked")||t.record.get("toDelete")?(this.outEditor(t.grid),!1):(this.inEditor(t.grid),!0)},edit:function(e,t,n){var r=t.record;if(!r.get("added")){var i=!1;n.forEach(function(e){r.isModified(e)&&(i=!0)}),i?r.set("modified",!0):r.set("modified",!1),t.grid.getPlugin("gridediting").checkIfModifications(t.grid)}},cancelEdit:function(e,t){var n=t.record.copy();if(n.set(t.newValues),n.isValid()&&t.record.get("addedAndValidated")||!t.record.get("added")){if(!n.isValid()&&!t.record.get("added"))return!1;this.outEditor(t.grid)}else t.grid.getStore().remove(t.record),t.grid.getStore().count()>0&&t.grid.getSelectionModel().select(0,!0),this.outEditor(t.grid);return!0},viewBeforeCellClick:function(e){var t=e.getPlugin("rowEdit").editor.editingPlugin;Ext.isDefined(t)&&t.editing===!0&&t.editor.form.isValid()&&(t.completeEdit(),this.outEditor(e))},gridContainerClick:function(e){var t=e.getPlugin("rowEdit").editor.editingPlugin;Ext.isDefined(t)&&t.editing===!0&&t.editor.form.isValid()&&(t.completeEdit(),this.outEditor(e))},gridCellkeydown:function(t,n,r){13==e.getKey()&&n.inEdition&&t.get("added")&&t.isValid()&&this.addItem(n,r)},modifyItem:function(e){e.getSelectionModel().hasSelection()&&e.plugins[0].startEdit(e.getSelectionModel().getSelection()[0],0)},deleteItem:function(e){for(var t=e.getSelectionModel().getSelection(),n=0;n<t.length;n++)t[n].get("locked")||t[n].get("added")||t[n].get("modified")?t[n].get("added")?e.getStore().remove(t[n]):t[n].get("modified")&&(t[n].set("toDelete",!0),t[n].set("modified",!1),t[n].get("notValid")&&t[n].set("notValid",!1)):(t[n].set("toDelete",!0),t[n].get("notValid")&&t[n].set("notValid",!1));e.getPlugin("gridediting").checkIfModifications()},duplicateItem:function(e,t){var n=e.getSelectionModel().getSelection(),r=[];n.forEach(function(e){if(!e.get("toDelete")){var n=e.copy(null);n.set("added",!0),n.set("modified",!1),n.set(t,"default"),r.push(n)}});var i=e.getStore();i.add(r)},resetEdit:function(e,t,n,r){this.loadGrid(e,t,n,r.query("button")[0],r,!0)},quitEdit:function(e,t,n,r){this.loadGrid(e,t,n,r.query("button")[0],r),e.getPlugin("gridediting").quitEditMode()},saveEdit:function(e,t,n,r){this.loadGrid(e,t,n,r.query("button")[0],r),e.getPlugin("gridediting").quitEditMode()},inEditor:function(e){e.getPlugin("gridediting").fillInInterfaceOn()},outEditor:function(e){e.getPlugin("gridediting").fillInInterfaceOff()},loadGrid:function(e,t,n,r,i,o){n.removeAll(),n.loadData(t),t.length>0&&e.getSelectionModel().select(0,!0),Ext.isEmpty(r)||Utility.loading.end(r),Ext.isEmpty(i)||i.close(),Ext.isEmpty(o)&&e.getPlugin("gridediting").lockGrid(!1)},validateedit:function(e,t,n){var r=t.record.copy();r.set(t.newValues);r.getValidation();return!(!r.isValid()||!e.editor.form.isValid())&&(!!n&&(t.record.set("addedAndValidated",!0),this.outEditor(t.grid),!0))},addInfoCol:function(e){e.columns.push({xtype:"gridcolumn",renderer:function(e,t,n,r,i,o,a){return void 0!==a&&null!==a?n.get("added")?'<div class="fa fa-plus" style="height:16px !important;">&nbsp;</div>':n.get("modified")?'<div class="fa fa-edit" style="height:16px !important;">&nbsp;</div>':"":""},itemId:"actionColumn",maxWidth:28,minWidth:28,width:28,menuDisabled:!0,draggable:!1,enableColumnHide:!1,hideable:!1})},fillCityFromZipCode:function(e,t,n,r,i){var o=e,a=o.getViewModel(),u=a.getStore(t),s=r.up("roweditor").down("#"+n);if(s.setValue(null),5==i.length){var c=[],l={name:"cityZipCode",value:i};c.push(l);var f={id:50,table:"CITY",filters:c};s.setDisabled(!1);var d=[];Server.CommonQueries.read(f,function(e){e.success?(d=e.data,u.loadData(d),s.select(u.getAt(0))):console.log(e.msg)},o)}else s.setDisabled(!0)}}});var IndexedDB={db:null,openDB:function(){var e=this,t=new Promise(function(t,n){e.db?t():(e.db=new Dexie("smartMedDB"),e.db.version(1).stores({STATUS:"++id,lastUpdate",DOC_HAS_STUDY:"++id,docHasStudyId,studyId,studyCode,studyName,doctorId",USER:"++id,userId,userFName,userLName,userCatId",CITY:"++id,cityId,cityName,cityZipCode",DEVICE:"++id,deviceId,deviceName,modalityId,siteId",STUDY:"++id,studyId,studyCode,studyName",DOCTOR:"++id,doctorId,userFName,userLName",ROOM_HAS_DEVICE:"++id,roomHasDeviceId,deviceId,deviceName,siteId",ROOM:"++id,roomId,roomCode,roomName,siteId",REFERRING_PHYSICIAN:"++id,referringPhysicianId,referringPhysicianFName,referringPhysicianLName,referringPhysicianTitle",DEVICE_HAS_STUDY:"++id,deviceHasStudyId,deviceId,studyId,siteId,deviceCode,deviceName",SITE:"++id,siteId,siteCode,siteName"}),e.db.open(),t())});return t},populateData:function(e,t){var n=this.db,r=n[e];return n.transaction("rw",r,function(){return r.clear().then(function(){return r.bulkAdd(t)})}).catch(function(e){console.error("Error: "+e)})}};Ext.define("Utility.loading",{statics:{start:function(e){e.setLoading(!0)},end:function(e){e.setLoading(!1)}}}),Ext.define("Utility.renderer",{statics:{checkBoxRenderer:function(e){return e?'<span><img src="../Common/resources/images/green_checkbox.png"/><span>':'<span><img src="../Common/resources/images/green_checkbox_empty.png"/><span>'},imageBtnRenderer:function(e){return'<button  class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab"><img src="../Common/resources/images/'+e+'.png"/> </button>'},imgRenderer:function(e){return'<span><img src="../Common/resources/images/"+imgName+".png"/><span>'},retreiveTextFromStore:function(e,t,n,r,i){if(e){var o=i.getViewModel().getStore(r),a=o.findRecord(t,e);return a.get(n)}},retreiveValueFieldByTextFromStore:function(e,t,n,r,i){if(e){var o=i.getViewModel().getStore(r),a=o.findRecord(n,e);return a.get(t)}},listRenderer:function(e,t,n){var r,i;e?(r=e.replace(/\|/g,"</li><li>"),r="<ul><li>"+r+"</li></ul>",i="#31b0d5"):(i="#d1d1d1",r=n||"");var o='<button  class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab"><i class="'+t+'" style="color:'+i+';font-size:14px;"></i> </button>';return{renderer:o,tooltip:r}},positiveNegativeRenderer:function(e,t){var n="#d43f3a",r="a href='#'";return e>=0&&(n="#27b6af"),"<"+r+' onclick="return;" style="color:'+n+';font-size:13px;">'+Math.abs(e)+"</"+r+">"},hrefRenderer:function(e,t){return'<a href="#" onclick="return;" style="color:'+e+';font-size:17px;"><i class="'+t+'"></i></a>'},textHrefRenderer:function(e,t){return'<a href="#" onclick="return;" style="color:'+e+';font-size:13px;">'+t+"</a>"},btnRenderer:function(e,t){return'<button  class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab"><i class="'+t+'" style="color:'+e+';font-size:14px;"></i> </button>'},htmlTagRenderer:function(e,t,n){return"<"+e+' style="cursor:help;color:'+t+';font-size:17px;"><i class="'+n+'"></i></'+e+">"},textHtmlTagRenderer:function(e,t,n){var r=e||"div";return"<"+r+' style="cursor:help;color:'+t+';font-size:13px;">'+n+"</i></"+r+">"}}}),Ext.define("Utility.routes",{statics:{lastView:null,setCurrentView:function(e,t,n){e=(e||"").toLowerCase();var r,i=this,o=t.getLayout(),a=n.getStore(),u=a.findNode("routeId",e)||a.findNode("viewType",e),s=u&&u.get("viewType")||"page404",c=i.lastView,l=t.child("component[routeId="+e+"]");c&&c.isWindow&&c.destroy(),c=o.getActiveItem(),l||(r=Ext.create({xtype:s,routeId:e,hideMode:"offsets"})),r&&r.isWindow||(l?(l!==c&&o.setActiveItem(l),r=l):(Ext.suspendLayouts(),o.setActiveItem(t.add(r)),Ext.resumeLayouts(!0))),n.setSelection(u),r.isFocusable(!0)&&r.focus(),i.lastView=r}}}),Ext.define("Utility.ServerStateProvider",{extend:"Ext.state.Provider",requires:["Ext.state.Provider"],alias:"serverStateProvider",config:{userId:null,stateRestoredCallback:null},constructor:function(e){if(!e.userId)throw"ServerStateProvider: Missing userId";this.initConfig(e);var t=this;t.restoreState(),t.callParent(arguments)},set:function(e,t){var n=this;return"undefined"==typeof t||null===t?void n.clear(e):(n.saveStateForKey(e,t),void n.callParent(arguments))},restoreState:function(){var e=this,t=e.getStateRestoredCallback(),n={};n.userId="10",n.filters=[],n.filters.push({name:"statefulUserId",value:"10"}),Server.StatefulProvider.restorState(n,function(n){if(n.success){var r=n.data;for(var i in r)r.hasOwnProperty(i)&&(e.state[i]=e.decodeValue(r[i]));t&&t()}else console.log("ServerStateProvider: restoreState failed",arguments),t&&t()},e)},clear:function(e){var t=this;t.clearStateForKey(e),t.callParent(arguments)},saveStateForKey:function(e,t){var n=this,r={};r.userId="10",r.key=e,r.value=n.encodeValue(t),Server.StatefulProvider.saveState(r,function(e){e.success||(console.log("ServerStateProvider: saveStateForKey failed",arguments),callback&&callback())},n)},clearStateForKey:function(e){var t=this,n={};n.userId="10",n.key=e,Server.StatefulProvider.deleteState(n,function(e){e.success||(console.log("ServerStateProvider: clearStateForKey failed",arguments),callback&&callback())},t)}});var StateProvider={restoreState:function(e){var t=new Promise(function(t,n){var r={};r.userId=e,r.filters=[],r.filters.push({name:"statefulUserId",value:e});var i=Ext.state.Manager.getProvider();Server.StatefulProvider.restorState(r,function(e){if(e.success){var r=e.data;for(var o in r)r.hasOwnProperty(o)&&(i.state[o]=i.decodeValue(r[o]),window.localStorage.setItem("ext-"+o,r[o]));t(!0)}else n("StateProvider: restoreState failed"),console.error("StateProvider: restoreState failed")})});return t},saveState:function(e){var t=new Promise(function(t,n){var r,i=[],o=Ext.state.Manager.getProvider(),a=o.readLocalStorage();for(var u in a)a.hasOwnProperty(u)&&(r={},r.statefulKey=u,r.statefulValue=o.encodeValue(a[u]),r.statefulUserId=e,i.push(r));Server.StatefulProvider.saveState(i,function(e){e.success?t(!0):n("ServerStateProvider: saveStateForKey failed")})});return t}},stringUtil={formatFName:function(e){var t=e.split(" "),n="";return t.forEach(function(e){e=e.toLowerCase(),n+=e.charAt(0).toUpperCase()+e.substr(1)+" "}),n.trim()},isUUID4:function(e){var t=e.split("-");return 5==t.length&&8==t[0].length&&12==t[4].length}};Ext.define("Utility.tree",{statics:{select:function(e,t){var n,r,i=t;i.isLeaf()?(n=e.getSelectionModel().getSelection(),r=i.parentNode,n.forEach(function(t){r.get("id")==t.get("id")&&e.getSelectionModel().deselect(i);
},this)):(i.eachChild(function(t){e.getSelectionModel().deselect(t)}),e.down("#filterField").setValue(""))},edit:function(e,t,n){var r=t.record;if(!r.get("added")){var i=!1;n.forEach(function(e){r.isModified(e)&&(i=!0)}),i?r.set("modified",!0):r.set("modified",!1)}},filter:function(e,t){e.clearFilter(),Ext.isEmpty(t)?e.clearFilter():e.filterBy(function(e){return!e.isLeaf()||(!(e.get("name")!==t||!e.isLeaf())||void 0)})},moveNode:function(e,t,n){var r,i,o;e.isLeaf()?(i=parseInt(e.get("parentId")),r=e.copy(),Utility.tree.checkIfChange(n,r)?r.set("added",!0):r.set("added",!1),o=t.getNodeById(i),o.appendChild(r),o.expand(),e.remove()):(e.eachChild(function(e){i=parseInt(e.get("parentId")),r=e.copy(),Utility.tree.checkIfChange(n,r)?r.set("added",!0):r.set("added",!1),o=t.getNodeById(i),o.appendChild(r),o.expand()}),e.removeAll())},move:function(e,t,n){var r,e=e,i=e.getStore(),t=t;t.getStore();t.getSelectionModel().hasSelection()&&(r=t.getSelectionModel().getSelection(),r.forEach(function(e){Utility.tree.moveNode(e,i,n)}))},moveAll:function(e,t,n){var r=t.getStore().getNodeById("root"),i=e.getStore();r.eachChild(function(e){e.isLeaf()||Utility.tree.moveNode(e,i,n)})},loadTree:function(e,t,n){var r={text:"Root",expanded:!0,children:[]};e.setRootNode(r),t.forEach(function(t){e.getNodeById("root").appendChild(t)},this);var i=Ext.clone(n);i.forEach(function(t){e.getNodeById(t.parentId).appendChild(t)},this)},checkIfChange:function(e,t){var n=!0;return e.forEach(function(e){e.id===t.get("id")&&(n=!1)},this),n},inEdit:function(e){e.down("#availableBtn").setDisabled(!1),e.down("#allAvailableBtn").setDisabled(!1),e.down("#selectedBtn").setDisabled(!1),e.down("#allSelectedBtn").setDisabled(!1)},quitEdit:function(e){e.down("#availableBtn").setDisabled(!0),e.down("#allAvailableBtn").setDisabled(!0),e.down("#selectedBtn").setDisabled(!0),e.down("#allSelectedBtn").setDisabled(!0)},onSelectSelectedTreePanelEvent:function(e,t){e.inEdition&&(e.down("#availableBtn").setDisabled(!0),e.down("#allAvailableBtn").setDisabled(!0),e.down("#selectedBtn").setDisabled(!1),e.down("#allSelectedBtn").setDisabled(!1),t.getSelectionModel().deselectAll())},onSelectAvailableTreeEvent:function(e,t){e.inEdition&&(e.down("#availableBtn").setDisabled(!1),e.down("#allAvailableBtn").setDisabled(!1),e.down("#selectedBtn").setDisabled(!0),e.down("#allSelectedBtn").setDisabled(!0),t.getSelectionModel().deselectAll())}}}),function(e){for(var t=[],n=0;n<=15;n++)t[n]=n.toString(16);var r=function(){for(var e="",n=1;n<=36;n++)e+=9===n||14===n||19===n||24===n?"-":15===n?4:20===n?t[4*Math.random()|8]:t[15*Math.random()|0];return e};"undefined"!=typeof exports?module.exports=r:e.UUID=r}(this);