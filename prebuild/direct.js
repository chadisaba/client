var CityDirect={},CommonDirect={saveData:function(e,r,t){var n=new Promise(function(n,a){var i={};i.table=r,i.dataToBeSaved=e,i.comment=t||null,Server.CommonQueries.saveRecord(i,function(e){e.success?n(e.data):(console.error(e.msg),a(e.msg))})});return n},saveDataArray:function(e,r,t,n){var a=new Promise(function(a,i){var o={};o.table=r,o.dataToBeSaved=e,o.idName=t,o.comment=n||null,Server.CommonQueries.saveRecords(o,function(e){e.success?a(e.data):(console.error(e.msg),i(e.msg))})});return a},searchDataFromIndexedDB:function(e,r,t){var n=new Promise(function(n,a){IndexedDB.openDB().then(function(){IndexedDB.db[t].where(r).startsWithIgnoreCase(e).toArray(function(e){n(e)})})});return n},searchDataWithTwoCriteriaFromIndexedDB:function(e,r,t,n){var a=new Promise(function(a,i){IndexedDB.openDB().then(function(){IndexedDB.db[t].where(r).startsWithIgnoreCase(e).or(n).startsWithIgnoreCase(e).toArray(function(e){a(e)})})});return a},gethDataFromIndexedDB:function(e){var r=new Promise(function(r,t){IndexedDB.openDB().then(function(){IndexedDB.db[e].toArray(function(e){r(e)})})});return r},getAssociatedAndAvailable:function(e){var r=new Promise(function(r,t){Server.CommonQueries.getAssociatedAndAvailable(e,function(e){e.success?r(e.data):t(e.msg)})});return r},getDataById:function(e,r,t){var n=new Promise(function(n,a){var i;i={table:t,filters:[{name:e,value:r}]},Server.CommonQueries.read(i,function(e){e.success?n(e.data):(console.error(e.msg),a(e.msg))})});return n},getData:function(e,r,t){var n=new Promise(function(n,a){var i;i={table:e,limit:t||100},r&&(i.filters=r),Server.CommonQueries.read(i,function(e){e.success?n(e.data):(console.error(e.msg),a(e.msg))})});return n},getDataWidthJoin:function(e,r){var t=new Promise(function(t,n){var a={mainTableObject:e,joinTablesArray:r};Server.CommonQueries.readJoin(a,function(e){e.success?t(e.data):(console.error(e.msg),n(e.msg))})});return t},autoComplete:function(e,r,t,n,a,i,o,s,c){var d=e,u=s||4;if(!t||!isNaN(t)||stringUtil.isUUID4(t))return t;if(t.length>=u){var m=d.getViewModel().getStore(a);if(o){var f;f=c?this.searchDataWithTwoCriteriaFromIndexedDB(t,n,r,c):this.searchDataFromIndexedDB(t,n,r),f.then(function(e){m.clearFilter(),m.removeAll(),e.length>0?(m.loadData(e),m.filterBy(function(e){var r=!1;return e.get(n).toUpperCase().indexOf(t.toUpperCase())>=0&&(r=!0),c&&e.get(c).toUpperCase().indexOf(t.toUpperCase())>=0&&(r=!0),r}),i.expand()):i.setValue("")})}else{var l=[{name:n,value:t}];this.getData(r,l).then(function(e){m.clearFilter(),m.removeAll(),e.length>0?(m.loadData(e),m.filter({property:n,anyMatch:!0,value:t}),i.expand()):i.setValue("")})}}}},DeviceDirect={getDeviceBySiteAndStudy:function(e,r,t){var n=new Promise(function(n,a){t?(e||a("getDeviceBySiteAndStudyFromIndexedDB : the _studyId is required"),r||a("getDeviceBySiteAndStudyFromIndexedDB : the _siteId is required"),IndexedDB.openDB().then(function(){IndexedDB.db.DEVICE_HAS_STUDY.where("siteId").equals(r).and(function(r){return r.studyId==e}).toArray(function(e){n(e)})})):(console.error("getDeviceBySiteAndStudy : not implmented fonction"),a())});return n}},DoctorDirect;DoctorDirect={};var PatientDirect={savePatient:function(e){var r=new Promise(function(r,t){var n={};n.table="PATIENT",e.patientLName&&(e.patientSearch=e.patientLName.toUpperCase()+" "+stringUtil.formatFName(e.patientFname)),n.dataToBeSaved=e,Server.CommonQueries.saveRecord(n,function(e){e.success?r(e.data):(console.error(e.msg),t(e.msg))})});return r},getPatientAndCityAndReferringPhy:function(e){var r=new Promise(function(r,t){var n={};n.tableName="PATIENT",n.filters=[{name:"patientId",value:e}];var a=[];a.push({tableName:"city",required:!1,fields:["cityName"]},{tableName:"referring_physician",required:!1,fields:["referringPhysicianLName","referringPhysicianFName"]});var i={mainTableObject:n,joinTablesArray:a};Server.CommonQueries.readJoin(i,function(e){if(e.success)if(e.data.length>0){if(e.data[0].cityId){var n=[];n.push({cityId:e.data[0].cityId,cityName:e.data[0]["City.cityName"]})}if(e.data[0].referringPhysicianId){var a=[];a.push({referringPhysicianId:e.data[0].referringPhysicianId,referringPhysicianLName:e.data[0]["ReferringPhysician.referringPhysicianLName"],referringPhysicianFName:e.data[0]["ReferringPhysician.referringPhysicianFName"]})}r({cityData:n,referringPhysicianData:a,record:e.data[0]})}else console.error("PatientForm : the patientId is mandatory"),t("PatientForm : the patientId is mandatory");else console.error(e.msg),t(e.msg)})});return r}},ReferringPhysicianDirect={},SiteDirect={saveSite:function(e){var r=new Promise(function(r,t){var n={};n.table="VISIT",n.dataToBeSaved=e,Server.CommonQueries.saveRecord(n,function(e){e.success?r(e.data):(console.error(e.msg),t(e.msg))})});return r},getSite:function(e){var r=new Promise(function(r,t){var n;n={table:"SITE",filters:[{name:"siteId",value:e}]},Server.CommonQueries.read(n,function(e){e.success?r(e.data):(console.error(e.msg),t(e.msg))})});return r},getSites:function(){var e=new Promise(function(e,r){var t;t={table:"SITE"},Server.CommonQueries.read(t,function(t){t.success?e(t.data):(console.error(t.msg),r(t.msg))})});return e}},StudyDirect={searchDocHasStudyFromIndexedDB:function(e,r){var t=new Promise(function(t,n){r||n("getStudyByNameFromIndexedDB : the doctorId is required"),IndexedDB.openDB().then(function(){IndexedDB.db.DOC_HAS_STUDY.where("studyName").startsWithIgnoreCase(e).or("studyCode").startsWithIgnoreCase(e).and(function(e){return e.doctorId==r}).toArray(function(e){t(e)})})});return t},searchStudyFromIndexedDB:function(e){var r=new Promise(function(r,t){IndexedDB.openDB().then(function(){IndexedDB.db.STUDY.where("studyName").startsWithIgnoreCase(e).or("studyCode").startsWithIgnoreCase(e).toArray(function(e){r(e)})})});return r},docHasstudyAutoComplete:function(e,r,t,n,a,i,o){var s=e,c=i||4;if(r&&isNaN(r)&&!stringUtil.isUUID4(r)&&n.getRawValue().indexOf(":")<0&&r.length>=c){var d=s.getViewModel().getStore(t);a&&this.searchDocHasStudyFromIndexedDB(r,o).then(function(e){d.clearFilter(),d.removeAll(),d.loadData(e),d.filterBy(function(e){var t=!1;return e.get("studyCode").toUpperCase().indexOf(r.toUpperCase())>=0&&(t=!0),e.get("studyName").toUpperCase().indexOf(r.toUpperCase())>=0&&(t=!0),t}),n.expand()})}}},UserDirect={getUserByCat:function(e,r){if(r){var t=new Promise(function(r,t){IndexedDB.openDB().then(function(){IndexedDB.db.USER.where("userCatId").equals(e).toArray(function(e){r(e)})})});return t}var t=new Promise(function(r,t){CommonDirect.getData("USER",[{name:"userCatId",value:e}]).then(function(e){r(e)})});return t}},VisitDirect={saveVisit:function(e){var r=new Promise(function(r,t){var n={};n.table="VISIT",n.dataToBeSaved=e,Server.CommonQueries.saveRecord(n,function(e){e.success?r(e.data):(console.error(e.msg),t(e.msg))})});return r},saveVisitAndStudyVisit:function(e,r,t,n){var a=new Promise(function(a,i){var o={visitObj:e,studyVisitDataToBeSaved:r,studiesArray:t,worklistDoctor:n};Server.Visit.saveVisitAndStudyVisit(o,function(e){e.success?a(e.data):(console.error(e.msg),i(e.msg))})});return a},getPatientAndCityAndReferringPhy:function(e){var r=new Promise(function(r,t){var n={};n.tableName="PATIENT",n.filters=[{name:"patientId",value:e}];var a=[];a.push({tableName:"city",required:!1,fields:["cityName"]},{tableName:"referring_physician",required:!1,fields:["referringPhysicianName"]});var i={mainTableObject:n,joinTablesArray:a};Server.CommonQueries.readJoin(i,function(e){if(e.success)if(e.data.length>0){if(e.data[0].cityId){var n=[];n.push({cityId:e.data[0].cityId,cityName:e.data[0]["City.cityName"]})}if(e.data[0].referringPhysicianId){var a=[];a.push({referringPhysicianId:e.data[0].referringPhysicianId,referringPhysicianSearch:e.data[0]["ReferringPhysician.referringPhysicianSearch"]})}r({cityData:n,referringPhysicianData:a,record:e.data[0]})}else console.error("PatientForm : the patientId is mandatory"),t("PatientForm : the patientId is mandatory");else console.error(e.msg),t(e.msg)})});return r}};