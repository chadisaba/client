Ext.define("Common.ux.window.ChangesHistoryWindow",{extend:"Ext.window.Window",alias:"widget.changesHistoryWindow",id:"historyWindow",height:518,width:586,layout:{type:"fit"},collapseDirection:"right",title:"${history.title}",maximizable:!0,constrain:!0,modal:!0,initComponent:function(){var t=this,e=Ext.create("Ext.data.Store",{storeId:"statusChgStore",fields:[{name:"status"},{dateFormat:"time",name:"lastUpdDate",type:"date"},{name:"userId"}]}),i=Ext.create("Ext.data.Store",{storeId:"usrActStore",fields:[{name:"status"},{name:"comments"},{dateFormat:"time",name:"lastUpdDate",type:"date"},{name:"userId"}]});Ext.applyIf(t,{items:[{xtype:"tabpanel",activeTab:0,listeners:{tabchange:function(t,e){var i,a=t.getActiveTab().items.items[0];a.store.data.length>0?Ext.isDefined(i)&&i.hide():(Ext.isDefined(i)||(i=new Ext.LoadMask({target:a.getView(),msg:"${noDataFoundMsg}",renderTpl:['<div id="{id}-msgWrapEl" data-ref="msgWrapEl" class="{[values.$comp.msgWrapCls]}">','<div id="{id}-msgEl" data-ref="msgEl" class="{[values.$comp.msgCls]} ',Ext.baseCSSPrefix,'mask-msg-inner {childElCls}">','<div id="{id}-msgTextEl" data-ref="msgTextEl">{msg}</div>',"</div>","</div>"]})),i.show())}},items:[{xtype:"panel",layout:{type:"fit"},title:"${chHist.title}",items:[{xtype:"gridpanel",itemId:"statusHistPanel",title:"",store:e,columns:[{xtype:"gridcolumn",minWidth:150,dataIndex:"status",text:"${status}"},{xtype:"gridcolumn",dataIndex:"userId",text:"${chHistTransaction.userId}"},{xtype:"datecolumn",width:120,dataIndex:"lastUpdDate",text:"${chHistTransaction.timeStamp}",format:"d/m/Y H:i"}]}]},{xtype:"panel",layout:{type:"fit"},title:"${history.userAction}",items:[{xtype:"gridpanel",itemId:"userActHistPanel",title:"",store:i,columns:[{xtype:"gridcolumn",minWidth:150,dataIndex:"status",text:"${chHistTransaction.action}"},{xtype:"gridcolumn",dataIndex:"userId",text:"${chHistTransaction.userId}"},{xtype:"gridcolumn",dataIndex:"comments",text:"${chHistTransaction.comment}"},{xtype:"datecolumn",width:120,dataIndex:"lastUpdDate",text:"${chHistTransaction.timeStamp}",format:"d/m/Y H:i"}]}]}]}]}),t.callParent(arguments)}}),Ext.define("Common.ux.window.ChHistWin",{extend:"Ext.window.Window",alias:"widget.chHistWin",id:"histWin",height:520,width:700,layout:{type:"border"},withValidation:!0,title:"${chHist.title}",maximizable:!0,constrain:!0,modal:!0,initComponent:function(){var t=this;t.loadTplDetail=function(e,i){var a=null!=e.data.actionType?e.data.actionType:"",n=t.down("#chHistTpl");n.setTitle(a),"DEL"==e.data.actionTypeCode||"INS"==e.data.actionTypeCode?n.update({twoColumns:i}):n.update({threeColumns:i})};var e=Ext.create("Ext.data.Store",{storeId:"ChgStore",fields:[{name:"actionId"},{name:"actionType"},{name:"reporter"},{name:"repId"},{name:"repUidAndFullname"},{name:"validator"},{name:"valId"},{name:"valUidAndFullname"},{name:"timestamp"},{name:"reporterCmt"},{name:"validatorCmt"},{name:"actionTypeCode"},{name:"recordId"}]}),i=[];i=t.withValidation?[{xtype:"gridcolumn",dataIndex:"actionType",width:75,minWidth:75,text:"${chHist.actionType}"},{xtype:"gridcolumn",dataIndex:"repId",width:70,minWidth:70,text:"${chHist.reporter}",renderer:function(t,e,i,a,n,o,d){return e.tdAttr='data-qtip="'+i.data.repUidAndFullname+'"',i.data.repId}},{xtype:"gridcolumn",dataIndex:"valId",width:70,minWidth:70,text:"${chHist.validator}",renderer:function(t,e,i,a,n,o,d){return e.tdAttr='data-qtip="'+i.data.valUidAndFullname+'"',i.data.valId}},{xtype:"datecolumn",width:100,minWidth:100,dataIndex:"timestamp",text:"${chHist.timestamp}",renderer:function(t,e,i,a,n,o,d){return Ext.Date.format(new Date(t),"d/m/Y H:i")},format:"d/m/Y H:i"},{xtype:"gridcolumn",dataIndex:"reporterCmt",flex:1,text:"${chHist.reporterCmt}"},{xtype:"gridcolumn",dataIndex:"validatorCmt",flex:1,text:"${chHist.validatorCmt}"}]:[{xtype:"gridcolumn",dataIndex:"actionType",width:75,minWidth:75,text:"${chHist.actionType}"},{xtype:"gridcolumn",dataIndex:"repId",width:70,minWidth:70,text:"${chHist.reporter}",renderer:function(t,e,i,a,n,o,d){return e.tdAttr='data-qtip="'+i.data.repUidAndFullname+'"',i.data.repId}},{xtype:"datecolumn",width:100,minWidth:100,dataIndex:"timestamp",text:"${chHist.timestamp}",renderer:function(t,e,i,a,n,o,d){return Ext.Date.format(new Date(t),"d/m/Y H:i")},format:"d/m/Y H:i"},{xtype:"gridcolumn",dataIndex:"reporterCmt",flex:1,text:"${chHist.reporterCmt}"}],Ext.applyIf(t,{items:[{xtype:"container",region:"center",layout:{type:"border"},items:[{xtype:"gridpanel",itemId:"histGridPanel",region:"north",flex:1,split:!0,autoScroll:!0,store:e,forceFit:!0,columns:i,selModel:Ext.create("Ext.selection.RowModel",{}),listeners:{withMask:function(e){t.loadMaskCompRef=new Ext.LoadMask({target:e.getView(),msg:"${noDataFoundMsg}",renderTpl:['<div id="{id}-msgWrapEl" data-ref="msgWrapEl" class="{[values.$comp.msgWrapCls]}">','<div id="{id}-msgEl" data-ref="msgEl" class="{[values.$comp.msgCls]} ',Ext.baseCSSPrefix,'mask-msg-inner {childElCls}">','<div id="{id}-msgTextEl" data-ref="msgTextEl">{msg}</div>',"</div>","</div>"]}),t.loadMaskCompRef.show()},noMask:function(e){Ext.isDefined(t.loadMaskCompRef)&&t.loadMaskCompRef.hide()}}},{xtype:"panel",itemId:"chHistTpl",flex:2,region:"center",tpl:Ext.create("Ext.XTemplate",'<tpl if="twoColumns!=null">',"    ",'    <table class=\'changes_table\' cellspacing="0" cellpadding="0">',"    <tr class='th_row'>","        <th>","            ${chHist.title.property}","        </th>","        <th>","            ${chHist.title.value}","        </th>        ","    <tr>",'    <tpl for="twoColumns">    ',"        <tr class=\"{[(xindex%2) === 0 ? 'odd_row' : 'even_row']}\">","            <td>","                {itemCod}","            </td>","            <td>","                {[this.getFormattedData(values.objectType, values.futureValue)]}","            </td>            ","        </tr>","    </tpl>","\t</table>","<tpl else>",'\t<table class=\'changes_table\' cellspacing="0" cellpadding="0">',"    <tr class='th_row'>","        <th>","            ${chHist.title.property}","        </th>","        <th>","            ${chHist.title.currvalue}","        </th>","        <th>","            ${chHist.title.futvalue}","        </th>","    <tr> ",'    <tpl for="threeColumns">    ',"        <tr class=\"{[(xindex%2) === 0 ? 'odd_row' : 'even_row']}\">","            <td>","                {itemCod}","            </td>","            <td>","                {[this.getFormattedData(values.objectType, values.currentValue)]}","            </td>","            <td class=\"{[values.currentValue!==values.futureValue ? 'changed_elem':'']}\">","                {[this.getFormattedData(values.objectType, values.futureValue)]}","            </td>             ","        </tr>","    </tpl>        ","\t</table>","</tpl>","    ","",{getCheckboxHTML:function(t){return"1"==t?'<img src="../../project-js/ux/images/checkbox_checked.png">':"0"==t?'<img src="../../project-js/ux/images/checkbox_unchecked.png">':void 0},formatDate:function(t){return Ext.Date.format(new Date(t),"d/m/Y")},getFormattedData:function(t,e){if("CHECKBOX"===t)return this.getCheckboxHTML(e);if("DATE"===t)return null!=e?this.formatDate(Ext.Date.parse(e,"d-m-Y")):null;if("TIME"===t)return null!=e?(e=Ext.Date.parse(e,"d-m-Y H:i:s"),this.formatTime(e)):null;if("AMOUNT"!==t)return null!==e&&"LTRIM_VARCHAR2"===t?e.replace(/^0+/,""):e;var i=e.split("#");return i.length>1?MTM.formatting.formatCurrency(i[1],i[0])+" "+i[0]:void 0},formatTime:function(t){return Ext.Date.format(new Date(t),"H:i")}}),autoScroll:!0,bodyCls:"changes_main_panel",title:"${chHist.changes.title}"}]}]}),t.callParent(arguments)},listeners:{close:function(t,e){var i=Ext.ComponentQuery.query("component[itemId=chHistBtn]");Ext.Array.each(i,function(t){t.isDisabled()&&t.setDisabled(!1)})}}}),Ext.define("Common.ux.window.FullScreenWindow",{extend:"Ext.window.Window",layout:{type:"border",padding:5},tools:[{type:"refresh",tooltip:"Refresh form Data",handler:function(t,e,i){}},{type:"help",tooltip:"Get Help",callback:function(t,e,i){}}],maximizable:!0,maximized:!0,height:500,width:500}),Ext.define("Common.ux.window.PromptWindow",{extend:"Ext.window.Window",requires:["Ext.panel.Panel","Ext.form.FieldContainer","Ext.form.Label","Ext.form.field.TextArea","Ext.toolbar.Spacer","Ext.toolbar.Toolbar","Ext.toolbar.Fill","Ext.button.Button"],commentRequired:!1,withClose:!0,hotkey:"Enter",width:400,closeAction:"hide",title:"Prompt Window title",modal:!0,layout:{type:"vbox",align:"stretch",pack:"center"},initComponent:function(){var t=this;Ext.applyIf(t,{bodyCls:["x-window-body-default","x-box-layout-ct","x-closable","x-window-body-closable","x-window-body-default-closable","promptWindow"],items:[{xtype:"panel",border:!1,layout:{type:"vbox",align:"stretch",pack:"center"},items:[{xtype:"fieldcontainer",cls:"fieldSet",margin:"0 0 0 0",padding:"10 10 10 10",layout:{type:"vbox",align:"stretch",pack:"center"},items:[{xtype:"label",flex:1,itemId:"confirmMsg",margin:"5 10 10 10",text:"Confirm action?"},{xtype:"label",itemId:"description",margin:"10 10 10 10",text:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. "},{xtype:"textareafield",stopUpperCase:!0,itemId:"inputText",margin:"0 10 10 10",fieldLabel:"",enforceMaxLength:!0,maxLength:200,selectOnFocus:!0,stripCharsRe:/[\r\n]/},{xtype:"tbspacer",flex:1}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",itemId:"bottomToolbar",items:[{xtype:"tbfill",itemId:"filler"},{xtype:"container",items:[{xtype:"button",itemId:"save",text:"Save",listeners:{click:{fn:t.onButtonClick1,scope:t}}},{xtype:"button",itemId:"cancel",text:"Cancel",listeners:{click:{fn:t.onButtonClick,scope:t}}}]}]}]}],listeners:{afterrender:{fn:t.onWindowAfterRender,scope:t}}}),t.processPromptWindow(t),t.callParent(arguments)},processPromptWindow:function(t){},onButtonClick1:function(t,e,i){var a=this.down("textfield[itemId=inputText]");(!this.commentRequired||this.commentRequired&&0!=a.getValue().trim().length)&&(this.callbackFunction("ok",a.getValue()),this.withClose&&this.close())},onButtonClick:function(t,e,i){var a=this.down("textfield[itemId=inputText]");this.callbackFunction("no",a.getValue()),this.withClose&&this.close()},onWindowAfterRender:function(t,e){t.down("#inputText").focus(!1,200)},setConfirmMsg:function(t){var e=this.down("label[itemId=confirmMsg]");e.setText(t)},setDescription:function(t){var e=this.down("label[itemId=description]");e.setText(t)},setSaveText:function(t){var e=this.down("button[itemId=save]");e.setText(t)},setCancelText:function(t){var e=this.down("button[itemId=cancel]");e.setText(t)}});