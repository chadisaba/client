Ext.define("Plugins.combobox.DropdownButtons",{});
var ComboData={categorieSite:[{siteCategory:1,siteCategoryName:"Accueil"},{siteCategory:2,siteCategoryName:"Virtuel"}],patientTitle:[{patientTitleId:1,patientTitle:translate("Mr.")},{patientTitleId:2,patientTitle:translate("Mme.")},{patientTitleId:3,patientTitle:translate("Mlle")},{patientTitleId:4,patientTitle:translate("Enfant")}],title:[{titleId:1,title:"Mr."},{titleId:2,title:translate("Mme.")},{titleId:3,title:translate("Mlle")}],gender:[{genderId:1,gender:translate("M.")},{genderId:2,gender:translate("F.")}],quotationStatus:[{id:0,text:translate("notQuoted")},{id:1,text:translate("saved")},{id:2,text:translate("disapproved")},{id:3,text:translate("approved")},{id:4,text:translate("waiting")}],crStatus:[{id:0,text:translate("noreport")},{id:1,text:translate("Reportintyping")},{id:2,text:translate("waitingforvalidation")},{id:3,text:translate("validated")},{id:4,text:translate("waintingforapprouval")},{id:5,text:translate("approved")},{id:6,text:translate("printed")}],dictationStatus:[{id:0,text:translate("notQuoted")},{id:1,text:translate("saved")},{id:2,text:translate("disapproved")},{id:3,text:translate("approved")},{id:4,text:translate("waiting")}],pec:[{id:"cmu",text:"C.M.U"},{id:"at",text:"A.T"},{id:"dep",text:"Dép"},{id:"mater",text:"Mater"},{id:"ald",text:"A.L.D"},{id:"ame",text:"A.M.E"}]},StaticData={SERVER_DOCS_PATH:"http://192.168.1.23/nodejs_extjs_project/server/docs"};
var CityDirect={},CommonDirect={saveData:function(e,r,t){var n=new Promise(function(n,a){var i={};i.table=r,i.dataToBeSaved=e,i.comment=t||null,Server.CommonQueries.saveRecord(i,function(e){e.success?n(e.data):(console.error(e.msg),a(e.msg))})});return n},saveDataArray:function(e,r,t,n){var a=new Promise(function(a,i){var o={};o.table=r,o.dataToBeSaved=e,o.idName=t,o.comment=n||null,Server.CommonQueries.saveRecords(o,function(e){e.success?a(e.data):(console.error(e.msg),i(e.msg))})});return a},searchDataFromIndexedDB:function(e,r,t){var n=new Promise(function(n,a){IndexedDB.openDB().then(function(){IndexedDB.db[t].where(r).startsWithIgnoreCase(e).toArray(function(e){n(e)})})});return n},searchDataWithTwoCriteriaFromIndexedDB:function(e,r,t,n){var a=new Promise(function(a,i){IndexedDB.openDB().then(function(){IndexedDB.db[t].where(r).startsWithIgnoreCase(e).or(n).startsWithIgnoreCase(e).toArray(function(e){a(e)})})});return a},gethDataFromIndexedDB:function(e){var r=new Promise(function(r,t){IndexedDB.openDB().then(function(){IndexedDB.db[e].toArray(function(e){r(e)})})});return r},getAssociatedAndAvailable:function(e){var r=new Promise(function(r,t){Server.CommonQueries.getAssociatedAndAvailable(e,function(e){e.success?r(e.data):t(e.msg)})});return r},getDataById:function(e,r,t){var n=new Promise(function(n,a){var i;i={table:t,filters:[{name:e,value:r}]},Server.CommonQueries.read(i,function(e){e.success?n(e.data):(console.error(e.msg),a(e.msg))})});return n},getData:function(e,r,t){var n=new Promise(function(n,a){var i;i={table:e,limit:t||100},r&&(i.filters=r),Server.CommonQueries.read(i,function(e){e.success?n(e.data):(console.error(e.msg),a(e.msg))})});return n},getDataWidthJoin:function(e,r){var t=new Promise(function(t,n){var a={mainTableObject:e,joinTablesArray:r};Server.CommonQueries.readJoin(a,function(e){e.success?t(e.data):(console.error(e.msg),n(e.msg))})});return t},autoComplete:function(e,r,t,n,a,i,o,s,c){var d=e,u=s||4;if(!t||!isNaN(t)||stringUtil.isUUID4(t))return t;if(t.length>=u){var m=d.getViewModel().getStore(a);if(o){var f;f=c?this.searchDataWithTwoCriteriaFromIndexedDB(t,n,r,c):this.searchDataFromIndexedDB(t,n,r),f.then(function(e){m.clearFilter(),m.removeAll(),e.length>0?(m.loadData(e),m.filterBy(function(e){var r=!1;return e.get(n).toUpperCase().indexOf(t.toUpperCase())>=0&&(r=!0),c&&e.get(c).toUpperCase().indexOf(t.toUpperCase())>=0&&(r=!0),r}),i.expand()):i.setValue("")})}else{var l=[{name:n,value:t}];this.getData(r,l).then(function(e){m.clearFilter(),m.removeAll(),e.length>0?(m.loadData(e),m.filter({property:n,anyMatch:!0,value:t}),i.expand()):i.setValue("")})}}}},DeviceDirect={getDeviceBySiteAndStudy:function(e,r,t){var n=new Promise(function(n,a){t?(e||a("getDeviceBySiteAndStudyFromIndexedDB : the _studyId is required"),r||a("getDeviceBySiteAndStudyFromIndexedDB : the _siteId is required"),IndexedDB.openDB().then(function(){IndexedDB.db.DEVICE_HAS_STUDY.where("siteId").equals(r).and(function(r){return r.studyId==e}).toArray(function(e){n(e)})})):(console.error("getDeviceBySiteAndStudy : not implmented fonction"),a())});return n}},DoctorDirect;DoctorDirect={};var PatientDirect={savePatient:function(e){var r=new Promise(function(r,t){var n={};n.table="PATIENT",e.patientLName&&(e.patientSearch=e.patientLName.toUpperCase()+" "+stringUtil.formatFName(e.patientFname)),n.dataToBeSaved=e,Server.CommonQueries.saveRecord(n,function(e){e.success?r(e.data):(console.error(e.msg),t(e.msg))})});return r},getPatientAndCityAndReferringPhy:function(e){var r=new Promise(function(r,t){var n={};n.tableName="PATIENT",n.filters=[{name:"patientId",value:e}];var a=[];a.push({tableName:"city",required:!1,fields:["cityName"]},{tableName:"referring_physician",required:!1,fields:["referringPhysicianLName","referringPhysicianFName"]});var i={mainTableObject:n,joinTablesArray:a};Server.CommonQueries.readJoin(i,function(e){if(e.success)if(e.data.length>0){if(e.data[0].cityId){var n=[];n.push({cityId:e.data[0].cityId,cityName:e.data[0]["City.cityName"]})}if(e.data[0].referringPhysicianId){var a=[];a.push({referringPhysicianId:e.data[0].referringPhysicianId,referringPhysicianLName:e.data[0]["ReferringPhysician.referringPhysicianLName"],referringPhysicianFName:e.data[0]["ReferringPhysician.referringPhysicianFName"]})}r({cityData:n,referringPhysicianData:a,record:e.data[0]})}else console.error("PatientForm : the patientId is mandatory"),t("PatientForm : the patientId is mandatory");else console.error(e.msg),t(e.msg)})});return r}},ReferringPhysicianDirect={},SiteDirect={saveSite:function(e){var r=new Promise(function(r,t){var n={};n.table="VISIT",n.dataToBeSaved=e,Server.CommonQueries.saveRecord(n,function(e){e.success?r(e.data):(console.error(e.msg),t(e.msg))})});return r},getSite:function(e){var r=new Promise(function(r,t){var n;n={table:"SITE",filters:[{name:"siteId",value:e}]},Server.CommonQueries.read(n,function(e){e.success?r(e.data):(console.error(e.msg),t(e.msg))})});return r},getSites:function(){var e=new Promise(function(e,r){var t;t={table:"SITE"},Server.CommonQueries.read(t,function(t){t.success?e(t.data):(console.error(t.msg),r(t.msg))})});return e}},StudyDirect={searchDocHasStudyFromIndexedDB:function(e,r){var t=new Promise(function(t,n){r||n("getStudyByNameFromIndexedDB : the doctorId is required"),IndexedDB.openDB().then(function(){IndexedDB.db.DOC_HAS_STUDY.where("studyName").startsWithIgnoreCase(e).or("studyCode").startsWithIgnoreCase(e).and(function(e){return e.doctorId==r}).toArray(function(e){t(e)})})});return t},searchStudyFromIndexedDB:function(e){var r=new Promise(function(r,t){IndexedDB.openDB().then(function(){IndexedDB.db.STUDY.where("studyName").startsWithIgnoreCase(e).or("studyCode").startsWithIgnoreCase(e).toArray(function(e){r(e)})})});return r},docHasstudyAutoComplete:function(e,r,t,n,a,i,o){var s=e,c=i||4;if(r&&isNaN(r)&&!stringUtil.isUUID4(r)&&n.getRawValue().indexOf(":")<0&&r.length>=c){var d=s.getViewModel().getStore(t);a&&this.searchDocHasStudyFromIndexedDB(r,o).then(function(e){d.clearFilter(),d.removeAll(),d.loadData(e),d.filterBy(function(e){var t=!1;return e.get("studyCode").toUpperCase().indexOf(r.toUpperCase())>=0&&(t=!0),e.get("studyName").toUpperCase().indexOf(r.toUpperCase())>=0&&(t=!0),t}),n.expand()})}}},UserDirect={getUserByCat:function(e,r){if(r){var t=new Promise(function(r,t){IndexedDB.openDB().then(function(){IndexedDB.db.USER.where("userCatId").equals(e).toArray(function(e){r(e)})})});return t}var t=new Promise(function(r,t){CommonDirect.getData("USER",[{name:"userCatId",value:e}]).then(function(e){r(e)})});return t}},VisitDirect={saveVisit:function(e){var r=new Promise(function(r,t){var n={};n.table="VISIT",n.dataToBeSaved=e,Server.CommonQueries.saveRecord(n,function(e){e.success?r(e.data):(console.error(e.msg),t(e.msg))})});return r},saveVisitAndStudyVisit:function(e,r,t,n){var a=new Promise(function(a,i){var o={visitObj:e,studyVisitDataToBeSaved:r,studiesArray:t,worklistDoctor:n};Server.Visit.saveVisitAndStudyVisit(o,function(e){e.success?a(e.data):(console.error(e.msg),i(e.msg))})});return a},getPatientAndCityAndReferringPhy:function(e){var r=new Promise(function(r,t){var n={};n.tableName="PATIENT",n.filters=[{name:"patientId",value:e}];var a=[];a.push({tableName:"city",required:!1,fields:["cityName"]},{tableName:"referring_physician",required:!1,fields:["referringPhysicianName"]});var i={mainTableObject:n,joinTablesArray:a};Server.CommonQueries.readJoin(i,function(e){if(e.success)if(e.data.length>0){if(e.data[0].cityId){var n=[];n.push({cityId:e.data[0].cityId,cityName:e.data[0]["City.cityName"]})}if(e.data[0].referringPhysicianId){var a=[];a.push({referringPhysicianId:e.data[0].referringPhysicianId,referringPhysicianSearch:e.data[0]["ReferringPhysician.referringPhysicianSearch"]})}r({cityData:n,referringPhysicianData:a,record:e.data[0]})}else console.error("PatientForm : the patientId is mandatory"),t("PatientForm : the patientId is mandatory");else console.error(e.msg),t(e.msg)})});return r}};
Ext.define("Ext.ux.filterWidget.BooleanFilter",{extend:"Ext.container.Container",xtype:"booleanfilter",layout:{type:"vbox",align:"stretch"},initComponent:function(){var e=this,t=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"text",type:"string"}],data:[{id:"all",text:translate("All")},{id:"yes",text:translate("Yes")},{id:"no",text:translate("No")}]});e.comboCompare=Ext.create("Ext.form.field.ComboBox",{width:50,fieldLabel:"",valueField:"id",displayField:"text",queryMode:"local",forceSelection:!0,store:t}),e.comboCompare.on("change",e.onChangeHandler,e),e.items=[e.comboCompare],e.callParent()},setValue:function(e){var t=this;e.value?t.comboCompare.setValue(e.value):t.comboCompare.setValue("")},onChangeHandler:function(e,t){var a=this,l=a.getWidgetRecord();t?e.setFieldStyle({color:"red"}):e.setFieldStyle({color:"black"}),l.set(a.dataIndex,{filterValue:a.comboCompare.getValue(),filterOp:"eqBool"})}}),Ext.define("Ext.ux.filterWidget.ComboFilter",{extend:"Ext.container.Container",xtype:"combofilter",layout:{type:"fit"},initComponent:function(){var e=this,t=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"text",type:"string"}],data:[{id:"eq",text:translate("=")},{id:"diff",text:translate("diff")}]});e.comboCompare=Ext.create("Ext.form.field.ComboBox",{width:50,style:"font-size:10px;",height:20,fieldLabel:"",valueField:"id",displayField:"text",value:"eq",queryMode:"local",forceSelection:!0,store:t});var a=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"text",type:"string"}]});a.loadData(e.filterValues[0]),a.insert(0,{id:0,text:"All"}),e.filterCombo=Ext.create("Ext.form.field.ComboBox",{fieldLabel:"",height:15,queryMode:"local",store:a,matchFieldWidth:!0,forceSelection:!0}),e.comboCompare.on("change",e.onChangeHandler,e),e.filterCombo.on("change",e.onChangeHandler,e),e.items=[e.comboCompare,e.filterCombo],e.callParent()},setValue:function(e){var t=this;e.op?t.comboCompare.setValue(e.op):t.comboCompare.setValue("eq"),e.value?t.filterCombo.setValue(e.value):t.filterCombo.setValue("")},onChangeHandler:function(e,t){var a=this,l=a.getWidgetRecord();t?e.setFieldStyle({color:"red"}):e.setFieldStyle({color:"black"}),l.set(a.dataIndex,{filterValue:a.filterCombo.getValue(),filterOp:a.comboCompare.getValue()})}}),Ext.define("Ext.ux.filterWidget.DateFilter",{extend:"Ext.container.Container",xtype:"datefilter",layout:{type:"fit"},initComponent:function(){var e=this,t=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"text",type:"string"}],data:[{id:"eqDate",text:translate("=")},{id:"gtDate",text:translate(">")},{id:"lteDate",text:translate("<=")},{id:"gteDate",text:translate(">=")},{id:"ltDate",text:translate("<")}]});e.comboCompare=Ext.create("Ext.form.field.ComboBox",{fieldLabel:"",queryMode:"local",valueField:"id",displayField:"text",store:t,forceSelection:!0}),e.filterDate=Ext.create("Ext.form.field.Date",{fieldLabel:""}),e.filterDate.on("change",e.onChangeHandler,e),e.comboCompare.on("change",e.onChangeHandler,e),e.items=[e.comboCompare,e.filterDate],e.callParent()},setValue:function(e){var t=this;e.op?t.comboCompare.setValue(e.op):t.comboCompare.setValue("eq"),e.value?t.filterDate.setValue(e.value):t.filterDate.setValue(null)},onChangeHandler:function(e,t){var a=this,l=a.getWidgetRecord();t?e.setFieldStyle({color:"red"}):e.setFieldStyle({color:"black"}),l.set(a.dataIndex,{filterValue:a.filterDate.getValue(),filterOp:a.comboCompare.getValue()})}}),Ext.define("Ext.ux.filterWidget.NumericFilter",{extend:"Ext.container.Container",xtype:"numericfilter",layout:{type:"fit"},initComponent:function(){var e=this,t=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"text",type:"string"}],data:[{id:"eqNbr",text:translate("=")},{id:"gtNbr",text:translate(">")},{id:"lteNbr",text:translate("<=")},{id:"gteNbr",text:translate(">=")},{id:"ltNbr",text:translate("<")},{id:"diffNbr",text:translate("!=")}]});e.comboCompare=Ext.create("Ext.form.field.ComboBox",{fieldLabel:"",queryMode:"local",valueField:"id",displayField:"text",value:"eq",forceSelection:!0,store:t}),e.filterNumeric=Ext.create("Ext.form.field.Number",{fieldLabel:""}),e.filterNumeric.on("change",e.onChangeHandler,e),e.comboCompare.on("change",e.onChangeHandler,e),e.items=[e.comboCompare,e.filterNumeric],e.callParent()},setValue:function(e){var t=this;e.op?t.comboCompare.setValue(e.op):t.comboCompare.setValue("eq"),e.value?t.filterNumeric.setValue(e.value):t.filterNumeric.setValue(null)},onChangeHandler:function(e,t){var a=this,l=a.getWidgetRecord();t?e.setFieldStyle({color:"red"}):e.setFieldStyle({color:"black"}),l.set(a.dataIndex,{filterValue:a.filterNumeric.getValue(),filterOp:a.comboCompare.getValue()})}}),Ext.define("Ext.ux.filterWidget.TextFilter",{extend:"Ext.container.Container",xtype:"textfilter",layout:{type:"fit"},initComponent:function(){var e=this,t=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"text",type:"string"}],data:[{id:"eq",text:translate("=")},{id:"start",text:translate("StartBy")},{id:"contains",text:translate("Contains")}]});e.comboCompare=Ext.create("Ext.form.field.ComboBox",{fieldLabel:"",style:"font-size:10px;",queryMode:"local",valueField:"id",displayField:"text",forceSelection:!0,value:"start",store:t}),e.filterText=Ext.create("Ext.form.field.Text",{fieldLabel:""}),e.filterText.on("blur",e.onChangeHandler,e),e.comboCompare.on("change",e.onChangeHandler,e),e.items=[e.comboCompare,e.filterText],e.callParent()},setValue:function(e){var t=this;e.op?t.comboCompare.setValue(e.op):t.comboCompare.setValue("start"),e.value?t.filterText.setValue(e.value):t.filterText.setValue("")},onChangeHandler:function(e,t){var a=this,l=a.getWidgetRecord();t?e.setFieldStyle({color:"red"}):e.setFieldStyle({color:"black"}),a.filterText.getValue()?l.set(a.dataIndex,{filterValue:a.filterText.getValue(),filterOp:a.comboCompare.getValue()}):l.set(a.dataIndex,null)}});
var FormAddPlugins={addPlugins:function(t){t.plugins=[],t.initialConfig.noPlugin||(t.initialConfig.externalEditingPlugin?t.plugins.push(new Plugins.form.FormPlugin(t.initialConfig.externalEditingPlugin)):t.plugins.push(new Plugins.form.FormPlugin({withValidation:!1,showConfirmationOnSave:!0,showHistoryBtn:!1,showCancelBtn:!1,pluginId:"formediting"})))}};Ext.define("Plugins.form.FormEditingPlugin",{extend:"Ext.AbstractPlugin",alias:"widget.plugin.formediting",config:{toolbarSelector:null},withValidation:!1,showHistoryBtn:!0,showCancelBtn:!0,showConfirmationOnSave:!0,showConfirmationOnQuit:!0,pluginId:"formediting",init:function(t){var e=this;this.form=t;for(var i=t.query("field"),n=0;n<i.length;n++)i[n].addListener("change",this.handleFieldChanged,this);t.editMode=!1;var o=t.query("#editingtoolbar");1==o.length?(this.tb=o[0],this.fillToolbar()):0==o.length&&(this.tb=this.createNewToolbar(),this.fillToolbar(),t.addDocked(this.tb));for(var d=t.query("grid[blocked=false]"),n=0;n<d.length;n++)d[n].query("#grideditingTb").length<1&&e.addTb(d[n])},lockForm:function(t){this.restoreForm(),t&&this.editBtnCtn.hide()},restoreForm:function(){var t=this;t.editBtnCtn.show(),t.saveBtnCtn.hide(),t.showCancelBtn&&t.cancelBtnCtn.hide(),t.quitBtnCtn.hide(),t.showHistoryBtn&&t.chHistBtnCtn.show(),t.editBtnCtn.down("#editBtn").setDisabled(!1),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.showCancelBtn&&t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0),t.quitBtnCtn.down("#quitBtn").setDisabled(!1),t.showHistoryBtn&&t.chHistBtnCtn.down("#chHistBtn").setDisabled(!1)},createNewToolbar:function(){var t=Ext.create("Ext.toolbar.Toolbar",{dock:"top",itemId:"editingtoolbar"});return t},fillToolbar:function(){this.createEditBtnCtn(),this.showCancelBtn&&this.createCancelBtnCtn(),this.createSaveBtnCtn(),this.createQuitBtnCtn(),this.showHistoryBtn&&this.createChHistBtnCtn(),this.tb.add(this.editBtnCtn),this.tb.add({xtype:"tbfill"}),this.tb.add(this.saveBtnCtn),this.showCancelBtn&&this.tb.add(this.cancelBtnCtn),this.tb.add(this.quitBtnCtn),this.showHistoryBtn&&this.tb.add(this.chHistBtnCtn)},createEditBtnCtn:function(){var t=this;this.editBtnCtn=Ext.create("Ext.container.Container",{itemId:"editBtnCtn",hidden:!0,items:[{xtype:"button",text:"${edit}",tooltip:"${gridEdit.editTip}",itemId:"editBtn",glyph:"xf040@FontAwesome",listeners:{click:function(e,i,n){t.enterEditMode(),t.form.fireEvent("inEdit",t.form)}}}]})},createCancelBtnCtn:function(){var t=this;this.cancelBtnCtn=Ext.create("Ext.container.Container",{itemId:"cancelBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"cancelBtn",text:"Annuler",glyph:"xf0e2@FontAwesome",disabled:!0,tooltip:"Annuler les modifications",listeners:{click:function(e,i,n){var o=Ext.create("Common.ux.window.PromptWindow",{withClose:!1});o.setTitle("${gridEdit.cancelTitle}"),o.down("#confirmMsg").setText("${gridEdit.cancelMsg}"),o.down("#description").hide(),o.down("#inputText").hide(),o.query("button")[0].setText("Oui"),o.query("button")[1].setText("Non"),o.callbackFunction=function(e,i){"ok"===e?(Utility.loading.start(o.query("button")[0]),t.form.fireEvent("resetEdit",t.form,o)):o.close()},o.show()}}}]})},createSaveBtnCtn:function(){var t=this;this.saveBtnCtn=Ext.create("Ext.container.Container",{itemId:"saveBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"saveBtn",text:"Enregistrer",disabled:!0,glyph:"xf0c7@FontAwesome",tooltip:"Enregistrer les modifications",listeners:{click:function(e,i,n){if(t.showConfirmationOnSave){var o=Ext.create("Common.ux.window.PromptWindow",{withClose:!1,closable:!1});t.withValidation?(o.setTitle("${gridEdit.submitTitle}"),o.down("#confirmMsg").setText("${gridEdit.submitMsg}")):(o.setTitle("${gridEdit.applyChTitle}"),o.down("#confirmMsg").setText("${gridEdit.applyChMsg}")),o.query("button")[0].setText("Oui"),o.query("button")[1].setText("Non"),o.down("#description").setText("${gridEdit.comment}"),o.callbackFunction=function(e,i){"ok"===e?(Utility.loading.start(o.query("button")[0]),t.form.fireEvent("saveEdit",t.form,o,i)):o.close()},o.show()}else Utility.loading.start(this),t.form.fireEvent("saveEdit",t.form,this)}}}]})},createChHistBtnCtn:function(){var t=this;this.chHistBtnCtn=Ext.create("Ext.container.Container",{itemId:"chHistBtnCtn",items:[{xtype:"button",itemId:"chHistBtn",glyph:"xf073@FontAwesome",tooltip:"${chHist}",listeners:{click:function(e,i,n){t.form.fireEvent("chHist",t.form)}}}]})},createQuitBtnCtn:function(){var t=this;this.quitBtnCtn=Ext.create("Ext.container.Container",{itemId:"quitBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"quitBtn",glyph:"xf08b@FontAwesome",text:"Quitter",tooltip:translate("$gridEdit.quitTip"),listeners:{click:function(e,i,n){if(t.showConfirmationOnQuit){var o=Ext.create("Common.ux.window.PromptWindow",{withClose:!1});o.setTitle("${gridEdit.quitEditionTitle}"),o.down("#confirmMsg").setText(translate("gridEdit.quitEditionMsg")),o.down("#description").hide(),o.down("#inputText").hide(),o.query("button")[0].setText(translate("yes")),o.query("button")[1].setText(translate("no")),o.callbackFunction=function(e,i){"ok"===e?(Utility.loading.start(o.query("button")[0]),t.form.fireEvent("quitEdit",t.form,o)):o.close()},o.show()}else t.form.fireEvent("quitEdit",t.form)}}}]})},enterEditMode:function(){var t=this;t.form.editMode=!0,t.form.recordValues=t.form.getForm().getValues(),t.editBtnCtn.hide(),t.showCancelBtn&&t.cancelBtnCtn.show(),t.saveBtnCtn.show(),t.quitBtnCtn.show(),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.showCancelBtn&&t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0);for(var e=t.form.query("[readOnly=true]"),i=t.form.query("fieldset"),n=0;n<e.length;n++)Ext.isDefined(e[n].blocked)||e[n].blocked||(e[n].setReadOnly(!1),"textfield"===e[n].getXType()&&e[n].removeCls("textfieldReadonly"));e=t.form.query("radiofield");for(var n=0;n<e.length;n++){var o=e[n];Ext.isDefined(e[n].blocked)||e[n].blocked||o.enable()}for(var n=0;n<i.length;n++)i[n].blocked||i[n].addCls("grey-fieldset");for(var d=t.form.query("grid[blocked=false]"),n=0;n<d.length;n++)d[n].query("#grideditingTb")[0].down("#gridAddBtnCtn").show(),d[n].query("#grideditingTb")[0].down("#gridDeleteBtnCtn").show(),d[n].onlyAD!==!0&&d[n].query("#grideditingTb")[0].down("#gridModifyBtnCtn").show(),d[n].inEdition=!0;t.form.addBodyCls("editFormPanel"),t.form.removeBodyCls("readOnlyFormPanel")},addTb:function(t){var e=this,i=Ext.create("Ext.container.Container",{itemId:"gridAddBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"gridAddBtn",iconCls:"icon-add",text:"${add}",tooltip:"${gridEdit.addTip}",listeners:{click:function(i,n,o){e.form.fireEvent("addItem",t)}}}]}),n=Ext.create("Ext.container.Container",{itemId:"gridDeleteBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"gridDeleteBtn",iconCls:"icon-bin2",disabled:!0,text:"${delete}",tooltip:"${gridEdit.deleteTip}",listeners:{click:function(i,n,o){t.down("#gridDeleteBtn").setDisabled(!0),e.form.fireEvent("deleteItem",t)}}}]}),o=Ext.create("Ext.container.Container",{itemId:"gridModifyBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"gridModifyBtn",disabled:!0,text:translate("modify"),tooltip:translate("gridEdit.modifyTip"),listeners:{click:function(i,n,o){e.form.fireEvent("modifyItem",t)}}}]}),d=Ext.create("Ext.container.Container",{itemId:"gridChHistBtnCtn",items:[{xtype:"button",itemId:"gridChHistBtn",iconCls:"icon-script",tooltip:translatr("chHist"),listeners:{click:function(i,n,o){e.form.fireEvent("chHist",t)}}}]}),r=Ext.create("Ext.toolbar.Toolbar",{dock:"top",itemId:"grideditingTb"});r.add(i),r.add(n),t.onlyAD!==!0&&r.add(o),r.add("->"),r.add(d),t.addDocked(r),e.configureGrid(t)},configureGrid:function(t){t.on("select",function(e,i,n,o){i.data.locked||i.data.toDelete?(t.down("#gridDeleteBtn").setDisabled(!0),t.onlyAD!==!0&&t.down("#gridModifyBtn").setDisabled(!0)):(t.down("#gridDeleteBtn").setDisabled(!1),t.onlyAD!==!0&&t.down("#gridModifyBtn").setDisabled(!1))},this);var e=Ext.create("Ext.grid.column.Column",{renderer:function(e,i,n,o,d,r,s){return n.data.notValid&&1==t.inEdition?'<div class="icon-error" style="height:16px !important;" data-qtip="${gridEdit.notValid}<br>'+n.data.notValidTip+'">&nbsp;</div>':n.data.toDelete&&1==t.inEdition?'<div class="icon-bin2" style="height:16px !important;" data-qtip="${gridEdit.toDelete}">&nbsp;</div>':n.data.added&&1==t.inEdition?'<div class="icon-add" style="height:16px !important;" data-qtip="${gridEdit.added}">&nbsp;</div>':n.data.modified&&1==t.inEdition?'<div class="icon-pencil" style="height:16px !important;" data-qtip="${gridEdit.modified}">&nbsp;</div>':n.data.locked?'<div class="icon-lock" style="height:16px !important;" data-qtip="${gridEdit.locked}">&nbsp;</div>':""},itemId:"actionColumn",maxWidth:28,minWidth:28,width:28,menuDisabled:!0,enableColumnHide:!1,hideable:!1});t.headerCt.insert(t.columns.length,e),t.getView().refresh()},checkIfModifications:function(t){var e=this;(t.getStore().query("toDelete",!0).items.length>0||t.getStore().query("added",!0).items.length>0||t.getStore().query("modified",!0).items.length>0)&&(e.saveBtnCtn.down("#saveBtn").setDisabled(!1),e.showCancelBtn&&e.cancelBtnCtn.down("#cancelBtn").setDisabled(!1))},quitEditMode:function(){var t=this;t.form.editMode=!1,t.editBtnCtn.show(),t.saveBtnCtn.hide(),t.showCancelBtn&&t.cancelBtnCtn.hide(),t.quitBtnCtn.hide(),t.showHistoryBtn&&t.chHistBtnCtn.show(),t.editBtnCtn.down("#editBtn").setDisabled(!1),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.showCancelBtn&&t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0),t.quitBtnCtn.down("#quitBtn").setDisabled(!1),t.showHistoryBtn&&t.chHistBtnCtn.down("#chHistBtn").setDisabled(!1);for(var e=t.form.query("[readOnly=false]"),i=t.form.query("fieldset"),n=0;n<e.length;n++)e[n].setReadOnly(!0),"textfield"===e[n].getXType()&&e[n].addCls("textfieldReadonly"),e[n].removeCls("dirty-form-field");e=t.form.query("radiofield");for(var n=0;n<e.length;n++){var o=e[n];o.getValue()?o.enable():o.disable()}for(var n=0;n<i.length;n++)if(i[n].removeCls("grey-fieldset"),i[n].getEl()){var d=i[n].getEl().down(".x-fieldset-header-text");Ext.isEmpty(d)||d.removeCls("dirty-form-field")}for(var r=t.form.query("gridpanel"),n=0;n<r.length;n++)r[n].blocked||(r[n].query("#grideditingTb")[0].down("#gridAddBtnCtn").hide(),r[n].query("#grideditingTb")[0].down("#gridDeleteBtnCtn").hide(),r[n].onlyAD!==!0&&r[n].query("#grideditingTb")[0].down("#gridModifyBtnCtn").hide(),r[n].inEdition=!1);this.form.addBodyCls("readOnlyFormPanel"),this.form.removeBodyCls("editFormPanel")},cancelEdit:function(){var t=this;t.showCancelBtn&&t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.editBtnCtn.hide(),t.form.recordValues=t.form.getForm().getValues()},handleFieldChanged:function(t,e,i,n){var o=this,d=o.form.recordValues,r=o.form.getValues();if(o.form.editMode&&!t.blocked){if(void 0!==t.isAmtFld&&t.isAmtFld===!0){var s=t.getValue().length;s>21?(t.inputEl.dom.maxLength=18,t.maxLength=18,t.isValid()):(t.inputEl.dom.maxLength=26,t.maxLength=26,t.isValid())}JSON.stringify(d)!=JSON.stringify(r)&&o.form.isValid()?(o.saveBtnCtn.down("button").setDisabled(!1),o.showCancelBtn&&o.cancelBtnCtn.down("button").setDisabled(!1)):(o.saveBtnCtn.down("button").setDisabled(!0),o.showCancelBtn&&o.cancelBtnCtn.down("button").setDisabled(!0)),"radiofield"!==t.getXType()&&e!=d[t.name]||"radiofield"===t.getXType()&&t.getGroupValue()!=d[t.name]?o.highlightModifications(t):o.unHighlightModifications(t)}},checkChangesOnOtherFields:function(t){var e=this.form.recordValues;if(null!=t){var i=t.items.items;if(t.query("radiogroup").length>1)for(var n=0;n<i.length;n++){var o=i[n].getChecked();if(o.length>1)return!0;var d=i[n].getChecked()[0];if(d){var r=d.name;if(e[r]!=i[n].getChecked()[0].inputValue)return!0}}}},highlightModifications:function(t){if("radiofield"===t.getXType()){var e=t.up("fieldset"),i=e.getEl().down(".x-fieldset-header-text");i.addCls("dirty-form-field")}else t.addCls("dirty-form-field")},unHighlightModifications:function(t){var e=!1;if("radiofield"===t.getXType()){var i=t.up("fieldset");if(e=this.checkChangesOnOtherFields(i))return;var n=i.getEl().down(".x-fieldset-header-text");n.removeCls("dirty-form-field")}else t.removeCls("dirty-form-field")}}),Ext.define("Plugins.form.FormPlugin",{extend:"Ext.AbstractPlugin",alias:"widget.plugin.formediting",config:{toolbarSelector:null},withValidation:!1,showHistoryBtn:!0,showCancelBtn:!0,showConfirmationOnSave:!0,showConfirmationOnQuit:!0,pluginId:"formediting",init:function(t){this.form=t;for(var e=t.query("field"),i=0;i<e.length;i++)e[i].addListener("change",this.handleFieldChanged,this);t.editMode=!1;var n=t.query("#editingtoolbar");1==n.length?(this.tb=n[0],this.fillToolbar()):0==n.length&&(this.tb=this.createNewToolbar(),this.fillToolbar(),t.addDocked(this.tb))},lockForm:function(t){this.restoreForm(),t&&this.editBtnCtn.hide()},restoreForm:function(){var t=this;t.editBtnCtn.show(),t.saveBtnCtn.hide(),t.showCancelBtn&&t.cancelBtnCtn.hide(),t.quitBtnCtn.hide(),t.showHistoryBtn&&t.chHistBtnCtn.show(),t.editBtnCtn.down("#editBtn").setDisabled(!1),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.showCancelBtn&&t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0),t.quitBtnCtn.down("#quitBtn").setDisabled(!1),t.showHistoryBtn&&t.chHistBtnCtn.down("#chHistBtn").setDisabled(!1)},createNewToolbar:function(){var t=Ext.create("Ext.toolbar.Toolbar",{dock:"top",itemId:"editingtoolbar"});return t},fillToolbar:function(){this.createEditBtnCtn(),this.showCancelBtn&&this.createCancelBtnCtn(),this.createSaveBtnCtn(),this.createQuitBtnCtn(),this.showHistoryBtn&&this.createChHistBtnCtn(),this.tb.add(this.editBtnCtn),this.tb.add({xtype:"tbfill"}),this.tb.add(this.saveBtnCtn),this.showCancelBtn&&this.tb.add(this.cancelBtnCtn),this.tb.add(this.quitBtnCtn),this.showHistoryBtn&&this.tb.add(this.chHistBtnCtn)},createEditBtnCtn:function(){var t=this;this.editBtnCtn=Ext.create("Ext.container.Container",{itemId:"editBtnCtn",hidden:!0,items:[{xtype:"button",text:"${edit}",tooltip:"${gridEdit.editTip}",itemId:"editBtn",glyph:"xf040@FontAwesome",listeners:{click:function(e,i,n){t.enterEditMode(),t.form.fireEvent("inEdit",t.form)}}}]})},createCancelBtnCtn:function(){var t=this;this.cancelBtnCtn=Ext.create("Ext.container.Container",{itemId:"cancelBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"cancelBtn",text:"Annuler",glyph:"xf0e2@FontAwesome",disabled:!0,tooltip:"Annuler les modifications",listeners:{click:function(e,i,n){var o=Ext.create("Common.ux.window.PromptWindow",{withClose:!1});o.setTitle("${gridEdit.cancelTitle}"),o.down("#confirmMsg").setText("${gridEdit.cancelMsg}"),o.down("#description").hide(),o.down("#inputText").hide(),o.query("button")[0].setText("Oui"),o.query("button")[1].setText("Non"),o.callbackFunction=function(e,i){"ok"===e?(Utility.loading.start(o.query("button")[0]),t.form.fireEvent("resetEdit",t.form,o)):o.close()},o.show()}}}]})},createSaveBtnCtn:function(){var t=this;this.saveBtnCtn=Ext.create("Ext.container.Container",{itemId:"saveBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"saveBtn",text:"Enregistrer",disabled:!0,glyph:"xf0c7@FontAwesome",tooltip:"Enregistrer les modifications",listeners:{click:function(e,i,n){if(t.showConfirmationOnSave){var o=Ext.create("Common.ux.window.PromptWindow",{withClose:!1,closable:!1});t.withValidation?(o.setTitle("${gridEdit.submitTitle}"),o.down("#confirmMsg").setText("${gridEdit.submitMsg}")):(o.setTitle("${gridEdit.applyChTitle}"),o.down("#confirmMsg").setText("${gridEdit.applyChMsg}")),o.query("button")[0].setText("Oui"),o.query("button")[1].setText("Non"),o.down("#description").setText("${gridEdit.comment}"),o.callbackFunction=function(e,i){"ok"===e?(Utility.loading.start(o.query("button")[0]),t.form.fireEvent("saveEdit",t.form,o,i)):o.close()},o.show()}else Utility.loading.start(this),t.form.fireEvent("saveEdit",t.form,this)}}}]})},createChHistBtnCtn:function(){var t=this;this.chHistBtnCtn=Ext.create("Ext.container.Container",{itemId:"chHistBtnCtn",items:[{xtype:"button",itemId:"chHistBtn",glyph:"xf073@FontAwesome",tooltip:"${chHist}",listeners:{click:function(e,i,n){t.form.fireEvent("chHist",t.form)}}}]})},createQuitBtnCtn:function(){var t=this;this.quitBtnCtn=Ext.create("Ext.container.Container",{itemId:"quitBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"quitBtn",glyph:"xf08b@FontAwesome",text:"Quitter",tooltip:translate("$gridEdit.quitTip"),listeners:{click:function(e,i,n){if(t.showConfirmationOnQuit){var o=Ext.create("Common.ux.window.PromptWindow",{withClose:!1});o.setTitle("${gridEdit.quitEditionTitle}"),o.down("#confirmMsg").setText(translate("gridEdit.quitEditionMsg")),o.down("#description").hide(),o.down("#inputText").hide(),o.query("button")[0].setText(translate("yes")),o.query("button")[1].setText(translate("no")),o.callbackFunction=function(e,i){"ok"===e?(Utility.loading.start(o.query("button")[0]),t.form.fireEvent("quitEdit",t.form,o)):o.close()},o.show()}else t.form.fireEvent("quitEdit",t.form)}}}]})},enterEditMode:function(){var t=this;t.form.editMode=!0,t.form.recordValues=t.form.getForm().getValues(),t.editBtnCtn.hide(),t.showCancelBtn&&t.cancelBtnCtn.show(),t.saveBtnCtn.show(),t.quitBtnCtn.show(),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.showCancelBtn&&t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0);for(var e=t.form.query("[readOnly=true]"),i=t.form.query("fieldset"),n=0;n<e.length;n++)Ext.isDefined(e[n].blocked)||e[n].blocked||(e[n].setReadOnly(!1),"textfield"===e[n].getXType()&&e[n].removeCls("textfieldReadonly"));e=t.form.query("radiofield");for(var n=0;n<e.length;n++){var o=e[n];Ext.isDefined(e[n].blocked)||e[n].blocked||o.enable()}for(var n=0;n<i.length;n++)i[n].blocked||i[n].addCls("grey-fieldset");t.form.addBodyCls("editFormPanel"),t.form.removeBodyCls("readOnlyFormPanel")},quitEditMode:function(){var t=this;t.form.editMode=!1,t.editBtnCtn.show(),t.saveBtnCtn.hide(),t.showCancelBtn&&t.cancelBtnCtn.hide(),t.quitBtnCtn.hide(),t.showHistoryBtn&&t.chHistBtnCtn.show(),t.editBtnCtn.down("#editBtn").setDisabled(!1),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.showCancelBtn&&t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0),t.quitBtnCtn.down("#quitBtn").setDisabled(!1),t.showHistoryBtn&&t.chHistBtnCtn.down("#chHistBtn").setDisabled(!1);for(var e=t.form.query("[readOnly=false]"),i=t.form.query("fieldset"),n=0;n<e.length;n++)e[n].setReadOnly(!0),"textfield"===e[n].getXType()&&e[n].addCls("textfieldReadonly"),e[n].removeCls("dirty-form-field");e=t.form.query("radiofield");for(var n=0;n<e.length;n++){var o=e[n];o.getValue()?o.enable():o.disable()}for(var n=0;n<i.length;n++)if(i[n].removeCls("grey-fieldset"),i[n].getEl()){var d=i[n].getEl().down(".x-fieldset-header-text");Ext.isEmpty(d)||d.removeCls("dirty-form-field")}this.form.addBodyCls("readOnlyFormPanel"),this.form.removeBodyCls("editFormPanel")},cancelEdit:function(){var t=this;t.showCancelBtn&&t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.editBtnCtn.hide(),t.form.recordValues=t.form.getForm().getValues()},handleFieldChanged:function(t,e,i,n){var o=this,d=o.form.recordValues,r=o.form.getValues();if(o.form.editMode&&!t.blocked){if(void 0!==t.isAmtFld&&t.isAmtFld===!0){var s=t.getValue().length;s>21?(t.inputEl.dom.maxLength=18,t.maxLength=18,t.isValid()):(t.inputEl.dom.maxLength=26,t.maxLength=26,t.isValid())}JSON.stringify(d)!=JSON.stringify(r)&&o.form.isValid()?(o.saveBtnCtn.down("button").setDisabled(!1),o.showCancelBtn&&o.cancelBtnCtn.down("button").setDisabled(!1)):(o.saveBtnCtn.down("button").setDisabled(!0),o.showCancelBtn&&o.cancelBtnCtn.down("button").setDisabled(!0)),"radiofield"!==t.getXType()&&e!=d[t.name]||"radiofield"===t.getXType()&&t.getGroupValue()!=d[t.name]?o.highlightModifications(t):o.unHighlightModifications(t)}},checkChangesOnOtherFields:function(t){var e=this.form.recordValues;if(null!=t){var i=t.items.items;if(t.query("radiogroup").length>1)for(var n=0;n<i.length;n++){var o=i[n].getChecked();if(o.length>1)return!0;var d=i[n].getChecked()[0];if(d){var r=d.name;if(e[r]!=i[n].getChecked()[0].inputValue)return!0}}}},highlightModifications:function(t){if("radiofield"===t.getXType()){var e=t.up("fieldset"),i=e.getEl().down(".x-fieldset-header-text");i.addCls("dirty-form-field")}else t.addCls("dirty-form-field")},unHighlightModifications:function(t){var e=!1;if("radiofield"===t.getXType()){var i=t.up("fieldset");if(e=this.checkChangesOnOtherFields(i))return;var n=i.getEl().down(".x-fieldset-header-text");n.removeCls("dirty-form-field")}else t.removeCls("dirty-form-field")}});
var func=func||{};func.Report={createNewReport:function(e,t,r,o,a){var n=new Promise(function(n,s){var d=new Date,i=d.getFullYear(),c=d.getMonth(),l={};l.reportId=UUID(),l.doctorId=e,l.visitId=t,l.reportName=l.reportId+".docx",l.reportPath="site"+r+"/"+i+"/"+c,l.reportDate=new Date,l.reportStatus=1;var p=CommonDirect.saveData(l,"REPORT",""),u={};u.worklistId=o,u.patientId=a,u.siteId=r,u.visitId=t,u.worklistLastCrStatus=1;var w=l.reportPath+"/"+l.reportName,m=CommonDirect.saveData(u,"WORKLIST","");Promise.all([p,m]).then(function(e){var t;t=new XMLHttpRequest,t.onreadystatechange=function(){4==t.readyState&&200==t.status&&("success"==t.responseText?(t.open("POST","http://localhost:1000/openWord",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send("jsDavUrl="+o+"&wordPath="+r+"&docPath="+w),Ext.GlobalEvents.fireEvent("refreshWorklistEvent"),n("success")):s("reportFileCreationisFailed"))};var r=window.localStorage.getItem("smartmed-wordPath"),o=window.localStorage.getItem("smartmed-jsDavUrl");t.open("POST","http://localhost:7000/createWord",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send("docPath="+w)})});return n}};
var GridAddPlugins={addPlugins:function(t){t.plugins=[{ptype:"rowediting",pluginId:"rowEdit",autoCancel:!1,clicksToMoveEditor:0,errorSummary:!1}],Plugins.grid.GridEditingPlugin.configure(t),t.initialConfig.externalEditingPlugin?t.plugins.push(new Plugins.grid.GridEditingPlugin(t.initialConfig.externalEditingPlugin)):t.plugins.push(new Plugins.grid.GridEditingPlugin({pluginId:"gridediting"}))},addSearchPlugin:function(t){t.plugins=[{ptype:"cellediting",pluginId:"cellEditing"}],t.plugins.push(new Plugins.grid.GridSearchPlugin({pluginId:"gridsearch"}))}};Ext.define("Plugins.grid.GridEditingPlugin",{extend:"Ext.AbstractPlugin",alias:"widget.plugin.gridediting",statics:{configure:function(t){t.columns.push({xtype:"gridcolumn",renderer:function(t,e,n,i,d,o,l){if(void 0!==l&&null!==l){var a=l.up("gridpanel");return n.data.notValid&&!n.data.toDelete&&a.inEdition===!0?'<div class="fa fa-exclamation-triangle" style="height:16px !important;" data-qtip="${gridEdit.notValid}<br>'+n.data.notValidTip+'">&nbsp;</div>':n.data.toDelete&&a.inEdition===!0?'<div class="fa fa-trash-o" style="height:16px !important;" data-qtip="A supprimer">&nbsp;</div>':n.data.added&&a.inEdition===!0?'<div class="fa fa-plus" style="height:16px !important;" data-qtip="Ajouté">&nbsp;</div>':n.data.modified&&a.inEdition===!0?'<div class="fa fa-edit" style="height:16px !important;" data-qtip="Modifié">&nbsp;</div>':n.data.locked?'<div class="fa fa-lock" style="height:16px !important;" data-qtip="'+n.data.userID+" "+n.data.userName+'">&nbsp;</div>':""}return""},itemId:"actionColumn",maxWidth:28,minWidth:28,width:28,menuDisabled:!0,draggable:!1,enableColumnHide:!1,hideable:!1})}},config:{toolbarSelector:null},withValidation:!1,showConfirmationOnSave:!0,liveSearch:!0,preferences:!0,noModif:!1,onlyADM:!1,onlyModify:!1,onlyDelete:!1,onlyAD:!1,onlyECSQ:!1,inEditing:!1,enableDuplicate:!0,pluginId:"gridediting",init:function(t){var e=this;this.grid=t,t.inEdition=!1,this.inEditing&&(t.inEdition=!0),this.onlyADM&&(t.inEdition=!0);var n=t.query("#editingtoolbar");1==n.length?(this.tb=n[0],this.fillToolbar()):0==n.length&&(this.tb=this.createNewToolbar(),this.fillToolbar(),t.addDocked(this.tb)),t.on("select",e.gridOnSelect,e),t.on("columnmove",e.gridOnColumnMove,e),e.onlyECSQ===!1||Ext.isEmpty(t.down("#actionColumn"))||t.down("#actionColumn").hide()},getDataToBeSaved:function(){var t=this,e=[],n=["added","modified","toDelete"],i=[];return Ext.Array.each(n,function(n){Ext.each(t.grid.store.query(n,!0).items,function(n){if(n.validate().isValid())e.push(n.data);else{var d=t.grid.store.indexOf(n);d++,i.push(d)}})}),{dataToBeSaved:e,errors:i}},gridOnSelect:function(t,e,n,i){var d=this;d.onlyECSQ||d.onlyModify||d.onlyDelete||d.onlyAD||d.noModif?d.onlyModify?e.get("locked")?d.modifyBtnCtn.down("#modifyBtn").setDisabled(!0):d.modifyBtnCtn.down("#modifyBtn").setDisabled(!1):(d.onlyDelete||d.onlyAD||d.noModif)&&(e.get("locked")||e.get("toDelete")?d.deleteBtnCtn.down("#deleteBtn").setDisabled(!0):d.deleteBtnCtn.down("#deleteBtn").setDisabled(!1)):e.get("locked")||e.get("toDelete")?(d.deleteBtnCtn.down("#deleteBtn").setDisabled(!0),d.modifyBtnCtn.down("#modifyBtn").setDisabled(!0),d.duplicateBtnCtn.down("#duplicateBtn").setDisabled(!0)):(d.deleteBtnCtn.down("#deleteBtn").setDisabled(!1),d.modifyBtnCtn.down("#modifyBtn").setDisabled(!1),d.duplicateBtnCtn.down("#duplicateBtn").setDisabled(!1))},gridOnColumnMove:function(t,e,n,i,d){var o=this;if(t.enableColumnMove=!0,o.grid.inEdition===!0)return!1},lockGrid:function(t){this.restoreGrid(),t&&this.editBtnCtn.hide()},restoreGrid:function(){var t=this;t.editBtnCtn.hide(),t.deleteBtnCtn.hide(),t.addBtnCtn.hide(),t.modifyBtnCtn.hide(),t.duplicateBtnCtn.hide(),t.saveBtnCtn.hide(),t.cancelBtnCtn.hide(),t.quitBtnCtn.hide(),t.chHistBtnCtn.hide(),t.editBtnCtn.down("#editBtn").setDisabled(!1),t.deleteBtnCtn.down("#deleteBtn").setDisabled(!1),t.addBtnCtn.down("#addBtn").setDisabled(!1),t.modifyBtnCtn.down("#modifyBtn").setDisabled(!1),t.duplicateBtnCtn.down("#duplicateBtn").setDisabled(!0),t.saveBtnCtn.down("#saveBtn").setDisabled(!1),t.cancelBtnCtn.down("#cancelBtn").setDisabled(!1),t.quitBtnCtn.down("#quitBtn").setDisabled(!1),t.chHistBtnCtn.down("#chHistBtn").setDisabled(!1),t.onlyADM||t.onlyECSQ||t.onlyModify||t.onlyDelete||t.onlyAD||t.noModif?t.onlyECSQ?(t.editBtnCtn.show(),t.chHistBtnCtn.show(),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0)):t.onlyADM?(t.deleteBtnCtn.show(),t.addBtnCtn.show(),t.modifyBtnCtn.show(),t.chHistBtnCtn.show(),t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0),t.modifyBtnCtn.down("#modifyBtn").setDisabled(!0)):t.onlyModify?(t.editBtnCtn.show(),t.chHistBtnCtn.show(),t.modifyBtnCtn.down("#modifyBtn").setDisabled(!0),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0)):t.onlyDelete?(t.editBtnCtn.show(),t.chHistBtnCtn.show(),t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0)):t.onlyAD?(t.deleteBtnCtn.show(),t.addBtnCtn.show(),t.chHistBtnCtn.show(),t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0)):t.noModif&&(t.editBtnCtn.show(),t.chHistBtnCtn.show(),t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0)):(t.editBtnCtn.show(),t.chHistBtnCtn.show(),t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0),t.modifyBtnCtn.down("#modifyBtn").setDisabled(!0),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0)),t.filterCheckBoxCtn&&t.filterCheckBoxCtn.hide(),t.enableDuplicate&&t.duplicateBtnCtn.down("#duplicateBtn").setDisabled(!1),t.chHistBtnCtn.hide()},createNewToolbar:function(){var t=Ext.create("Ext.toolbar.Toolbar",{dock:"top",itemId:"editingtoolbar"});return t},fillToolbar:function(){this.createFilterCheckboxCtn(),this.liveSearch&&(this.createLiveSearchCtn(),this.tb.add(this.liveSearchCtn)),this.createEditBtnCtn(),this.createCancelBtnCtn(),this.createSaveBtnCtn(),this.createChHistBtnCtn(),this.createAddBtnCtn(),this.createDeleteBtnCtn(),this.createModifyBtnCtn(),this.createDuplicateBtnCtn(),this.createQuitBtnCtn(),this.tb.add(this.editBtnCtn),this.tb.add(this.addBtnCtn),this.tb.add(this.deleteBtnCtn),this.tb.add(this.modifyBtnCtn),this.tb.add(this.duplicateBtnCtn),this.tb.add({xtype:"tbfill"}),this.tb.add(this.filterCheckBoxCtn),this.tb.add(this.saveBtnCtn),this.tb.add(this.cancelBtnCtn),this.tb.add(this.quitBtnCtn),this.tb.add(this.chHistBtnCtn),this.preferences&&(this.createPreferenceBtnCtn(),this.tb.add(this.preferenceBtnCtn))},createFilterCheckboxCtn:function(){var t=this;this.filterCheckBoxCtn=Ext.create("Ext.container.Container",{itemId:"CheckBoxCtn",hidden:!0,items:[{xtype:"checkbox",fieldBodyCls:"x-form-cb-wrap-default_toolbar",boxLabel:translate("displayModifiedRows"),itemId:"filterCheckbox",listeners:{change:function(e){t.liveSearchCtn.setValue("");var n,i=t.grid.getStore();i.clearFilter(),e.getValue()&&i.filterBy(function(t){return n=!1,(t.get("added")||t.get("modified")||t.get("toDelete"))&&(n=!0),n})}}}]})},createLiveSearchCtn:function(){var t=this;t.liveSearchCtn=Ext.create("Ext.form.TextField",{fieldStyle:"font-family: FontAwesome",emptyText:translate("liveSearch"),listeners:{specialkey:function(e,n){var i=e.getValue();if(n.getKey()===n.ENTER){var d=t.grid.getStore();d.clearFilter(),Ext.isEmpty(i)||d.filterBy(function(t){var e=!1,n=t.getData();for(var d in n)n[d]&&n[d].toString().indexOf(i.toString())>=0&&(e=!0);return e})}}},triggers:{mytrigger2:{handler:function(e,n,i){e.setValue(""),t.grid.getStore().clearFilter()},cls:"x-form-clear-trigger"}}})},createEditBtnCtn:function(){var t=this;this.editBtnCtn=Ext.create("Ext.container.Container",{itemId:"editBtnCtn",hidden:!0,items:[{xtype:"button",text:translate("edit"),tooltip:translate("clickToSwitchInEditMode"),itemId:"editBtn",glyph:"xf040@FontAwesome",listeners:{click:function(e,n,i){t.enterEditMode(),t.grid.fireEvent("inEdit",t.grid)}}}]})},createCancelBtnCtn:function(){var t=this;this.cancelBtnCtn=Ext.create("Ext.container.Container",{itemId:"cancelBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"cancelBtn",glyph:"xf0e2@FontAwesome",disabled:!0,tooltip:translate("clickToCancelModifications"),listeners:{click:function(e,n,i){var d=Ext.create("Common.ux.window.PromptWindow",{withClose:!1});d.setTitle(translate("cancelTitle")),d.down("#confirmMsg").setText(translate("cancelMsg")),d.down("#description").hide(),d.down("#inputText").hide(),d.query("button")[0].setText(translate("yes")),d.query("button")[1].setText(translate("no")),d.callbackFunction=function(e,n){"ok"===e?(Utility.loading.start(d.query("button")[0]),t.cancelEdit(),t.grid.fireEvent("resetEdit",t.grid,d)):d.close()},d.show()}}}]})},createSaveBtnCtn:function(){var t=this;this.saveBtnCtn=Ext.create("Ext.container.Container",{itemId:"saveBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"saveBtn",disabled:!0,glyph:"xf0c7@FontAwesome",tooltip:translate("clickToSaveModifications"),listeners:{click:function(e,n,i){if(t.showConfirmationOnSave){var d=t.getDataToBeSaved(),o=d.dataToBeSaved,l=d.errors;if(l.length>0)Ext.MessageBox.show({title:"Erreur",msg:l,icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK});else{var a=Ext.create("Common.ux.window.PromptWindow",{withClose:!1,closable:!1});t.withValidation?(a.setTitle(translate("msg.comment")),a.down("#confirmMsg").setText(translate("submitMsg"))):(a.setTitle(translate("applyChTitle")),a.down("#confirmMsg").setText(translate("ApplyModification?"))),a.query("button")[0].setText(translate("yes")),a.query("button")[1].setText(translate("no")),a.down("#description").setText(translate("comment")),a.callbackFunction=function(e,n){"ok"===e?(Utility.loading.start(a.query("button")[0]),t.grid.fireEvent("saveEdit",t.grid,a,o,n)):a.close()},a.show()}}else t.grid.fireEvent("saveEdit",t.grid)}}}]})},createChHistBtnCtn:function(){var t=this;this.chHistBtnCtn=Ext.create("Ext.container.Container",{itemId:"chHistBtnCtn",items:[{xtype:"button",itemId:"chHistBtn",glyph:"xf073@FontAwesome",tooltip:translate("modificationsHistory"),listeners:{click:function(e,n,i){t.grid.fireEvent("chHist",t.grid)}}}]})},createAddBtnCtn:function(){var t=this;this.addBtnCtn=Ext.create("Ext.container.Container",{itemId:"addBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"addBtn",glyph:"xf067@FontAwesome",tooltip:translate("clickToAddNewRow"),listeners:{click:function(e,n,i){t.grid.fireEvent("addItem",t.grid)}}}]})},createDuplicateBtnCtn:function(){var t=this;this.duplicateBtnCtn=Ext.create("Ext.container.Container",{itemId:"duplicateBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"duplicateBtn",glyph:"xf0c5@FontAwesome",tooltip:translate("clickToDuplicateRow"),listeners:{click:function(e,n,i){t.grid.fireEvent("duplicateItem",t.grid)}}}]})},createDeleteBtnCtn:function(){var t=this;this.deleteBtnCtn=Ext.create("Ext.container.Container",{itemId:"deleteBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"deleteBtn",glyph:"xf014@FontAwesome",disabled:!0,tooltip:translate("clickToDeleteTheSelection"),listeners:{click:function(e,n,i){t.onlyDelete===!1&&t.onlyAD===!1&&t.noModif===!1&&t.modifyBtnCtn.down("#modifyBtn").setDisabled(!0),t.duplicateBtnCtn.down("#duplicateBtn").setDisabled(!0),t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0),t.grid.fireEvent("deleteItem",t.grid)}}}]})},createModifyBtnCtn:function(){var t=this;this.modifyBtnCtn=Ext.create("Ext.container.Container",{itemId:"modifyBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"modifyBtn",disabled:!0,glyph:"xf044@FontAwesome",tooltip:translate("clickToModifySelection"),listeners:{click:function(e,n,i){t.grid.fireEvent("modifyItem",t.grid)}}}]})},createPreferenceBtnCtn:function(){this.preferenceBtnCtn=Ext.create("Ext.container.Container",{itemId:"preferenceBtnCtn",items:[{xtype:"button",itemId:"preferenceBtn",glyph:"xf234@FontAwesome",tooltip:translate("clickToSavePreference"),listeners:{click:function(t,e,n){StateProvider.saveState(window.localStorage.getItem("smartmed-userId"))}}}]})},createQuitBtnCtn:function(){var t=this;this.quitBtnCtn=Ext.create("Ext.container.Container",{itemId:"quitBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"quitBtn",glyph:"xf08b@FontAwesome",tooltip:translate("quit"),listeners:{click:function(e,n,i){var d=Ext.create("Common.ux.window.PromptWindow",{withClose:!1});d.setTitle(translate("gridEdit.quitEditionTitle")),d.down("#confirmMsg").setText(translate("gridEdit.quitEditionMsg")),d.down("#description").hide(),d.down("#inputText").hide(),d.query("button")[0].setText(translate("yes")),d.query("button")[1].setText(translate("no")),d.callbackFunction=function(e,n){"ok"===e?(Utility.loading.start(d.query("button")[0]),t.grid.fireEvent("quitEdit",t.grid,d)):d.close()},d.show()}}}]})},enterEditMode:function(){var t=this;if(t.grid.inEdition=!0,t.editBtnCtn.hide(),t.cancelBtnCtn.show(),t.saveBtnCtn.show(),t.quitBtnCtn.show(),t.filterCheckBoxCtn.show(),t.duplicateBtnCtn.show(),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0),t.grid.getSelectionModel().hasSelection())var e=t.grid.getSelectionModel().getSelection()[0];this.onlyECSQ||this.onlyModify||this.onlyDelete||this.onlyAD||this.noModif?this.onlyModify===!0?(t.modifyBtnCtn.show(),t.grid.getSelectionModel().hasSelection()&&(e.get("locked")?t.modifyBtnCtn.down("#modifyBtn").setDisabled(!0):e.get("locked")||t.modifyBtnCtn.down("#modifyBtn").setDisabled(!1))):this.onlyDelete===!0||this.onlyAD===!0?(t.deleteBtnCtn.show(),t.grid.getSelectionModel().hasSelection()&&(e.get("locked")||e.get("toDelete")?t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0):e.get("locked")||e.get("toDelete")||t.deleteBtnCtn.down("#deleteBtn").setDisabled(!1))):this.noModif===!0&&(t.deleteBtnCtn.show(),t.addBtnCtn.show(),t.grid.getSelectionModel().hasSelection()&&(t.grid.getSelectionModel().getSelection()[0].data.locked||t.grid.getSelectionModel().getSelection()[0].data.toDelete)?t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0):!t.grid.getSelectionModel().hasSelection()||t.grid.getSelectionModel().getSelection()[0].data.locked||t.grid.getSelectionModel().getSelection()[0].data.toDelete||t.deleteBtnCtn.down("#deleteBtn").setDisabled(!1)):(t.deleteBtnCtn.show(),t.addBtnCtn.show(),t.modifyBtnCtn.show(),t.grid.getSelectionModel().hasSelection()&&(e.get("locked")||e.get("toDelete")?(t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0),t.modifyBtnCtn.down("#modifyBtn").setDisabled(!0),t.duplicateBtnCtn.down("#duplicateBtn").setDisabled(!0)):e.get("locked")||e.get("locked")||(t.deleteBtnCtn.down("#deleteBtn").setDisabled(!1),t.modifyBtnCtn.down("#modifyBtn").setDisabled(!1),t.duplicateBtnCtn.down("#duplicateBtn").setDisabled(!1))))},quitEditMode:function(){var t=this;t.grid.inEdition=!1,t.restoreGrid()},cancelEdit:function(){var t=this;if(t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.grid.getSelectionModel().hasSelection())var e=t.grid.getSelectionModel().getSelection()[0];this.onlyECSQ||this.onlyModify||this.onlyDelete||this.onlyAD||this.noModif?this.onlyModify?(t.modifyBtnCtn.down("#modifyBtn").setDisabled(!0),e.get("locked")?t.modifyBtnCtn.down("#modifyBtn").setDisabled(!0):e.get("locked")||t.modifyBtnCtn.down("#modifyBtn").setDisabled(!1)):this.onlyDelete||this.onlyAD?(t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0),e.get("locked")||e.get("toDelete")?t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0):e.get("locked")||e.get("toDelete")||t.deleteBtnCtn.down("#deleteBtn").setDisabled(!1)):this.noModif===!0&&(t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0),e.get("locked")||e.get("toDelete")?t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0):e.get("locked")||e.get("toDelete")||t.deleteBtnCtn.down("#deleteBtn").setDisabled(!1),t.addBtnCtn.down("#addBtn").setDisabled(!1)):(t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0),t.modifyBtnCtn.down("#modifyBtn").setDisabled(!0),t.grid.getSelectionModel().hasSelection()&&(e.get("locked")||e.get("toDelete")?(t.deleteBtnCtn.down("#deleteBtn").setDisabled(!0),t.modifyBtnCtn.down("#modifyBtn").setDisabled(!0),t.duplicateBtnCtn.down("#duplicateBtn").setDisabled(!0)):e.get("locked")||e.get("toDelete")||(t.deleteBtnCtn.down("#deleteBtn").setDisabled(!1),t.modifyBtnCtn.down("#modifyBtn").setDisabled(!1),t.duplicateBtnCtn.down("#duplicateBtn").setDisabled(!1))),t.addBtnCtn.down("#addBtn").setDisabled(!1)),t.editBtnCtn.hide()},checkIfModifications:function(){var t=this,e=t.grid;0==e.getStore().query("notValid",!0).items.length?e.getStore().query("toDelete",!0).items.length>0||e.getStore().query("added",!0).items.length>0||e.getStore().query("modified",!0).items.length>0?(t.saveBtnCtn&&t.saveBtnCtn.down("#saveBtn").setDisabled(!1),t.cancelBtnCtn&&t.cancelBtnCtn.down("#cancelBtn").setDisabled(!1)):(t.saveBtnCtn&&t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.cancelBtnCtn&&t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0)):(t.saveBtnCtn&&t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.cancelBtnCtn&&t.cancelBtnCtn.down("#cancelBtn").setDisabled(!1))},fillInInterfaceOn:function(){var t=this,e=t.grid;e.down("#duplicateBtn").setDisabled(!0),t.onlyADM||t.onlyECSQ||t.onlyModify||t.onlyDelete||t.onlyAD||t.noModif?t.onlyADM?(e.down("#modifyBtn").setDisabled(!0),e.down("#addBtn").setDisabled(!0),e.down("#deleteBtn").setDisabled(!0),e.down("#chHistBtn").setDisabled(!0)):t.onlyECSQ?(e.down("#saveBtn").setDisabled(!0),e.down("#cancelBtn").setDisabled(!0),e.down("#quitBtn").setDisabled(!0),e.down("#chHistBtn").setDisabled(!0)):t.onlyModify?(e.down("#modifyBtn").setDisabled(!0),e.down("#saveBtn").setDisabled(!0),e.down("#cancelBtn").setDisabled(!0),e.down("#quitBtn").setDisabled(!0),e.down("#chHistBtn").setDisabled(!0)):t.onlyDelete?(e.down("#saveBtn").setDisabled(!0),e.down("#cancelBtn").setDisabled(!0),e.down("#deleteBtn").setDisabled(!0),e.down("#quitBtn").setDisabled(!0),e.down("#chHistBtn").setDisabled(!0)):t.onlyAD?(e.down("#addBtn").setDisabled(!0),e.down("#deleteBtn").setDisabled(!0),e.down("#chHistBtn").setDisabled(!0)):t.noModif&&(e.down("#saveBtn").setDisabled(!0),e.down("#cancelBtn").setDisabled(!0),e.down("#addBtn").setDisabled(!0),e.down("#deleteBtn").setDisabled(!0),e.down("#quitBtn").setDisabled(!0),e.down("#chHistBtn").setDisabled(!0)):(e.down("#modifyBtn").setDisabled(!0),e.down("#saveBtn").setDisabled(!0),e.down("#cancelBtn").setDisabled(!0),e.down("#addBtn").setDisabled(!0),e.down("#deleteBtn").setDisabled(!0),e.down("#quitBtn").setDisabled(!0),e.down("#chHistBtn").setDisabled(!0))},fillInInterfaceOff:function(){var t=this,e=t.grid,n=e.getSelectionModel().hasSelection(),i=e.getSelectionModel().getSelection()[0];e.down("#chHistBtn").setDisabled(!1),t.onlyADM||t.onlyAD||(e.down("#quitBtn").setDisabled(!1),t.onlyECSQ||t.checkIfModifications()),t.onlyECSQ||t.onlyModify||t.onlyDelete||t.onlyAD||t.noModif?t.onlyModify?n&&i.data.locked?e.down("#modifyBtn").setDisabled(!0):e.down("#modifyBtn").setDisabled(!1):t.onlyDelete?n&&i.data.locked?e.down("#deleteBtn").setDisabled(!0):e.down("#deleteBtn").setDisabled(!1):t.onlyAD?(n&&i.data.locked?e.down("#deleteBtn").setDisabled(!0):e.down("#deleteBtn").setDisabled(!1),e.down("#addBtn").setDisabled(!1)):t.noModif&&(n&&i.data.locked?e.down("#deleteBtn").setDisabled(!0):e.down("#deleteBtn").setDisabled(!1),e.down("#addBtn").setDisabled(!1)):(n&&i.data.locked?(e.down("#deleteBtn").setDisabled(!0),e.down("#modifyBtn").setDisabled(!0),e.down("#duplicateBtn").setDisabled(!0)):(e.down("#deleteBtn").setDisabled(!1),e.down("#modifyBtn").setDisabled(!1),e.down("#duplicateBtn").setDisabled(!1)),e.down("#addBtn").setDisabled(!1))}}),Ext.define("Plugins.grid.GridInfoColumnPlugin",{extend:"Ext.AbstractPlugin",alias:"widget.plugin.infocolumn",statics:{configure:function(t){t.columns.push({xtype:"gridcolumn",renderer:function(t,e,n,i,d,o,l){return void 0!==l&&null!==l?n.get("added")?'<div class="fa fa-plus" style="height:16px !important;" data-qtip="Ajouté">&nbsp;</div>':n.get("modified")?'<div class="fa fa-edit" style="height:16px !important;" data-qtip="Modifié">&nbsp;</div>':n.get("deleted")?'<div class="fa fa-trash-o" style="height:16px !important;" data-qtip="A supprimer">&nbsp;</div>':"":""},itemId:"actionColumn",maxWidth:28,minWidth:28,width:28,menuDisabled:!0,draggable:!1,enableColumnHide:!1,hideable:!1})}},config:{toolbarSelector:null},pluginId:"infocolumn",init:function(t){this.grid=t}}),Ext.define("Plugins.grid.GridSearchPlugin",{extend:"Ext.AbstractPlugin",alias:"widget.plugin.searchgrid",statics:{doLocalSearch:function(t,e){var n=e.getStore(),i=t.getStore();i.clearFilter(),0!=n.getCount()&&i.filterBy(function(t){var e=!1;return n.each(function(n){var i=!0,d=n.getData();for(var o in d)if(d[o]&&"id"!=o&&(t.get(o)===!1||0==t.get(o)||t.get(o))){var l=d[o].filterValue,a=d[o].filterOp,s=t.get(o);switch(a){case"eq":l.toUpperCase()!=s.toUpperCase()&&(i=!1);break;case"eqBool":var r="all"==l;r||"yes"!=l||s!==!1||(i=!1),r||"no"!=l||s!==!0||(i=!1);break;case"diff":l.toUpperCase()==s.toUpperCase()&&(i=!1);break;case"start":Ext.String.startsWith(s,l,!0)||(i=!1);break;case"contains":s.toUpperCase().indexOf(l.toUpperCase())<0&&(i=!1);break;case"end":Ext.String.endsWith(s,l,!0)||(i=!1);break;case"eqDate":l()!==s&&(i=!1);break;case"eqNbr":l()!=s&&(i=!1);break;case"gtNbr":l()<=s&&(i=!1);break;case"lteNbr":l()>s&&(i=!1);break;case"gteNbr":l()<s&&(i=!1);break;case"ltNbr":l()>=s&&(i=!1);break;case"diffNbr":l()==s&&(i=!1)}}i&&(e=!0)}),e})},configure:function(t,e){e.searchObj={};var n=[],i=[];t.columns.forEach(function(t){t.dataIndex&&i.push({name:t.dataIndex})});var d,o=new Ext.data.Store({fields:i});d={xtype:"rownumberer"},n.push(d),t.columns.forEach(function(t){if(t.createFilter){switch(d={},d.dataIndex=t.dataIndex,d.initFilterValue=t.initFilterValue||null,d.width=t.filterWidth||t.width,t.filterFlex&&(d.flex=t.filterFlex),d.xtype="widgetcolumn",t.bind?d.text=translate(t.config.bind.text.substring(7,t.config.bind.text.length-1)):d.text=t.text,d.widget={},d.widget.xtype="textfilter",t.filterType){case"combobox":d.widget.xtype="combofilter",t.filterValues&&(d.widget.filterValues=t.filterValues);break;case"boolean":d.widget.xtype="booleanfilter";break;case"numeric":d.widget.xtype="numericfilter";break;case"date":d.widget.xtype="datefilter";break;case"time":d.widget.xtype="timefilter"}d.onWidgetAttach=function(e,n,i){var d=n,o={};e.initFilterValue&&(o=t.initFilterValue,d.setValue(o))},d.widget.dataIndex=d.dataIndex,n.push(d)}}),e.reconfigure(o,n)}},config:{toolbarSelector:null},pluginId:"gridsearch",init:function(t){this.grid=t;var e=t.query("#searchToolbar");1==e.length?(this.tb=e[0],this.fillToolbar()):0==e.length&&(this.tb=this.createNewToolbar(),this.fillToolbar(),t.addDocked(this.tb))},createNewToolbar:function(){var t=Ext.create("Ext.toolbar.Toolbar",{dock:"top",itemId:"searchToolbar"});return t},fillToolbar:function(){this.createAddBtnCtn(),this.createDeleteBtnCtn(),this.createResetBtnCtn(),this.createApplyBtnCtn(),this.tb.add({xtype:"tbfill"}),this.tb.add(this.addSearchBtnCtn),this.tb.add(this.resetBtnCtn),this.tb.add(this.deleteSearchBtnCtn),this.tb.add(this.applyBtnCtn)},createResetBtnCtn:function(){var t=this;this.resetBtnCtn=Ext.create("Ext.container.Container",{itemId:"resetBtnCtn",items:[{xtype:"button",text:"",tooltip:"Delete All Search Criteria",itemId:"resetSearchBtn",glyph:"xf014@FontAwesome",listeners:{click:function(){t.grid.getStore().removeAll()}}}]})},createApplyBtnCtn:function(){var t=this;this.applyBtnCtn=Ext.create("Ext.container.Container",{itemId:"applySearchBtnCtn",items:[{xtype:"button",text:"Apply Search",tooltip:"Apply Search",itemId:"applySearchBtn",glyph:"xf002@FontAwesome",listeners:{click:function(e,n,i){var d=t.grid.searchObj;t.grid.fireEvent("applySearch",d)}}}]})},createAddBtnCtn:function(){var t=this;this.addSearchBtnCtn=Ext.create("Ext.container.Container",{itemId:"addSearchBtnCtn",items:[{xtype:"button",itemId:"addSearchBtn",glyph:"xf00e@FontAwesome",text:"",tooltip:"Add Search Criteria",listeners:{click:function(){var e=t.grid.getStore();e.insert(e.getCount(),{})}}}]})},createDeleteBtnCtn:function(){var t=this;this.deleteSearchBtnCtn=Ext.create("Ext.container.Container",{itemId:"deleteSearchBtnCtn",items:[{xtype:"button",itemId:"deleteSearchBtn",glyph:"xf010@FontAwesome",text:"",tooltip:"Delete selected Criteria",listeners:{click:function(e,n,i){t.grid.getStore().remove(t.grid.getSelectionModel().getSelection())}}}]})}});
Ext.define("Ext.ux.inputs.AdvancedCombobox",{extend:"Ext.form.field.ComboBox",alias:"widget.advancedCombobox",multiSelect:!1,selectOnFocus:!0,queryMode:"local",initComponent:function(){this.callParent()},createPicker:function(){var e,t=this,o=Ext.apply({xtype:"btnboundlist",pickerField:t,selectionModel:t.pickerSelectionModel,floating:!0,hidden:!0,store:t.getPickerStore(),displayField:t.displayField,preserveScrollOnRefresh:!0,pageSize:t.pageSize,tpl:t.tpl},t.advancedListConfig);return e=t.picker=Ext.widget(o),t.pageSize,e.on({comboAddItemEvent:function(){t.fireEvent("comboEditEvent",t,t.rawValue)},comboEditItemEvent:function(){t.fireEvent("comboAddEvent",t,t.getValue())},scope:t}),e.getNavigationModel().navigateOnSpace=!1,e}}),Ext.define("Ext.ux.inputs.ComboBoundList",{extend:"Ext.view.BoundList",alias:"widget.btnboundlist",initComponent:function(){var e=this;e.minWidth=100,e.pagingToolbar=Ext.create("Ext.toolbar.Toolbar",{border:!1,ownerCt:e,ownerLayout:e.getComponentLayout(),items:[{xtype:"button",glyph:"xf067@FontAwesome",handler:function(){e.fireEvent("comboAddItemEvent",e,e.pickerField.getValue())}},{xtype:"button",glyph:"xf040@FontAwesome",handler:function(){e.fireEvent("comboEditItemEvent",e,e.rawValue)}}],bindStore:function(e,t){}}),e.callParent()}});
function translate(e){var t={study:"Examen",allStudy:"Tous les examens",Doctor:"Médecin",patientIdentity:"Identité patient",gender:"Sexe",civility:"Civilité",date:"Date",hour:"Heure",firstName:"Préhnom",lastName:"Last name",birthday:"Date de naissance",birthname:"Nom de naissance",referringDoctor:"Méd.Traitant",InsNumber:"N°Sécu I.N.S",secuNumber:"N°Sécu",pregnant:"Enceinte",address:"Adresse",zipCode:"Code postal","city ":"Commune",phone:"Tél",mobile:"Portable",email:"E-mail",free:"Gratuit",hospitalized:"Hospitalisé",emergency:"Urgence",studies:"Les examens",addStudy:"Ajouter un examen",price:"Prix",device:"Appareil",contactInformation:"Coordonnées",enterAtLeast4Characters:"Enter a least 4 characters",active:"Active"};return t[e]||e}function translate(e){var t={Filter:"Filtre",active:"Actif",save:"Enregistrer",cancel:"Annuler",quit:"Quitter",edit:"Editer",modify:"Modifier",delete:"Supprimer",add:"Ajouter",name:"Nom",saveError:"le formulaire n'a pas été enregistré correctement",enterAtLeast4Characters:"Saisir au moins 4 caractères",site:"Site",type:"Type",pdf:"PDF",doctor:"Médecin",time:"Heure",comment:"Commentaire",clickToSavePreference:"Cliquer pour sauvegarder vos préférences","first name":"Prénom","last name":"Nom",gender:"Sexe",title:"Civilité",city:"Ville","zip code":"C.P",phone:"Tél.",fax:"Fax",email:"E-mail",yes:"Oui",no:"Non","the referring physicians":"Les Prescripteurs",clickToAddNewRow:"Ajouter une nouvelle ligne",clickToDuplicateRow:"Dupliquer les lignes sélectionnées",clickToDeleteTheSelection:"Supprimer les lignes sélectionnées",clickToModifySelection:"Modifier la ligne sélectionnée",modificationsHistory:"Voir l'historique des modifications",clickToSaveModifications:"Enregistrer les modifications",clickToCancelModifications:"Annuler les modifications","gridEdit.quitEditionTitle":"Quitter l'édition","gridEdit.quitEditionMsg":"Voulez vous quittez le mode d'édition?",displayModifiedRows:"Afficher seulement les modifications",applyChTitle:"Confirmation",ApplyModification:"Appliquer les modifications?",submitMsg:"Enregistrer","msg.comment":"Commentaire",liveSearch:"Recherche rapide",home:"Accueil","menu.settings":"Paramétrage","menu.users":"Utilisateurs","menu.devices":"Appareils","menu.studies":"Examens","menu.favorite":"Favoris","menu.sites":"Sites","menu.referring physicians":"Prescripteurs",error:"Erreur",siteConfigIsNotFound:"La configuration du site n'a pas été trouvée",restorePreferenceError:"Vos préférences n'ont pas été récupérées",InvalidLoginOrPassword:"Nom d'utilisateur ou mot de passe invalide",VerificationEnCours:"Vérification en cours, veuillez patienter....",Saving:"Enregistrement en cours...",loadingIndexedDB:"Chargement des données en cache,veuillez patienter....",infoMsg:"Information",preferenceSavedSuccessfully:"Vos préférences ont été  enregistrées","ApplyModification?":"Voulez vous enregistrer les modifications?",cancelTitle:"Annulation",cancelMsg:"Souhaitez vous annuler les modifications?",study:"Examen",invalidSocialNumber:"Numéro de sécurité sociale invalide",invalidKey:"Clé invalide",allStudy:"Tous les examens",Doctor:"Médecin",patientIdentity:"Identité patient",gender:"Sexe",civility:"Civilité",recieving:"Accueil de ",firstName:"Prénom",lastName:"Nom",birthday:"Date de naissance",birthname:"Nom de naissance",referringDoctor:"Méd.Traitant",InsNumber:"N°Sécu I.N.S",secuNumber:"N°Sécu",pregnant:"Enceinte",address:"Adresse",zipCode:"Code postal","city ":"Commune",phone:"Tél",mobile:"Portable",email:"E-mail",contactInformation:"Coordonnées",visitInformation:"Informations consultation",date:"Date",hour:"Heure",addStudy:"Ajouter un examen",free:"Gratuit",hospitalized:"Hospitalisé",emergency:"Urgence",studies:"Les examens",price:"Prix",device:"Appareil",hospitVisitNumber:"N° séjour",history:"Historique",path:"Appareil","By Social Card":"C.V","C. Info":"C.info","P.Info":"P.Info",birthday:"Naissance",studies:"Examens",worklistDoctor:"Méd.","consultant Ph.":"Traitant",worklistMedPresc:"Presc.",worklistMedRecipient:"Correspondants",dictation:"Dictée","worklist Report":"C.R.","worklist quotation":"Cot.","P. due":"Dû P.",visit:"Consultation",patient:"Patient",free:"Gratuit","hospit.":"Hospit.",urgent:"Urgence","Visit Numbers":"N.consults","Invoice type":"Type facture",duV:"Du. Consult",actions:"Actions",print:"Imprimer","All Studies":"Tous les examens","Studies associated to selected device":"Les examens associés à l'appreil selectionné","Select Study":"Choisir un examen",Device:"Appareil","Device Type":"Type appareil","Device & Studies":"Appareil & examens",modality:"Modalité","A.E.T":"A.E.T","agreement number":"N°Agrément","agreement date":"Date Agr.",marque:"Marque",installation:"Installation",power:"Puissance",Support:"Support","Lecture?":"Lecture?","Senolog?":"Senolog?"};return t[e]||e}Ext.form.DateField.prototype.format="d/m/Y",Ext.form.TimeField.prototype.format="H:i",Ext.grid.column.Date.prototype.format="d/m/Y";var translateUtil={transGrid:function(e){e.setTitle(translate(e.title)),e.columns.forEach(function(e){e.setText(translate(e.text))})},transBtns:function(e){var t=e.query("button");t.forEach(function(e){e.text&&e.setText(translate(e.text)),e.tooltip&&e.setTooltip(translate(e.tooltip))})},transInputs:function(e){var t=e.query("combobox"),i=e.query("textfield");t.forEach(function(e){e.fieldLabel&&e.setFieldLabel(translate(e.fieldLabel)),e.emptyText&&e.setEmptyText(translate(e.emptyText))}),i.forEach(function(e){e.fieldLabel&&e.setFieldLabel(translate(e.fieldLabel)),e.emptyText&&e.setEmptyText(translate(e.emptyText))})},transPanel:function(e){e.setTitle(e.title);var t=e.query("panel");t.forEach(function(e){e.title&&e.setTitle(translate(e.title))})},transAll:function(e){this.transGrid(e),this.transBtns(e)}};
Ext.define("Plugins.Clock",{extend:"Ext.toolbar.TextItem",alias:"widget.trayclock",cls:"ux-desktop-trayclock",html:"&#160;",timeFormat:"H:i",tpl:"{time}",initComponent:function(){var e=this;e.callParent(),"string"==typeof e.tpl&&(e.tpl=new Ext.XTemplate(e.tpl))},afterRender:function(){var e=this;Ext.Function.defer(e.updateTime,100,e),e.callParent()},onDestroy:function(){var e=this;e.timer&&(window.clearTimeout(e.timer),e.timer=null),e.callParent()},updateTime:function(){var e=this,t=Ext.Date.format(new Date,e.timeFormat),n=e.tpl.apply({time:t});e.lastText!=n&&(e.setText(n),e.lastText=n),e.timer=Ext.Function.defer(e.updateTime,1e4,e)}}),Ext.define("Plugins.KeyDownPlugin",{extend:"Ext.AbstractPlugin",alias:"plugin.keydownplugin",config:{},init:function(e){var t=this,n=[];t.element=e,Ext.isDefined(t.element.hotkey)&&!Ext.isEmpty(t.element.hotkey)&&(Ext.get(document.body).on("keydown",function(e){e=e||event,e.altKey&&(n[e.keyCode]="keydown"==e.type,t.element.fireEvent("hotkeyPressed",t.element,e,n))}),Ext.get(document.body).on("keyup",function(e){e=e||event,n[e.keyCode]="keydown"==e.type,t.element.fireEvent("hotkeyPressed",t.element,e,n)}))}}),Ext.define("Admin.view.main.MainContainerWrap",{extend:"Ext.container.Container",xtype:"maincontainerwrap",requires:["Ext.layout.container.HBox"],scrollable:"y",layout:{type:"hbox",align:"stretchmax",animate:!0,animatePolicy:{x:!0,width:!0}},beforeLayout:function(){var e=this,t=Ext.Element.getViewportHeight()-64,n=e.getComponent("navigationTreeList");e.minHeight=t,n.setStyle({"min-height":t+"px"}),e.callParent(arguments)}});
Ext.define("Plugins.panel.TreeMultiSelect",{extend:"Ext.AbstractPlugin",alias:"widget.plugin.treemultiselect",config:{toolbarSelector:null},showConfirmationOnSave:!0,pluginId:"treemultiselect",init:function(t){this.panel=t,this.selectedTree=this.panel.down("#selectedTreePanel"),this.availableTree=this.panel.down("#availableTreePanel"),t.inEdition=!1;var e=t.query("#editingtoolbar");1==e.length?(this.tb=e[0],this.fillToolbar()):0==e.length&&(this.tb=this.createNewToolbar(),this.fillToolbar(),t.addDocked(this.tb))},lockPanel:function(t){this.restorePanel(),t&&this.editBtnCtn.hide()},restorePanel:function(){var t=this;t.editBtnCtn.show(),t.saveBtnCtn.hide(),t.cancelBtnCtn.hide(),t.quitBtnCtn.hide(),t.chHistBtnCtn.show()},createNewToolbar:function(){var t=Ext.create("Ext.toolbar.Toolbar",{dock:"top",itemId:"editingtoolbar"});return t},fillToolbar:function(){this.createEditBtnCtn(),this.createCancelBtnCtn(),this.createSaveBtnCtn(),this.createChHistBtnCtn(),this.createQuitBtnCtn(),this.tb.add(this.editBtnCtn),this.tb.add({xtype:"tbfill"}),this.tb.add(this.saveBtnCtn),this.tb.add(this.cancelBtnCtn),this.tb.add(this.quitBtnCtn),this.tb.add(this.chHistBtnCtn)},createEditBtnCtn:function(){var t=this;this.editBtnCtn=Ext.create("Ext.container.Container",{itemId:"editBtnCtn",hidden:!0,items:[{xtype:"button",tooltip:"${Editer}",itemId:"editBtn",glyph:"xf040@FontAwesome",listeners:{click:function(e,n,i){t.enterEditMode(),t.panel.fireEvent("inEdit",t.panel)}}}]})},createCancelBtnCtn:function(){var t=this;this.cancelBtnCtn=Ext.create("Ext.container.Container",{itemId:"cancelBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"cancelBtn",glyph:"xf0e2@FontAwesome",disabled:!0,tooltip:"${Cancel}",listeners:{click:function(e,n,i){var a=Ext.create("Common.ux.window.PromptWindow",{withClose:!1});a.setTitle("${panelEdit.cancelTitle}"),a.down("#confirmMsg").setText("${panelEdit.cancelMsg}"),a.down("#description").hide(),a.down("#inputText").hide(),a.query("button")[0].setText("${yes}"),a.query("button")[1].setText("${no}"),a.callbackFunction=function(e,n){"ok"===e?(t.cancelEdit(),t.panel.fireEvent("resetEdit"),a.close()):a.close()},a.show()}}}]})},createSaveBtnCtn:function(){var t=this;this.saveBtnCtn=Ext.create("Ext.container.Container",{itemId:"saveBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"saveBtn",disabled:!0,glyph:"xf0c7@FontAwesome",tooltip:"Enregistrer les modifications",listeners:{click:function(e,n,i){if(t.showConfirmationOnSave){var a=[],s=[];Ext.each(t.selectedTree.getStore().query("added",!0).items,function(e){if(e.validate().isValid())a.push(e.data);else{var n=t.panel.store.indexOf(e);n++,s.push(n)}}),Ext.each(t.selectedTree.getStore().query("modified",!0).items,function(e){if(!e.get("added"))if(e.validate().isValid())a.push(e.data);else{var n=t.panel.store.indexOf(e);n++,s.push(n)}});var o;if(Ext.each(t.availableTree.getStore().query("added",!0).items,function(t){o=t,o.set("toDelete",!0),o.set("added",!1),a.push(o.data)}),s.length>0)Ext.MessageBox.show({title:"${saveError}",msg:"${saveErrorMsg}"+s,icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK});else{var l=Ext.create("Common.ux.window.PromptWindow",{withClose:!1,closable:!1});l.setTitle("${panelEdit.applyChTitle}"),l.down("#confirmMsg").setText("${panelEdit.applyChMsg}"),l.query("button")[0].setText("${yes}"),l.query("button")[1].setText("${no}"),l.down("#description").setText("${panelEdit.comment}"),l.callbackFunction=function(e,n){"ok"===e?(Utility.loading.start(l.query("button")[0]),t.panel.fireEvent("saveEdit",t.panel,l,a,n)):l.close()},l.show()}}else t.panel.fireEvent("saveEdit",t.panel)}}}]})},createChHistBtnCtn:function(){var t=this;this.chHistBtnCtn=Ext.create("Ext.container.Container",{itemId:"chHistBtnCtn",items:[{xtype:"button",itemId:"chHistBtn",glyph:"xf073@FontAwesome",tooltip:"${chHist}",listeners:{click:function(e,n,i){t.panel.fireEvent("chHist",t.panel)}}}]})},createQuitBtnCtn:function(){var t=this;this.quitBtnCtn=Ext.create("Ext.container.Container",{itemId:"quitBtnCtn",hidden:!0,items:[{xtype:"button",itemId:"quitBtn",glyph:"xf08b@FontAwesome",tooltip:"${Quitter}",listeners:{click:function(e,n,i){var a=Ext.create("Common.ux.window.PromptWindow",{withClose:!1});a.setTitle("${panelEdit.quitEditionTitle}"),a.down("#confirmMsg").setText("${panelEdit.quitEditionMsg}"),a.down("#description").hide(),a.down("#inputText").hide(),a.query("button")[0].setText("${yes}"),a.query("button")[1].setText("${no}"),a.callbackFunction=function(e,n){"ok"===e?(a.close(),t.panel.fireEvent("quitEdit")):a.close()},a.show()}}}]})},enterEditMode:function(){var t=this;t.panel.inEdition=!0,t.editBtnCtn.hide(),t.cancelBtnCtn.show(),t.saveBtnCtn.show(),t.quitBtnCtn.show(),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0)},quitEditMode:function(){var t=this;t.panel.inEdition=!1,t.restorePanel()},cancelEdit:function(){var t=this;t.cancelBtnCtn.down("#cancelBtn").setDisabled(!0),t.saveBtnCtn.down("#saveBtn").setDisabled(!0),t.editBtnCtn.hide()},checkIfModifications:function(t,e){var n=this;t.query("added",!0).items.length>0||e.query("added",!0).items.length>0||e.query("modified",!0).items.length>0?(n.saveBtnCtn.down("#saveBtn").setDisabled(!1),n.cancelBtnCtn.down("#cancelBtn").setDisabled(!1)):(n.saveBtnCtn.down("#saveBtn").setDisabled(!0),n.cancelBtnCtn.down("#cancelBtn").setDisabled(!0))}});
var StudyHelper={onStudyCodeComboBoxChange:function(o,d,t,r){if(!this.doctorId||!this.siteId)throw console.error("function initGrid : doctorId and siteId required "),new Error("StudyVisitGrid function initGrid : doctorId and siteId are required ");r.doctorId;StudyDirect.docHasstudyAutoComplete(d,t,"StudyComboStore",o,!0,3,d.doctorId)}};
var Connection={directApi:"http://localhost:3000/directapi"};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Dexie=t()}(this,function(){"use strict";function e(){}function t(e){return e}function n(e,n){return null==e||e===t?n:function(t){return n(e(t))}}function r(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function i(t,n){return t===e?n:function(){var e=t.apply(this,arguments);void 0!==e&&(arguments[0]=e);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=n.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?r(i,this.onsuccess):i),o&&(this.onerror=this.onerror?r(o,this.onerror):o),void 0!==a?a:e}}function o(t,n){return t===e?n:function(){t.apply(this,arguments);var e=this.onsuccess,i=this.onerror;this.onsuccess=this.onerror=null,n.apply(this,arguments),e&&(this.onsuccess=this.onsuccess?r(e,this.onsuccess):e),i&&(this.onerror=this.onerror?r(i,this.onerror):i)}}function a(t,n){return t===e?n:function(){var e=t.apply(this,arguments);l(arguments[0],e);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=n.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?r(i,this.onsuccess):i),o&&(this.onerror=this.onerror?r(o,this.onerror):o),void 0===e?void 0===a?void 0:a:l(e,a)}}function u(t,n){return t===e?n:function(){return t.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function s(t,n){return t===e?n:function(){return n.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function c(t,n){return t===e?n:function(){var e=t.apply(this,arguments);if(e&&"function"==typeof e.then){var r=this,i=arguments;return e.then(function(){return n.apply(r,i)})}return n.apply(this,arguments)}}function l(e,t){return"object"!=typeof t?e:(ie(t).forEach(function(n){e[n]=t[n]}),e)}function f(e,t){"function"==typeof t&&(t=t(Object.getPrototypeOf(e))),ie(t).forEach(function(n){d(e,n,t[n])})}function d(e,t,n,r){Object.defineProperty(e,t,l("function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function h(e){return{from:function(t){return e.prototype=Object.create(t.prototype),d(e.prototype,"constructor",e),{extend:f.bind(null,e.prototype)}}}}function v(e,t,n){return ue.call(e,t,n)}function p(e,t){return t(e)}function g(e){var t=setTimeout(e,1e3);clearTimeout(t)}function y(e){if(!e)throw new ve.Internal("Assertion failed")}function m(e){ae.setImmediate?setImmediate(e):setTimeout(e,0)}function b(e,t){try{e()}catch(e){t&&t(e)}}function w(e){var t=e&&e.stack;return t?t.indexOf(e+"")>0?t:e+". "+t:e}function _(e){if(e.stack)return e;try{var t=new Error(e.message||e);if(t.stack)return e.stack=t.stack,e;throw t}catch(t){e.stack=t.stack}return e}function S(e){return F.reject(_(e))}function x(e,t){if(e.hasOwnProperty(t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var o=x(e,t[r]);n.push(o)}return n}var a=t.indexOf(".");if(a!==-1){var u=e[t.substr(0,a)];return void 0===u?void 0:x(u,t.substr(a+1))}}function P(e,t,n){if(e&&void 0!==t&&!("isFrozen"in Object&&Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){y("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)P(e,t[r],n[r])}else{var o=t.indexOf(".");if(o!==-1){var a=t.substr(0,o),u=t.substr(o+1);if(""===u)void 0===n?delete e[a]:e[a]=n;else{var s=e[a];s||(s=e[a]={}),P(s,u,n)}}else void 0===n?delete e[t]:e[t]=n}}function D(e,t){"string"==typeof t?P(e,t,void 0):"length"in t&&[].map.call(t,function(t){P(e,t,void 0)})}function k(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function E(e){if(!e||"object"!=typeof e)return e;var t;if(oe(e)){t=[];for(var n=0,r=e.length;n<r;++n)t.push(E(e[n]))}else if(e instanceof Date)t=new Date,t.setTime(e.getTime());else{t=e.constructor?Object.create(e.constructor.prototype):{};for(var i in e)e.hasOwnProperty(i)&&(t[i]=E(e[i]))}return t}function I(e,t,n,r){n=n||{},r=r||"";for(var i in e)if(e.hasOwnProperty(i))if(t.hasOwnProperty(i)){var o=e[i],a=t[i];"object"==typeof o&&"object"==typeof a?I(o,a,n,r+i+"."):o!==a&&(n[r+i]=t[i])}else n[r+i]=void 0;for(i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(n[r+i]=t[i]);return n}function C(e,t){this.name=e,this.message=t}function O(e,t){return e+". Errors: "+t.map(function(e){return e.toString()}).filter(function(e,t,n){return n.indexOf(e)===t}).join("\n")}function A(e,t,n,r){this.name="ModifyError",this.failures=t,this.failedKeys=r,this.successCount=n,this.message=O(e,t)}function T(e,t){this.name="BulkError",this.failures=t,this.message=O(e,t)}function j(e,t){var n=e;return e instanceof C||!e.name||!pe[e.name]||(n=new pe[e.name](t||e.message,e),e.stack&&(n.stack=e.stack)),n}function B(t){function n(t,n,o){if(oe(t))return i(t);if("object"==typeof t)return r(t);n||(n=u),o||(o=e);var c={subscribers:[],fire:o,subscribe:function(e){c.subscribers.push(e),c.fire=n(c.fire,e)},unsubscribe:function(e){c.subscribers=c.subscribers.filter(function(t){return t!==e}),c.fire=c.subscribers.reduce(n,o)}};return a[t]=s[t]=c,c}function r(e){ie(e).forEach(function(t){var r=e[t];if(oe(r))n(t,e[t][0],e[t][1]);else{if("asap"!==r)throw new ve.InvalidArgument("Invalid event config");var i=n(t,null,function(){var e=arguments;i.subscribers.forEach(function(t){m(function(){t.apply(ae,e)})})});i.subscribe=function(e){i.subscribers.indexOf(e)===-1&&i.subscribers.push(e)},i.unsubscribe=function(e){var t=i.subscribers.indexOf(e);t!==-1&&i.subscribers.splice(t,1)}}})}function i(e){function t(){return!r&&void(r=!0)}var r=!1;e.forEach(function(e){n(e).subscribe(t)})}var o=arguments,a={},s=function(e,n){if(n){var r=v(arguments,1),i=a[e];return i.subscribe.apply(i,r),t}if("string"==typeof e)return a[e]};s.addEventType=n;for(var c=1,l=o.length;c<l;++c)n(o[c]);return s}function N(){var e=we;we=[];for(var t=0,n=e.length;t<n;++t){var r=e[t];r[0].apply(ae,r[1])}}function F(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],this._catched=!1;var t=this,n=!0;this._PSD=F.PSD;try{W(this,e,function(e){n?me(R,t,e):R(t,e)},function(e){return n?(me(U,t,e),!1):U(t,e)})}finally{n=!1}}function K(e,t){if(null===e._state)return void e._deferreds.push(t);var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);var r,i=be;be=!1,me=Se;try{var o=F.PSD;F.PSD=e._PSD,r=n(e._value),e._state||r&&"function"==typeof r.then&&r._state===!1||V(e),t.resolve(r)}catch(e){t.reject(e)}finally{if(F.PSD=o,i){do{for(;we.length>0;)N();var a=_e.pop();if(a)try{a()}catch(e){}}while(_e.length>0||we.length>0);me=ye,be=!0}}}function M(e){var t=be;be=!1,me=Se;try{return e()}finally{if(t){do{for(;we.length>0;)N();var n=_e.pop();if(n)try{n()}catch(e){}}while(_e.length>0||we.length>0);me=ye,be=!0}}}function V(e){e._catched=!0,e._parent&&!e._parent._catched&&V(e._parent)}function R(e,t){var n=F.PSD;F.PSD=e._PSD;try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then)return t instanceof F&&null!==t._state?(e._state=t._state,e._value=t._value,void q.call(e)):void W(e,function(e,n){t.then(e,n)},function(t){R(e,t)},function(t){U(e,t)});e._state=!0,e._value=t,q.call(e)}catch(e){U(e)}finally{F.PSD=n}}function U(e,t){var n=F.PSD;if(F.PSD=e._PSD,e._state=!1,e._value=t,q.call(e),!e._catched)try{e.onuncatched?e.onuncatched(e._value):F.on.error.fire(e._value)}catch(e){}return F.PSD=n,e._catched}function q(){for(var e=0,t=this._deferreds.length;e<t;e++)K(this,this._deferreds[e]);this._deferreds=[]}function L(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}function W(e,t,n,r){var i=!1;try{t(function(e){i||(i=!0,n(e))},function(t){return i?e._catched:(i=!0,r(t))})}catch(e){if(i)return;return r(e)}}function z(e){console.warn("Uncaught Promise: "+w(e))}function H(r,u){function g(){Xe.on("versionchange",function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '"+Xe.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+Xe.name+"'. Closing db now to resume the delete request."),Xe.close()}),Xe.on("blocked",function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+Xe.name+"') was blocked"):console.warn("Upgrade '"+Xe.name+"' blocked by other connection holding version "+e.oldVersion/10)})}function y(e){this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function w(e,t,n,r){if(0===e){ie(Ue).forEach(function(e){C(t,e,Ue[e].primKey,Ue[e].indexes)});var i=Xe._createTransaction(Qe,Le,Ue);i.idbtrans=t,i.idbtrans.onerror=J(n,["populating database"]),i.on("error").subscribe(n),F.newPSD(function(){F.PSD.trans=i;try{Xe.on("populate").fire(i)}catch(e){r.onerror=t.onerror=function(e){e.preventDefault()};try{t.abort()}catch(e){}t.db.close(),n(e)}})}else{var o=[],a=qe.filter(function(t){return t._cfg.version===e})[0];if(!a)throw new ve.Upgrade("Dexie specification of currently installed DB version is missing");Ue=Xe._dbSchema=a._cfg.dbschema;var u=!1,s=qe.filter(function(t){return t._cfg.version>e});s.forEach(function(e){var r=Ue,i=e._cfg.dbschema;je(r,t),je(i,t),Ue=Xe._dbSchema=i;var a=D(r,i);a.add.forEach(function(e){o.push(function(t,n){C(t,e[0],e[1].primKey,e[1].indexes),n()})}),a.change.forEach(function(e){if(e.recreate)throw new ve.Upgrade("Not yet support for changing primary key");o.push(function(t,n){var r=t.objectStore(e.name);e.add.forEach(function(e){K(r,e)}),e.change.forEach(function(e){r.deleteIndex(e.name),K(r,e)}),e.del.forEach(function(e){r.deleteIndex(e)}),n()})}),e._cfg.contentUpgrade&&o.push(function(t,r){u=!0;var o=Xe._createTransaction(Qe,v(t.db.objectStoreNames),i);o.idbtrans=t;var a=0;o._promise=p(o._promise,function(e){return function(t,n,i){function o(e){return function(){e.apply(this,arguments),0===--a&&r()}}return++a,e.call(this,t,function(e,t){arguments[0]=o(e),arguments[1]=o(t),n.apply(this,arguments)},i)}}),t.onerror=J(n,["running upgrader function for version",e._cfg.version]),o.on("error").subscribe(n),e._cfg.contentUpgrade(o),0===a&&r()}),u&&!Ce||o.push(function(e,t){N(i,e),t()})});var c=function(){try{o.length?o.shift()(t,c):O(Ue,t)}catch(e){r.onerror=t.onerror=function(e){e.preventDefault()};try{t.abort()}catch(e){}t.db.close(),n(e)}};c()}}function D(e,t){var n={del:[],add:[],change:[]};for(var r in e)t[r]||n.del.push(r);for(r in t){var i=e[r],o=t[r];if(i){var a={name:r,def:t[r],recreate:!1,del:[],add:[],change:[]};if(i.primKey.src!==o.primKey.src)a.recreate=!0,n.change.push(a);else{var u=i.indexes.reduce(function(e,t){return e[t.name]=t,e},{}),s=o.indexes.reduce(function(e,t){return e[t.name]=t,e},{});for(var c in u)s[c]||a.del.push(c);for(c in s){var l=u[c],f=s[c];l?l.src!==f.src&&a.change.push(f):a.add.push(f)}(a.recreate||a.del.length>0||a.add.length>0||a.change.length>0)&&n.change.push(a)}}else n.add.push([r,o])}return n}function C(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(e){K(i,e)}),i}function O(e,t){ie(e).forEach(function(n){t.db.objectStoreNames.contains(n)||C(t,n,e[n].primKey,e[n].indexes)})}function N(e,t){for(var n=0;n<t.db.objectStoreNames.length;++n){var r=t.db.objectStoreNames[n];null!==e[r]&&void 0!==e[r]||t.db.deleteObjectStore(r)}}function K(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function M(){$e.forEach(function(e){e.resume()})}function V(e,t){throw new ve.InvalidTable("Table "+t[0]+" not part of transaction. Original Scope Function Source: "+H.Promise.PSD.trans.scopeFunc.toString())}function R(r,u,s,c){this.name=r,this.schema=s,this.hook=We[r]?We[r].hook:B(null,{creating:[i,e],reading:[n,t],updating:[a,e],deleting:[o,e]}),this._tpf=u,this._collClass=c||ue}function U(e,t,n,r){R.call(this,e,t,n,r||se)}function q(e,t){var n=F.PSD;return function(r){try{r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault();var i=r.target.error;e.push(i),r.target._err&&F.usePSD(n,r.target._err.bind(null,i))}finally{t&&t()}}}function L(e){var t=F.PSD;return function(n){var r;try{r=n.target.error,n.target._err&&F.usePSD(t,n.target._err.bind(null,r))}finally{e(r)}}}function W(e,t){var n=F.PSD;return t?function(t){var r;try{r=t.target.result,t.target._suc&&F.usePSD(n,t.target._suc.bind(null,r))}finally{e&&e(r)}}:function(t){e(t.target.result)}}function z(e,t,n,r,i){return new F(function(o,a){var u=n.length,s=u-1;if(0===u)return o();if(r){var c={onsuccess:null,onerror:null},l=L(function(e){return a(j(e))}),f=W(null,!0);b(function(){for(var r=0;r<u;++r){var a=n[r];i.call(c,a[0],a[1],t);var d=e.delete(a[0]);c.onerror&&(d._err=c.onerror),c.onsuccess&&(d._suc=c.onsuccess),d.onerror=l,r===s?d.onsuccess=W(o,!0):d.onsuccess=f,c.onsuccess=null,c.onerror=null}},function(e){throw c.onerror&&c.onerror(e),e})}else for(var d=0;d<u;++d){var h=e.delete(n[d]);h.onerror=function(e){return a(j(e.target.error))},d===s&&(h.onsuccess=function(){return o()})}})}function G(e,t,n,r){function i(e,t,n,r){return o._promise(e,n,r)}var o=this;this.db=Xe,this.mode=e,this.storeNames=t,this.idbtrans=null,this.on=B(this,["complete","error"],"abort"),this._reculock=0,this._blockedFuncs=[],this._psd=null,this.active=!0,this._dbschema=n,r&&(this.parent=r),this._tpf=i,this.tables=Object.create(ze);for(var a=t.length-1;a!==-1;--a){var u=t[a],s=Xe._tableFactory(e,n[u],i);this.tables[u]=s,this[u]||(this[u]=s)}}function ae(e,t,n){this._ctx={table:e,index:":id"===t?null:t,collClass:e._collClass,or:n}}function ue(e,t){var n=null,r=null;if(t)try{n=t()}catch(e){r=_(j(e))}var i=e._ctx,o=i.table;this._ctx={table:o,index:i.index,isPrimKey:!i.index||o.schema.primKey.keyPath&&i.index===o.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueFilter:o.hook.reading.fire}}function se(){ue.apply(this,arguments)}function ce(e,t){return e._cfg.version-t._cfg.version}function le(e,t,n,r,i,o){n.forEach(function(n){var a=Xe._tableFactory(r,i[n],t);e.forEach(function(e){e[n]||(o?d(e,n,{get:function(){var e=F.PSD&&F.PSD.trans;return e&&e.db===Xe?e.tables[n]:a}},{enumerable:!0}):e[n]=a)})})}function fe(e){e.forEach(function(e){for(var t in e)e[t]instanceof R&&delete e[t]})}function de(e,n,r,i,o,a){a=a||t,e.onerror||(e.onerror=J(o)),n?e.onsuccess=Y(function(){var t=e.result;if(t){var u=function(){t.continue()};n(t,function(e){u=e},i,o)&&r(a(t.value),t,function(e){u=e}),u()}else i()},o):e.onsuccess=Y(function(){var t=e.result;if(t){var n=function(){t.continue()};r(a(t.value),t,function(e){n=e}),n()}else i()},o)}function he(e){var t=[];return e.split(",").forEach(function(e){e=e.trim();var n=e.replace("&","").replace("++","").replace("*",""),r=0!==n.indexOf("[")?n:e.substring(e.indexOf("[")+1,e.indexOf("]")).split("+");t.push(new ee(n,r||null,e.indexOf("&")!==-1,e.indexOf("*")!==-1,e.indexOf("++")!==-1,oe(r),r.indexOf(".")!==-1))}),t}function pe(e,t){return Ve.cmp(e,t)}function ge(e,t){return pe(e,t)<0?e:t}function ye(e,t){return pe(e,t)>0?e:t}function me(e,t){return Ve.cmp(e,t)}function be(e,t){return Ve.cmp(t,e)}function we(e,t){return e<t?-1:e===t?0:1}function _e(e,t){return e>t?-1:e===t?0:1}function Se(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}function Ie(){if(Xe.verno=He.version/10,Xe._dbSchema=Ue={},Le=v(He.objectStoreNames,0),0!==Le.length){var e=He.transaction(ne(Le),"readonly");Le.forEach(function(t){for(var n=e.objectStore(t),r=n.keyPath,i=r&&"string"==typeof r&&r.indexOf(".")!==-1,o=new ee(r,r||"",(!1),(!1),(!!n.autoIncrement),r&&"string"!=typeof r,i),a=[],u=0;u<n.indexNames.length;++u){var s=n.index(n.indexNames[u]);r=s.keyPath,i=r&&"string"==typeof r&&r.indexOf(".")!==-1;var c=new ee(s.name,r,(!!s.unique),(!!s.multiEntry),(!1),r&&"string"!=typeof r,i);a.push(c)}Ue[t]=new te(t,o,a,{})}),le([We],Xe._transPromiseFactory,ie(Ue),Qe,Ue)}}function je(e,t){for(var n=t.db.objectStoreNames,r=0;r<n.length;++r)for(var i=n[r],o=t.objectStore(i),a=0;a<o.indexNames.length;++a){var u=o.indexNames[a],s=o.index(u).keyPath,c="string"==typeof s?s:"["+v(s).join("+")+"]";if(e[i]){var l=e[i].idxByName[c];l&&(l.name=u)}}}function Be(e){Xe.on("blocked").fire(e),Ee.filter(function(e){return e.name===Xe.name&&e!==Xe&&!e._vcFired}).map(function(t){return t.on("versionchange").fire(e)})}var Ne=H.dependencies,Fe=l({addons:H.addons,autoOpen:!0,indexedDB:Ne.indexedDB,IDBKeyRange:Ne.IDBKeyRange},u),Ke=Fe.addons,Me=Fe.autoOpen,Ve=Fe.indexedDB,Re=Fe.IDBKeyRange,Ue=this._dbSchema={},qe=[],Le=[],We={},ze={},He=null,Ye=!0,Ge=null,Ze=!1,Je="readonly",Qe="readwrite",Xe=this,$e=[],et=!0,tt=!!re(Ve);this.version=function(e){if(He||Ze)throw new ve.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=qe.filter(function(t){return t._cfg.version===e})[0];return t?t:(t=new y(e),qe.push(t),qe.sort(ce),t)},l(y.prototype,{stores:function(e){this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,e):e;var t={};qe.forEach(function(e){l(t,e._cfg.storesSource)});var n=this._cfg.dbschema={};return this._parseStoresSpec(t,n),Ue=Xe._dbSchema=n,fe([We,Xe,ze]),le([ze],V,ie(n),Qe,n),le([We,Xe,this._cfg.tables],Xe._transPromiseFactory,ie(n),Qe,n,!0),Le=ie(n),this},upgrade:function(e){var t=this;return Ae(function(){e(Xe._createTransaction(Qe,ie(t._cfg.dbschema),t._cfg.dbschema))}),this._cfg.contentUpgrade=e,this},_parseStoresSpec:function(e,t){ie(e).forEach(function(n){if(null!==e[n]){var r={},i=he(e[n]),o=i.shift();if(o.multi)throw new ve.Schema("Primary key cannot be multi-valued");o.keyPath&&P(r,o.keyPath,o.auto?0:o.keyPath),i.forEach(function(e){if(e.auto)throw new ve.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new ve.Schema("Index must have a name and cannot be an empty string");P(r,e.keyPath,e.compound?e.keyPath.map(function(){return""}):"")}),t[n]=new te(n,o,i,r)}})}}),this._allTables=We,this._tableFactory=function(e,t,n){return e===Je?new R(t.name,n,t,ue):new U(t.name,n,t)},this._createTransaction=function(e,t,n,r){return new G(e,t,n,r)},this._transPromiseFactory=function(t,n,r){if(!Ye||F.PSD&&F.PSD.letThrough){var i=Xe._createTransaction(t,n,Ue);return i._promise(t,function(e,t){i.error(function(e){Xe.on("error").fire(e)}),F.newPSD(function(){F.PSD.trans=i,r(function(t){i.complete(function(){e(t)})},t,i)})})}if(!Ze&&!Me)return S(new ve.DatabaseClosed);var o=new F(function(e,i){$e.push({resume:function(){var a=Xe._transPromiseFactory(t,n,r);o.onuncatched=a.onuncatched,a.then(e,i)}})});return Me&&!Ze&&Xe.open().catch(e),o},this._whenReady=function(t){if(!Te&&Ye&&(!F.PSD||!F.PSD.letThrough)){if(!Ze){if(!Me)return S(new ve.DatabaseClosed);Xe.open().catch(e)}return new F(function(e,n){$e.push({resume:function(){t(e,n)}})})}return new F(t)},this.verno=0,this.open=function(){return He?F.resolve(Xe):Ze?new F(function(e,t){return Xe._whenReady(function(){e(Xe)},function(e){t(e)})}):(Ge=null,Ze=!0,Ye=!0,new F(function(e,t){function n(e){try{i.transaction.abort()}catch(e){}if(He)try{He.close()}catch(e){}He=null,Ze=!1,Ge=j(e),Ye=!1,t(Ge),M()}Te&&e();var i;try{if(qe.length>0&&(et=!1),!Ve)throw new ve.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");if(i=et?Ve.open(r):Ve.open(r,Math.round(10*Xe.verno)),!i)throw new ve.MissingAPI("IndexedDB API not available");i.onerror=J(n,["opening database",r]),i.onblocked=Be,i.onupgradeneeded=Y(function(e){if(et&&!Xe._allowEmptyDB){i.onerror=function(e){e.preventDefault()},i.transaction.abort(),i.result.close();var t=Ve.deleteDatabase(r);t.onsuccess=t.onerror=function(){n(new ve.NoSuchDatabase("Database "+r+" doesnt exist"))}}else{i.transaction.onerror=J(n);var o=e.oldVersion>Math.pow(2,62)?0:e.oldVersion;w(o/10,i.transaction,n,i)}},n),i.onsuccess=Y(function(){if(Ze=!1,He=i.result,et)Ie();else if(He.objectStoreNames.length>0)try{je(Ue,He.transaction(ne(He.objectStoreNames),Je))}catch(e){}He.onversionchange=function(e){Xe._vcFired=!0,Xe.on("versionchange").fire(e)},tt||X(function(e){if(e.indexOf(r)===-1)return e.push(r)}),F.newPSD(function(){function t(){Ye=!1,M(),e()}F.PSD.letThrough=!0;try{var r=Xe.on.ready.fire();r&&"function"==typeof r.then?r.then(t,function(e){He.close(),He=null,n(e)}):m(t)}catch(e){n(e)}})},n)}catch(e){n(e)}}).then(function(){return Ee.push(Xe),Xe}))},this.close=function(){var e=Ee.indexOf(Xe);e>=0&&Ee.splice(e,1),He?(He.close(),He=null,Me=!1,Ye&&M(),Ye=!1,Ge=new ve.DatabaseClosed):Ze&&Xe.on("ready",function(){return F.reject(new ve.DatabaseClosed)})},this.delete=function(){var e=arguments;return new F(function(t,n){function i(){Xe.close();var e=Ve.deleteDatabase(r);e.onsuccess=function(){tt||X(function(e){var t=e.indexOf(r);if(t>=0)return e.splice(t,1)}),t()},e.onerror=J(n,["deleting",r]),e.onblocked=Be}if(e.length>0)throw new ve.InvalidArgument("Arguments not allowed in db.delete()");Ze?$e.push({resume:i}):i()})},this.backendDB=function(){return He},this.isOpen=function(){return null!==He},this.hasFailed=function(){return null!==Ge},this.dynamicallyOpened=function(){return et},this.name=r,d(this,"tables",{get:function(){return ie(We).map(function(e){return We[e]})}}),this.on=B(this,"error","populate",{blocked:[s,e],ready:[c,e],versionchange:[s,e]}),this.on.ready.subscribe=p(this.on.ready.subscribe,function(e){return function(t,n){function r(){return n||Xe.on.ready.unsubscribe(r),t.apply(this,arguments)}e.call(this,r),Xe.isOpen()&&(Ye?$e.push({resume:r}):r())}}),Ae(function(){Xe.on("populate").fire(Xe._createTransaction(Qe,Le,Ue)),Xe.on("error").fire(new Error)}),this.transaction=function(e,t,n){function r(t,r){var o=null,a=!0;try{if(u)throw u;o=Xe._createTransaction(e,s,Ue,i);var c=s.map(function(e){return o.tables[e]});c.push(o);var l,f=0;F.newPSD(function(){F.PSD.trans=o,o.scopeFunc=n,i&&(o.idbtrans=i.idbtrans,o._promise=p(o._promise,function(e){return function(t,n,r){function i(e){return function(t){var n;return F._rootExec(function(){n=e(t),F._tickFinalize(function(){0===--f&&o.active&&(o.active=!1,o.on.complete.fire())})}),n}}return++f,e.call(this,t,function(e,t,r){return n(i(e),i(t),r)},r)}})),o.complete(function(){t(l)}),o.error(function(e){function t(){var t=r(e);i||t||Xe.on.error.fire(e)}o.idbtrans&&(o.idbtrans.onerror=Q);try{o.abort()}catch(e){}i&&(i.active=!1,i.on.error.fire(e)),a?m(t):t()}),F._rootExec(function(){if(l=n.apply(o,c))if("function"==typeof l.next&&"function"==typeof l.throw)l=$(l);else if("function"==typeof l.then&&!l.hasOwnProperty("_PSD"))throw new ve.IncompatiblePromise})}),(!o.idbtrans||i&&0===f)&&o._nop()}catch(e){o&&o.idbtrans&&(o.idbtrans.onerror=Q),o&&o.abort(),i&&i.on.error.fire(e),m(function(){r(e)||Xe.on("error").fire(e)})}a=!1}t=v(arguments,1,arguments.length-1),n=arguments[arguments.length-1];var i=F.PSD&&F.PSD.trans;i&&i.db===Xe&&e.indexOf("!")===-1||(i=null);var o=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");var a=oe(t[0])?t.reduce(function(e,t){return e.concat(t)}):t,u=null,s=a.map(function(e){return"string"==typeof e?e:(e instanceof R||(u=u||new TypeError("Invalid type. Arguments following mode must be instances of Table or String")),e.name)});return"r"==e||e==Je?e=Je:"rw"==e||e==Qe?e=Qe:u=new ve.InvalidArgument("Invalid transaction mode: "+e),i&&(u||(i&&i.mode===Je&&e===Qe&&(o?i=null:u=u||new ve.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")),i&&s.forEach(function(e){i.tables.hasOwnProperty(e)||(o?i=null:u=u||new ve.SubTransaction("Table "+e+" not included in parent transaction. Parent Transaction function: "+i.scopeFunc.toString()))}))),i?i._promise(e,r,"lock"):Xe._whenReady(r)},this.table=function(e){if(Te&&et)return new U(e);if(!We.hasOwnProperty(e))throw new ve.InvalidTable("Table "+e+" does not exist");return We[e]},f(R.prototype,function(){function e(){throw new ve.ReadOnly("Current Transaction is READONLY")}return{_trans:function(e,t,n){return this._tpf(e,[this.name],t,n)},_idbstore:function(e,t,n){if(Te)return new F(t);var r=this;return this._tpf(e,[this.name],function(e,n,i){t(e,n,i.idbtrans.objectStore(r.name),i)},n)},get:function(e,t){var n=this;return this._idbstore(Je,function(t,r,i){Te&&t(n.schema.instanceTemplate);var o=i.get(e);o.onerror=J(r,["getting",e,"from",n.name]),o.onsuccess=function(){t(n.hook.reading.fire(o.result))}}).then(t)},where:function(e){return new ae(this,e)},count:function(e){return this.toCollection().count(e)},offset:function(e){return this.toCollection().offset(e)},limit:function(e){return this.toCollection().limit(e)},reverse:function(){return this.toCollection().reverse()},filter:function(e){return this.toCollection().and(e)},each:function(e){return this.toCollection().each(e)},toArray:function(e){return this.toCollection().toArray(e)},orderBy:function(e){return new this._collClass(new ae(this,e))},toCollection:function(){return new this._collClass(new ae(this))},mapToClass:function(e,t){this.schema.mappedClass=e;var n=Object.create(e.prototype);t&&Z(n,t),this.schema.instanceTemplate=n;var r=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),e},defineClass:function(e){return this.mapToClass(H.defineClass(e),e)},add:e,put:e,delete:e,clear:e,update:e}}),h(U).from(R).extend(function(){return{bulkDelete:function(t){return this.hook.deleting.fire===e?this._idbstore(Qe,function(n,r,i,o){n(z(i,o,t,!1,e))}):this.where(":id").anyOf(t).delete().then(function(){})},bulkPut:function(t,n){var r=this;return this._idbstore(Qe,function(i,o,a,u){if(!a.keyPath&&!r.schema.primKey.auto&&!n)throw new ve.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(a.keyPath&&n)throw new ve.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(n&&n.length!==t.length)throw new ve.InvalidArgument("Arguments objects and keys must have the same length");if(0===t.length)return i();var s,c,l=function(e){0===f.length?i(e):o(new T(r.name+".bulkPut(): "+f.length+" of "+d+" operations failed",f))},f=[],d=t.length,h=u.tables[r.name];if(r.hook.creating.fire===e&&r.hook.updating.fire===e){c=q(f);for(var v=0,p=t.length;v<p;++v)s=n?a.put(t[v],n[v]):a.put(t[v]),s.onerror=c;s.onerror=q(f,l),s.onsuccess=W(l)}else{var g=n||a.keyPath&&t.map(function(e){return x(e,a.keyPath)}),y=g&&g.reduce(function(e,n,r){return null!=n&&(e[n]=t[r]),e},{}),m=g?h.where(":id").anyOf(g.filter(function(e){return null!=e})).modify(function(){this.value=y[this.primKey],y[this.primKey]=null}).catch(A,function(e){f=e.failures}).then(function(){for(var e=[],r=n&&[],i=g.length-1;i>=0;--i){var o=g[i];(null==o||y[o])&&(e.push(t[i]),n&&r.push(o),null!=o&&(y[o]=null))}return e.reverse(),n&&r.reverse(),h.bulkAdd(e,r)}).then(function(e){var t=g[g.length-1];return null!=t?t:e}):h.bulkAdd(t);m.then(l).catch(T,function(e){f=f.concat(e.failures),l()}).catch(o)}},"locked")},bulkAdd:function(t,n){var r=this,i=this.hook.creating.fire;return this._idbstore(Qe,function(o,a,u,s){function c(e){0===h.length?o(e):a(new T(r.name+".bulkAdd(): "+h.length+" of "+v+" operations failed",h))}if(!u.keyPath&&!r.schema.primKey.auto&&!n)throw new ve.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(u.keyPath&&n)throw new ve.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(n&&n.length!==t.length)throw new ve.InvalidArgument("Arguments objects and keys must have the same length");if(0===t.length)return o();var l,f,d,h=[],v=t.length;if(i!==e){var p=u.keyPath,g={onerror:null,onsuccess:null};f=q(h,null),d=W(null,!0),b(function(){for(var e=0,r=t.length;e<r;++e){var o=n&&n[e],a=t[e],c=n?o:p?x(a,p):void 0,h=i.call(g,c,a,s);null==c&&null!=h&&(p?(a=E(a),P(a,p,h)):o=h),l=null!=o?u.add(a,o):u.add(a),g.onerror&&(l._err=g.onerror),g.onsuccess&&(l._suc=g.onsuccess),e<r-1&&(l.onerror=f,g.onsuccess&&(l.onsuccess=d),g.onerror=null,g.onsuccess=null)}},function(e){throw g.onerror&&g.onerror(e),e}),l.onerror=q(h,c),l.onsuccess=W(c,!0)}else{f=q(h);for(var y=0,m=t.length;y<m;++y)l=n?u.add(t[y],n[y]):u.add(t[y]),l.onerror=f;l.onerror=q(h,c),l.onsuccess=W(c)}})},add:function(t,n){var r=this,i=this.hook.creating.fire;return this._idbstore(Qe,function(o,a,u,s){var c={onsuccess:null,onerror:null};if(i!==e){var l=null!=n?n:u.keyPath?x(t,u.keyPath):void 0,f=i.call(c,l,t,s);null==l&&null!=f&&(u.keyPath?P(t,u.keyPath,f):n=f)}try{var d=null!=n?u.add(t,n):u.add(t),h=F.PSD;d.onerror=J(function(e){return c.onerror&&F.usePSD(h,c.onerror.bind(c,e)),a(e)},["adding",t,"into",r.name]),d.onsuccess=function(e){var n=u.keyPath;n&&P(t,n,e.target.result),c.onsuccess&&F.usePSD(h,c.onsuccess.bind(c,e.target.result)),o(d.result)}}catch(e){throw c.onerror&&c.onerror(e),e}})},put:function(t,n){var r=this,i=this.hook.creating.fire,o=this.hook.updating.fire;return i!==e||o!==e?this._trans(Qe,function(e,i,o){var a=void 0!==n?n:r.schema.primKey.keyPath&&x(t,r.schema.primKey.keyPath);null==a?o.tables[r.name].add(t).then(e,i):(o._lock(),t=E(t),o.tables[r.name].where(":id").equals(a).modify(function(){this.value=t}).then(function(e){return 0===e?o.tables[r.name].add(t,n):a}).finally(function(){o._unlock()}).then(e,i))}):this._idbstore(Qe,function(e,i,o){var a=void 0!==n?o.put(t,n):o.put(t);a.onerror=J(i,["putting",t,"into",r.name]),a.onsuccess=function(n){var r=o.keyPath;r&&P(t,r,n.target.result),e(a.result)}})},delete:function(e){return this.hook.deleting.subscribers.length?this.where(":id").equals(e).delete():this._idbstore(Qe,function(t,n,r){var i=r.delete(e);i.onerror=J(n,["deleting",e,"from",r.name]),i.onsuccess=function(){t(i.result)}})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(Qe,function(e,t,n){var r=n.clear();r.onerror=J(t,["clearing",n.name]),r.onsuccess=function(){e(r.result)}})},update:function(e,t){if("object"!=typeof t||oe(t))throw new ve.InvalidArgument("db.update(keyOrObject, modifications). modifications must be an object.");if("object"!=typeof e||oe(e))return this.where(":id").equals(e).modify(t);ie(t).forEach(function(n){P(e,n,t[n])});var n=x(e,this.schema.primKey.keyPath);return void 0===n&&F.reject(new ve.InvalidArgument("Given object does not contain its primary key")),this.where(":id").equals(n).modify(t)}}}),f(G.prototype,{_lock:function(){return++this._reculock,1===this._reculock&&F.PSD&&(F.PSD.lockOwnerFor=this),this},_unlock:function(){if(0===--this._reculock)for(F.PSD&&(F.PSD.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{e()}catch(e){}}return this},_locked:function(){return this._reculock&&(!F.PSD||F.PSD.lockOwnerFor!==this)},_nop:function(e){this.tables[this.storeNames[0]].get(0).then(e)},_promise:function(e,t,n){var r=this;return F.newPSD(function(){var i;return r._locked()?i=new F(function(i,o){r._blockedFuncs.push(function(){r._promise(e,t,n).then(i,o)})}):(i=r.active?new F(function(i,o){if(!r.idbtrans&&e){if(!He)throw!Ge||["DatabaseClosedError","MissingAPIError"].indexOf(Ge.name)>=0?Ge:new ve.OpenFailed(Ge);var a=r.idbtrans=He.transaction(ne(r.storeNames),r.mode);a.onerror=function(e){r.on("error").fire(e&&e.target.error),e.preventDefault(),r.abort()},a.onabort=function(e){m(function(){r.on("error").fire(new ve.Abort("Transaction aborted for unknown reason"))}),r.active=!1,r.on("abort").fire(e)},a.oncomplete=function(e){r.active=!1,r.on("complete").fire(e)}}n&&r._lock();try{t(i,o,r)}catch(e){var u=_(j(e));H.ignoreTransaction(function(){
r.on("error").fire(u)}),r.abort(),o(u)}}):F.reject(_(new ve.TransactionInactive("Transaction is inactive. Original Scope Function Source: "+r.scopeFunc.toString()))),r.active&&n&&i.finally(function(){r._unlock()})),i.onuncatched=function(e){H.ignoreTransaction(function(){r.on("error").fire(e)}),r.abort()},i})},complete:function(e){return this.on("complete",e)},error:function(e){return this.on("error",e)},abort:function(){if(this.idbtrans&&this.active)try{this.active=!1,this.idbtrans.abort(),this.on.error.fire(new ve.Abort("Transaction Aborted"))}catch(e){}},table:function(e){if(!this.tables.hasOwnProperty(e))throw new ve.InvalidTable("Table "+e+" not in transaction");return this.tables[e]}}),f(ae.prototype,function(){function e(e,t,n){var r=e instanceof ae?new e._ctx.collClass(e):e;try{throw n?new n(t):new TypeError(t)}catch(e){r._ctx.error=e}return r}function t(e){return new e._ctx.collClass(e,function(){return Re.only("")}).limit(0)}function n(e){return v(1===e.length&&oe(e[0])?e[0]:e)}function r(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function i(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function o(e,t,n,r,i,o){for(var a=Math.min(e.length,r.length),u=-1,s=0;s<a;++s){var c=t[s];if(c!==r[s])return i(e[s],n[s])<0?e.substr(0,s)+n[s]+n.substr(s+1):i(e[s],r[s])<0?e.substr(0,s)+r[s]+n.substr(s+1):u>=0?e.substr(0,u)+t[u]+n.substr(u+1):null;i(e[s],c)<0&&(u=s)}return a<r.length&&"next"===o?e+n.substr(e.length):a<e.length&&"prev"===o?e.substr(0,n.length):u<0?null:e.substr(0,u)+r[u]+n.substr(u+1)}function a(e,t,n,a){function u(e){s=r(e),c=i(e),l="next"===e?we:_e;var t=n.map(function(e){return{lower:c(e),upper:s(e)}}).sort(function(e,t){return l(e.lower,t.lower)});f=t.map(function(e){return e.upper}),d=t.map(function(e){return e.lower}),h=e,v="next"===e?"":a}var s,c,l,f,d,h,v,p=n.length;u("next");var g=new e._ctx.collClass(e,function(){return Re.bound(f[0],d[p-1]+a)});g._ondirectionchange=function(e){u(e)};var y=0;return g._addAlgorithm(function(e,n,r){var i=e.key;if("string"!=typeof i)return!1;var a=c(i);if(t(a,d,y))return!0;for(var u=null,s=y;s<p;++s){var g=o(i,a,f[s],d[s],l,h);null===g&&null===u?y=s+1:(null===u||l(u,g)>0)&&(u=g)}return n(null!==u?function(){e.continue(u+v)}:r),!1}),g}return{between:function(n,r,i,o){i=i!==!1,o=o===!0;try{return pe(n,r)>0||0===pe(n,r)&&(i||o)&&(!i||!o)?t(this):new this._ctx.collClass(this,function(){return Re.bound(n,r,!i,!o)})}catch(t){return e(this,De)}},equals:function(e){return new this._ctx.collClass(this,function(){return Re.only(e)})},above:function(e){return new this._ctx.collClass(this,function(){return Re.lowerBound(e,!0)})},aboveOrEqual:function(e){return new this._ctx.collClass(this,function(){return Re.lowerBound(e)})},below:function(e){return new this._ctx.collClass(this,function(){return Re.upperBound(e,!0)})},belowOrEqual:function(e){return new this._ctx.collClass(this,function(){return Re.upperBound(e)})},startsWith:function(t){return"string"!=typeof t?e(this,ke):this.between(t,t+xe,!0,!0)},startsWithIgnoreCase:function(t){return"string"!=typeof t?e(this,ke):""===t?this.startsWith(t):a(this,function(e,t){return 0===e.indexOf(t[0])},[t],xe)},equalsIgnoreCase:function(t){return"string"!=typeof t?e(this,ke):a(this,function(e,t){return e===t[0]},[t],"")},anyOfIgnoreCase:function(){var r=n(arguments);return 0===r.length?t(this):r.every(function(e){return"string"==typeof e})?a(this,function(e,t){return t.indexOf(e)!==-1},r,""):e(this,"anyOfIgnoreCase() only works with strings")},startsWithAnyOfIgnoreCase:function(){var r=n(arguments);return 0===r.length?t(this):r.every(function(e){return"string"==typeof e})?a(this,function(e,t){return t.some(function(t){return 0===e.indexOf(t)})},r,xe):e(this,"startsWithAnyOfIgnoreCase() only works with strings")},anyOf:function(){var r=n(arguments),i=me;try{r.sort(i)}catch(t){return e(this,De)}if(0===r.length)return t(this);var o=new this._ctx.collClass(this,function(){return Re.bound(r[0],r[r.length-1])});o._ondirectionchange=function(e){i="next"===e?me:be,r.sort(i)};var a=0;return o._addAlgorithm(function(e,t,n){for(var o=e.key;i(o,r[a])>0;)if(++a,a===r.length)return t(n),!1;return 0===i(o,r[a])||(t(function(){e.continue(r[a])}),!1)}),o},notEqual:function(e){return this.inAnyRange([[-(1/0),e],[e,Pe]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var t=n(arguments);if(0===t.length)return new this._ctx.collClass(this);try{t.sort(me)}catch(t){return e(this,De)}var r=t.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[-(1/0),t]]},null);return r.push([t[t.length-1],Pe]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(n,r){function i(e,t){for(var n=0,r=e.length;n<r;++n){var i=e[n];if(pe(t[0],i[1])<0&&pe(t[1],i[0])>0){i[0]=ge(i[0],t[0]),i[1]=ye(i[1],t[1]);break}}return n===r&&e.push(t),e}function o(e,t){return f(e[0],t[0])}function a(e){return!h(e)&&!v(e)}var u=this._ctx;if(0===n.length)return t(this);if(!n.every(function(e){return void 0!==e[0]&&void 0!==e[1]&&me(e[0],e[1])<=0}))return e(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ve.InvalidArgument);var s,c=!r||r.includeLowers!==!1,l=r&&r.includeUppers===!0,f=me;try{s=n.reduce(i,[]),s.sort(o)}catch(t){return e(this,De)}var d=0,h=l?function(e){return me(e,s[d][1])>0}:function(e){return me(e,s[d][1])>=0},v=c?function(e){return be(e,s[d][0])>0}:function(e){return be(e,s[d][0])>=0},p=h,g=new u.collClass(this,function(){return Re.bound(s[0][0],s[s.length-1][1],!c,!l)});return g._ondirectionchange=function(e){"next"===e?(p=h,f=me):(p=v,f=be),s.sort(o)},g._addAlgorithm(function(e,t,n){for(var r=e.key;p(r);)if(++d,d===s.length)return t(n),!1;return!!a(r)||0!==pe(r,s[d][1])&&0!==pe(r,s[d][0])&&(t(function(){f===me?e.continue(s[d][0]):e.continue(s[d][1])}),!1)}),g},startsWithAnyOf:function(){var r=n(arguments);return r.every(function(e){return"string"==typeof e})?0===r.length?t(this):this.inAnyRange(r.map(function(e){return[e,e+xe]})):e(this,"startsWithAnyOf() only works with strings")}}}),f(ue.prototype,function(){function e(e,t){e.filter=Se(e.filter,t)}function t(e,t){var n=e.replayFilter;e.replayFilter=n?function(){return Se(n(),t())}:t}function n(e,t){e.isMatch=Se(e.isMatch,t)}function r(e,t){if(e.isPrimKey)return t;var n=e.table.schema.idxByName[e.index];if(!n)throw new ve.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return t.index(n.name)}function i(e,t){var n=r(e,t);return e.keysOnly&&"openKeyCursor"in n?n.openKeyCursor(e.range||null,e.dir+e.unique):n.openCursor(e.range||null,e.dir+e.unique)}function o(e,t,n,r,o){var a=e.replayFilter?Se(e.filter,e.replayFilter()):e.filter;e.or?!function(){function u(){2===++l&&n()}function s(e,n,i){if(!a||a(n,i,u,r)){var o=n.primaryKey.toString();c.hasOwnProperty(o)||(c[o]=!0,t(e,n,i))}}var c={},l=0;e.or._iterate(s,u,r,o),de(i(e,o),e.algorithm,s,u,r,!e.keysOnly&&e.valueFilter)}():de(i(e,o),Se(e.algorithm,a),t,n,r,!e.keysOnly&&e.valueFilter)}function a(e){return e.table.schema.instanceTemplate}return{_read:function(e,t){var n=this._ctx;return n.error?n.table._trans(null,function(e,t){t(n.error)}):n.table._idbstore(Je,e).then(t)},_write:function(e){var t=this._ctx;return t.error?t.table._trans(null,function(e,n){n(t.error)}):t.table._idbstore(Qe,e,"locked")},_addAlgorithm:function(e){var t=this._ctx;t.algorithm=Se(t.algorithm,e)},_iterate:function(e,t,n,r){return o(this._ctx,e,t,n,r)},clone:function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&l(n,e),t._ctx=n,t},raw:function(){return this._ctx.valueFilter=null,this},each:function(e){var t=this._ctx;return Te&&e(a(t)),this._read(function(n,r,i){o(t,e,n,r,i)})},count:function(e){if(Te)return F.resolve(0).then(e);var t=this,n=this._ctx;if(n.filter||n.algorithm||n.or||n.replayFilter){var i=0;return this._read(function(e,t,r){o(n,function(){return++i,!1},function(){e(i)},t,r)},e)}return this._read(function(e,i,o){var a=r(n,o),u=n.range?a.count(n.range):a.count();u.onerror=J(i,["calling","count()","on",t.name]),u.onsuccess=function(t){e(t.target.result)}},e)},sortBy:function(e,t){function n(e,t){return t?n(e[i[t]],t-1):e[o]}function r(e,t){var r=n(e,a),i=n(t,a);return r<i?-u:r>i?u:0}var i=e.split(".").reverse(),o=i[0],a=i.length-1,u="next"===this._ctx.dir?1:-1;return this.toArray(function(e){return e.sort(r)}).then(t)},toArray:function(e){var t=this._ctx;return this._read(function(e,n,r){Te&&e([a(t)]);var i=[];o(t,function(e){i.push(e)},function(){e(i)},n,r)},e)},offset:function(e){var n=this._ctx;return e<=0?this:(n.offset+=e,n.or||n.algorithm||n.filter||n.replayFilter?t(n,function(){var t=e;return function(){return--t<0}}):t(n,function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n(function(){e.advance(t),t=0}),!1))}}),this)},limit:function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),t(this._ctx,function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),this},until:function(t,n){var r=this._ctx;return Te&&t(a(r)),e(this._ctx,function(e,r,i){return!t(e.value)||(r(i),n)}),this},first:function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},last:function(e){return this.reverse().first(e)},filter:function(t){return Te&&t(a(this._ctx)),e(this._ctx,function(e){return t(e.value)}),n(this._ctx,t),this},and:function(e){return this.filter(e)},or:function(e){return new ae(this._ctx.table,e,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(e){var t=this._ctx;return Te&&e(x(a(this._ctx),this._ctx.index?this._ctx.table.schema.idxByName[this._ctx.index].keyPath:this._ctx.table.schema.primKey.keyPath)),t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.key,n)})},eachUniqueKey:function(e){return this._ctx.unique="unique",this.eachKey(e)},keys:function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return Te?new F(this.eachKey.bind(this)).then(function(e){return[e]}).then(e):this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)},uniqueKeys:function(e){return this._ctx.unique="unique",this.keys(e)},firstKey:function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},lastKey:function(e){return this.reverse().firstKey(e)},distinct:function(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return e(this._ctx,function(e){var t=e.primaryKey.toString(),n=r.hasOwnProperty(t);return r[t]=!0,!n}),this}}}),h(se).from(ue).extend({modify:function(t){var n=this,r=this._ctx,i=r.table.hook,o=i.updating.fire,a=i.deleting.fire;return Te&&"function"==typeof t&&t.call({value:r.table.schema.instanceTemplate},r.table.schema.instanceTemplate),this._write(function(i,u,s,c){function f(e,t){function n(e){return S.push(e),D.push(i.primKey),i.onerror&&F.newPSD(function(){F.PSD.trans=c,i.onerror(e)}),h(),!0}C=t.primaryKey;var i={primKey:t.primaryKey,value:e,onsuccess:null,onerror:null};if(v.call(i,e,i)!==!1){var o=!i.hasOwnProperty("value");++m,b(function(){var a=o?t.delete():t.update(i.value);a.onerror=J(n,o?["deleting",e,"from",r.table.name]:["modifying",e,"on",r.table.name]),a.onsuccess=function(){i.onsuccess&&F.newPSD(function(){F.PSD.trans=c,i.onsuccess(i.value)}),++w,h()}},n)}else i.onsuccess&&i.onsuccess(i.value)}function d(e){return e&&(S.push(e),D.push(C)),u(new A("Error modifying one or more objects",S,w,D))}function h(){_&&w+S.length===m&&(S.length>0?d():i(w))}var v;if("function"==typeof t)v=o===e&&a===e?t:function(e){var n=E(e);if(t.call(this,e,this)===!1)return!1;if(this.hasOwnProperty("value")){var r=I(n,this.value),i=o.call(this,r,this.primKey,n,c);i&&(e=this.value,ie(i).forEach(function(t){P(e,t,i[t])}))}else a.call(this,this.primKey,e,c)};else if(o===e){var p=ie(t),g=p.length;v=function(e){for(var n=!1,r=0;r<g;++r){var i=p[r],o=t[i];x(e,i)!==o&&(P(e,i,o),n=!0)}return n}}else{var y=t;t=k(y),v=function(e){var n=!1,r=o.call(this,t,this.primKey,E(e),c);return r&&l(t,r),ie(t).forEach(function(r){var i=t[r];x(e,r)!==i&&(P(e,r,i),n=!0)}),r&&(t=k(y)),n}}var m=0,w=0,_=!1,S=[],D=[],C=null;n.clone().raw()._iterate(f,function(){_=!0,h()},d,s)})},delete:function(){var t=this,n=this._ctx,r=n.range,i=n.table.hook.deleting.fire,o=i!==e;if(!o&&!n.or&&!n.algorithm&&!n.filter&&!n.replayFilter&&(n.isPrimKey&&!Oe||!r))return this._write(function(e,t,i){var o=J(t,["deleting range from",n.table.name]),a=r?i.count(r):i.count();a.onerror=o,a.onsuccess=function(){var n=a.result;b(function(){var t=r?i.delete(r):i.clear();t.onerror=o,t.onsuccess=function(){return e(n)}},function(e){return t(j(e))})}});var a=o?2e3:1e4;return this._write(function(e,r,u,s){var c=0,l=Object.create(n.table);l._tpf=s._tpf;var f=t.clone({table:l,keysOnly:!n.isMatch&&!o}).distinct().limit(a).raw(),d=[],h=function(){return f.each(o?function(e,t){d.push([t.primaryKey,t.value])}:function(e,t){d.push(t.primaryKey)}).then(function(){return o?d.sort(function(e,t){return me(e[0],t[0])}):d.sort(me),z(u,s,d,o,i)}).then(function(){var e=d.length;return c+=e,d=[],e<a?c:h()})};e(h())})}}),l(this,{Collection:ue,Table:R,Transaction:G,Version:y,WhereClause:ae,WriteableCollection:se,WriteableTable:U}),g(),Ke.forEach(function(e){e(Xe)})}function Y(e,t){var n=F.PSD;return function(){var r=F.PSD;F.PSD=n;try{e.apply(this,arguments)}catch(e){t(e)}finally{F.PSD=r}}}function G(e){if("function"==typeof e)return new e;if(oe(e))return[G(e[0])];if(e&&"object"==typeof e){var t={};return Z(t,e),t}return e}function Z(e,t){return ie(t).forEach(function(n){var r=G(t[n]);e[n]=r}),e}function J(e,t){return function(n){var r=n&&n.target.error||new Error("");if(t){var i=" occurred when "+t.map(function(e){switch(typeof e){case"function":return e();case"string":return e;default:return JSON.stringify(e)}}).join(" ");r.message&&r.message!=r.name&&(i+=". "+r.message),r.name?r=j(r,r.name+i):r+=i}return e(r),n&&(n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()),!1}}function Q(e){e.preventDefault()}function X(e){var t,n=H.dependencies.localStorage;if(!n)return e([]);try{t=JSON.parse(n.getItem("Dexie.DatabaseNames")||"[]")}catch(e){t=[]}e(t)&&n.setItem("Dexie.DatabaseNames",JSON.stringify(t))}function $(e){function t(e){return function(t){var r=e(t),i=r.value;return r.done?i:i&&"function"==typeof i.then?i.then(o,a):Array.isArray(i)?n(i,0):o(i)}}function n(e,t){if(t===e.length)return o(e);var r=e[t];return r.constructor&&"function"==typeof r.constructor.all?r.constructor.all(e).then(o,a):n(e,t+1)}var r=function(t){return e.next(t)},i=function(t){return e.throw(t)},o=t(r),a=t(i);return t(r)()}function ee(e,t,n,r,i,o,a){this.name=e,this.keyPath=t,this.unique=n,this.multi=r,this.auto=i,this.compound=o,this.dotted=a;var u="string"==typeof t?t:t&&"["+[].join.call(t,"+")+"]";this.src=(n?"&":"")+(r?"*":"")+(i?"++":"")+u}function te(e,t,n,r){this.name=e,this.primKey=t||new ee,this.indexes=n||[new ee],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=n.reduce(function(e,t){return e[t.name]=t,e},{})}function ne(e){return 1===e.length?e[0]:e}function re(e){var t=e&&(e.getDatabaseNames||e.webkitGetDatabaseNames);return t&&t.bind(e)}var ie=Object.keys,oe=Array.isArray,ae="undefined"!=typeof self?self:"undefined"!=typeof window?window:global,ue=[].slice,se=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","IncompatiblePromise"],ce=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],le=se.concat(ce),fe={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",IncompatiblePromise:"Incompatible Promise used in transaction scope. See http://tinyurl.com/znyqjqc"};h(C).from(Error).extend({dump:function(){return w(this)}}),h(A).from(C),h(T).from(C);var de=le.reduce(function(e,t){return e[t]=t+"Error",e},{}),he=C,ve=le.reduce(function(e,t){function n(e,n){this.name=r,"string"==typeof e?(this.message=e,this.inner=n||null):"object"==typeof e?(this.message=e.name+" "+e.message,this.inner=e):(this.message=fe[t],this.inner=null)}var r=t+"Error";return h(n).from(he),e[t]=n,e},{});ve.Syntax=SyntaxError,ve.Type=TypeError,ve.Range=RangeError;var pe=ce.reduce(function(e,t){return e[t+"Error"]=ve[t],e},{}),ge=le.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=ve[t]),e},{});ge.ModifyError=A,ge.DexieError=C,ge.BulkError=T;var ye=ae.setImmediate||function(e){var t=v(arguments,1);setTimeout(function(){e.apply(ae,t)},0)};g(function(){ye=me=Se=function(e){var t=arguments;setTimeout(function(){e.apply(ae,v(t,1))},0)}});var me=ye,be=!0,we=[],_e=[],Se=function(e){we.push([e,v(arguments,1)])};F.all=function(){var e=v(1===arguments.length&&oe(arguments[0])?arguments[0]:arguments);return new F(function(t,n){function r(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,function(e){r(o,e)},n)}e[o]=a,0===--i&&t(e)}catch(e){n(e)}}if(0===e.length)return t([]);for(var i=e.length,o=0;o<e.length;o++)r(o,e[o])})},F.prototype.then=function(e,t){var n=this,r=new F(function(r,i){null===n._state?K(n,new L(e,t,r,i)):me(K,n,new L(e,t,r,i))});return r._PSD=this._PSD,r.onuncatched=this.onuncatched,r._parent=this,r},F.prototype._then=function(t,n){K(this,new L(t,n,e,e))},F.prototype.catch=function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,function(e){return e instanceof t?n(e):F.reject(e)}):this.then(null,function(e){return e&&e.name===t?n(e):F.reject(e)})},F.prototype.finally=function(e){return this.then(function(t){return e(),t},function(t){return e(),F.reject(t)})},F.prototype.onuncatched=null,F.resolve=function(e){if(e&&"function"==typeof e.then)return e;var t=new F(function(){});return t._state=!0,t._value=e,t},F.reject=function(e){var t=new F(function(){});return t._state=!1,t._value=e,t},F.race=function(e){return new F(function(t,n){e.map(function(e){e.then(t,n)})})},F.PSD=null,F.newPSD=function(e){var t=F.PSD;F.PSD=t?Object.create(t):{};try{return e()}finally{F.PSD=t}},F.usePSD=function(e,t){var n=F.PSD;F.PSD=e;try{return t()}finally{F.PSD=n}},F._rootExec=M,F._tickFinalize=function(e){if(be)throw new Error("Not in a virtual tick");_e.push(e)},F.on=B(null,{error:[function(e,t){return t},z]});var xe=String.fromCharCode(65535),Pe=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(e){return xe}}(),De="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ke="String expected.",Ee=[],Ie="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ce=Ie,Oe=Ie,Ae=function(){},Te=!1;H.delete=function(e){var t=new H(e),n=t.delete();return n.onblocked=function(e){return t.on("blocked",e),this},n},H.exists=function(e){return new H(e).open().then(function(e){return e.close(),!0}).catch(H.NoSuchDatabaseError,function(){return!1})},H.getDatabaseNames=function(e){return new F(function(e,t){var n=re(indexedDB);if(n){var r=n();r.onsuccess=function(t){e(v(t.target.result,0))},r.onerror=J(t)}else X(function(t){return e(t),!1})}).then(e)},H.defineClass=function(e){function t(t){t?l(this,t):Te&&Z(this,e)}return t},H.applyStructure=Z,H.ignoreTransaction=function(e){return F.newPSD(function(){return F.PSD.trans=null,e()})},H.vip=function(e){return F.newPSD(function(){return F.PSD.letThrough=!0,e()})},H.async=function(e){return function(){try{var t=$(e.apply(this,arguments));return t&&"function"==typeof t.then?t:H.Promise.resolve(t)}catch(e){return H.Promise.reject(e)}}},H.spawn=function(e,t,n){try{var r=$(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:H.Promise.resolve(r)}catch(e){return H.Promise.reject(e)}},d(H,"currentTransaction",{get:function(){return F.PSD&&F.PSD.trans||null}}),H.Promise=F,H.derive=h,H.extend=l,H.extendProto=f,H.override=p,H.Events=H.events=B,H.getByKeyPath=x,H.setByKeyPath=P,H.delByKeyPath=D,H.shallowClone=k,H.deepClone=E,H.addons=[],H.fakeAutoComplete=Ae,H.asap=m,H.maxKey=Pe,H.connections=Ee,H.dump=w,l(H,ge),H.MultiModifyError=H.ModifyError,H.errnames=de,H.IndexSpec=ee,H.TableSchema=te;var je=ae.idbModules&&ae.idbModules.shimIndexedDB?ae.idbModules:{};return H.dependencies={indexedDB:je.shimIndexedDB||ae.indexedDB||ae.mozIndexedDB||ae.webkitIndexedDB||ae.msIndexedDB,IDBKeyRange:je.IDBKeyRange||ae.IDBKeyRange||ae.webkitIDBKeyRange},b(function(){H.dependencies.localStorage=null!=("undefined"!=typeof chrome&&null!==chrome?chrome.storage:void 0)?null:ae.localStorage}),H.semVer="1.3.6",H.version=H.semVer.split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)}),g(function(){H.fakeAutoComplete=Ae=g,H.fake=Te=!0}),H.default=H,H}),Ext.define("Utility.form",{statics:{fillCityFromZipCode:function(e,t,n,r,i){var o=e,a=o.getViewModel(),u=a.getStore(t),s=o.getView().down("#"+n);if(u.clearFilter(),s.setValue(null),5==i.length){var c=[],l={name:"cityZipCode",value:i};c.push(l);var f={table:"CITY",filters:c},d=[];Server.CommonQueries.read(f,function(e){e.success?(d=e.data,u.loadData(d),s.select(u.getAt(0))):console.log(e.msg)},o)}}}}),Ext.define("Utility.grid",{statics:{addItem:function(e,t){var n=e,r=t,i=n.store.getAt(0);return!(Ext.isDefined(i)&&i&&i.get("added")&&!i.isValid())&&(n.store.insert(0,r),n.getView().focusNode(r),n.getPlugin("rowEdit").startEdit(r,0),this.inEditor(n),void 0)},beforeEdit:function(e,t){return Ext.each(t.grid.store.query("added",!0).items,function(e){var n=e.copy();n.isValid()||!e.get("added")||t.record.get("added")||t.grid.store.remove(e)}),!t.grid.inEdition||t.record.get("locked")||t.record.get("toDelete")?(this.outEditor(t.grid),!1):(this.inEditor(t.grid),!0)},edit:function(e,t,n){var r=t.record;if(!r.get("added")){var i=!1;n.forEach(function(e){r.isModified(e)&&(i=!0)}),i?r.set("modified",!0):r.set("modified",!1),t.grid.getPlugin("gridediting").checkIfModifications(t.grid)}},cancelEdit:function(e,t){var n=t.record.copy();if(n.set(t.newValues),n.isValid()&&t.record.get("addedAndValidated")||!t.record.get("added")){if(!n.isValid()&&!t.record.get("added"))return!1;this.outEditor(t.grid)}else t.grid.getStore().remove(t.record),t.grid.getStore().count()>0&&t.grid.getSelectionModel().select(0,!0),this.outEditor(t.grid);return!0},viewBeforeCellClick:function(e){var t=e.getPlugin("rowEdit").editor.editingPlugin;Ext.isDefined(t)&&t.editing===!0&&t.editor.form.isValid()&&(t.completeEdit(),this.outEditor(e))},gridContainerClick:function(e){var t=e.getPlugin("rowEdit").editor.editingPlugin;Ext.isDefined(t)&&t.editing===!0&&t.editor.form.isValid()&&(t.completeEdit(),this.outEditor(e))},gridCellkeydown:function(t,n,r){13==e.getKey()&&n.inEdition&&t.get("added")&&t.isValid()&&this.addItem(n,r)},modifyItem:function(e){e.getSelectionModel().hasSelection()&&e.plugins[0].startEdit(e.getSelectionModel().getSelection()[0],0)},deleteItem:function(e){for(var t=e.getSelectionModel().getSelection(),n=0;n<t.length;n++)t[n].get("locked")||t[n].get("added")||t[n].get("modified")?t[n].get("added")?e.getStore().remove(t[n]):t[n].get("modified")&&(t[n].set("toDelete",!0),t[n].set("modified",!1),t[n].get("notValid")&&t[n].set("notValid",!1)):(t[n].set("toDelete",!0),t[n].get("notValid")&&t[n].set("notValid",!1));e.getPlugin("gridediting").checkIfModifications()},duplicateItem:function(e,t){var n=e.getSelectionModel().getSelection(),r=[];n.forEach(function(e){if(!e.get("toDelete")){var n=e.copy(null);n.set("added",!0),n.set("modified",!1),n.set(t,"default"),r.push(n)}});var i=e.getStore();i.add(r)},resetEdit:function(e,t,n,r){this.loadGrid(e,t,n,r.query("button")[0],r,!0)},quitEdit:function(e,t,n,r){this.loadGrid(e,t,n,r.query("button")[0],r),e.getPlugin("gridediting").quitEditMode()},saveEdit:function(e,t,n,r){this.loadGrid(e,t,n,r.query("button")[0],r),e.getPlugin("gridediting").quitEditMode()},inEditor:function(e){e.getPlugin("gridediting").fillInInterfaceOn()},outEditor:function(e){e.getPlugin("gridediting").fillInInterfaceOff()},loadGrid:function(e,t,n,r,i,o){n.removeAll(),n.loadData(t),t.length>0&&e.getSelectionModel().select(0,!0),Ext.isEmpty(r)||Utility.loading.end(r),Ext.isEmpty(i)||i.close(),Ext.isEmpty(o)&&e.getPlugin("gridediting").lockGrid(!1)},validateedit:function(e,t,n){var r=t.record.copy();r.set(t.newValues);r.getValidation();return!(!r.isValid()||!e.editor.form.isValid())&&(!!n&&(t.record.set("addedAndValidated",!0),this.outEditor(t.grid),!0))},addInfoCol:function(e){e.columns.push({xtype:"gridcolumn",renderer:function(e,t,n,r,i,o,a){return void 0!==a&&null!==a?n.get("added")?'<div class="fa fa-plus" style="height:16px !important;">&nbsp;</div>':n.get("modified")?'<div class="fa fa-edit" style="height:16px !important;">&nbsp;</div>':"":""},itemId:"actionColumn",maxWidth:28,minWidth:28,width:28,menuDisabled:!0,draggable:!1,enableColumnHide:!1,hideable:!1})},fillCityFromZipCode:function(e,t,n,r,i){var o=e,a=o.getViewModel(),u=a.getStore(t),s=r.up("roweditor").down("#"+n);if(s.setValue(null),5==i.length){var c=[],l={name:"cityZipCode",value:i};c.push(l);var f={id:50,table:"CITY",filters:c};s.setDisabled(!1);var d=[];Server.CommonQueries.read(f,function(e){e.success?(d=e.data,u.loadData(d),s.select(u.getAt(0))):console.log(e.msg)},o)}else s.setDisabled(!0)}}});var IndexedDB={db:null,openDB:function(){var e=this,t=new Promise(function(t,n){e.db?t():(e.db=new Dexie("smartMedDB"),e.db.version(1).stores({STATUS:"++id,lastUpdate",DOC_HAS_STUDY:"++id,docHasStudyId,studyId,studyCode,studyName,doctorId",USER:"++id,userId,userFName,userLName,userCatId",CITY:"++id,cityId,cityName,cityZipCode",DEVICE:"++id,deviceId,deviceName,modalityId,siteId",STUDY:"++id,studyId,studyCode,studyName",DOCTOR:"++id,doctorId,userFName,userLName",ROOM_HAS_DEVICE:"++id,roomHasDeviceId,deviceId,deviceName,siteId",ROOM:"++id,roomId,roomCode,roomName,siteId",REFERRING_PHYSICIAN:"++id,referringPhysicianId,referringPhysicianFName,referringPhysicianLName,referringPhysicianTitle",DEVICE_HAS_STUDY:"++id,deviceHasStudyId,deviceId,studyId,siteId,deviceCode,deviceName",SITE:"++id,siteId,siteCode,siteName"}),e.db.open(),t())});return t},populateData:function(e,t){var n=this.db,r=n[e];return n.transaction("rw",r,function(){return r.clear().then(function(){return r.bulkAdd(t)})}).catch(function(e){console.error("Error: "+e)})}};Ext.define("Utility.loading",{statics:{start:function(e){e.setLoading(!0)},end:function(e){e.setLoading(!1)}}}),Ext.define("Utility.renderer",{statics:{checkBoxRenderer:function(e){return e?'<span><img src="../Common/resources/images/green_checkbox.png"/><span>':'<span><img src="../Common/resources/images/green_checkbox_empty.png"/><span>'},imageBtnRenderer:function(e){return'<button  class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab"><img src="../Common/resources/images/'+e+'.png"/> </button>'},imgRenderer:function(e){return'<span><img src="../Common/resources/images/"+imgName+".png"/><span>'},retreiveTextFromStore:function(e,t,n,r,i){if(e){var o=i.getViewModel().getStore(r),a=o.findRecord(t,e);return a.get(n)}},retreiveValueFieldByTextFromStore:function(e,t,n,r,i){if(e){var o=i.getViewModel().getStore(r),a=o.findRecord(n,e);return a.get(t)}},listRenderer:function(e,t,n){var r,i;e?(r=e.replace(/\|/g,"</li><li>"),r="<ul><li>"+r+"</li></ul>",i="#31b0d5"):(i="#d1d1d1",r=n||"");var o='<button  class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab"><i class="'+t+'" style="color:'+i+';font-size:14px;"></i> </button>';return{renderer:o,tooltip:r}},positiveNegativeRenderer:function(e,t){var n="#d43f3a",r="a href='#'";return e>=0&&(n="#27b6af"),"<"+r+' onclick="return;" style="color:'+n+';font-size:13px;">'+Math.abs(e)+"</"+r+">"},hrefRenderer:function(e,t){return'<a href="#" onclick="return;" style="color:'+e+';font-size:17px;"><i class="'+t+'"></i></a>'},textHrefRenderer:function(e,t){return'<a href="#" onclick="return;" style="color:'+e+';font-size:13px;">'+t+"</a>"},btnRenderer:function(e,t){return'<button  class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab"><i class="'+t+'" style="color:'+e+';font-size:14px;"></i> </button>'},htmlTagRenderer:function(e,t,n){return"<"+e+' style="cursor:help;color:'+t+';font-size:17px;"><i class="'+n+'"></i></'+e+">"},textHtmlTagRenderer:function(e,t,n){var r=e||"div";return"<"+r+' style="cursor:help;color:'+t+';font-size:13px;">'+n+"</i></"+r+">"}}}),Ext.define("Utility.routes",{statics:{lastView:null,setCurrentView:function(e,t,n){e=(e||"").toLowerCase();var r,i=this,o=t.getLayout(),a=n.getStore(),u=a.findNode("routeId",e)||a.findNode("viewType",e),s=u&&u.get("viewType")||"page404",c=i.lastView,l=t.child("component[routeId="+e+"]");c&&c.isWindow&&c.destroy(),c=o.getActiveItem(),l||(r=Ext.create({xtype:s,routeId:e,hideMode:"offsets"})),r&&r.isWindow||(l?(l!==c&&o.setActiveItem(l),r=l):(Ext.suspendLayouts(),o.setActiveItem(t.add(r)),Ext.resumeLayouts(!0))),n.setSelection(u),r.isFocusable(!0)&&r.focus(),i.lastView=r}}}),Ext.define("Utility.ServerStateProvider",{extend:"Ext.state.Provider",requires:["Ext.state.Provider"],alias:"serverStateProvider",config:{userId:null,stateRestoredCallback:null},constructor:function(e){if(!e.userId)throw"ServerStateProvider: Missing userId";this.initConfig(e);var t=this;t.restoreState(),t.callParent(arguments)},set:function(e,t){var n=this;return"undefined"==typeof t||null===t?void n.clear(e):(n.saveStateForKey(e,t),void n.callParent(arguments))},restoreState:function(){var e=this,t=e.getStateRestoredCallback(),n={};n.userId="10",n.filters=[],n.filters.push({name:"statefulUserId",value:"10"}),Server.StatefulProvider.restorState(n,function(n){if(n.success){var r=n.data;for(var i in r)r.hasOwnProperty(i)&&(e.state[i]=e.decodeValue(r[i]));t&&t()}else console.log("ServerStateProvider: restoreState failed",arguments),t&&t()},e)},clear:function(e){var t=this;t.clearStateForKey(e),t.callParent(arguments)},saveStateForKey:function(e,t){var n=this,r={};r.userId="10",r.key=e,r.value=n.encodeValue(t),Server.StatefulProvider.saveState(r,function(e){e.success||(console.log("ServerStateProvider: saveStateForKey failed",arguments),callback&&callback())},n)},clearStateForKey:function(e){var t=this,n={};n.userId="10",n.key=e,Server.StatefulProvider.deleteState(n,function(e){e.success||(console.log("ServerStateProvider: clearStateForKey failed",arguments),callback&&callback())},t)}});var StateProvider={restoreState:function(e){var t=new Promise(function(t,n){var r={};r.userId=e,r.filters=[],r.filters.push({name:"statefulUserId",value:e});var i=Ext.state.Manager.getProvider();Server.StatefulProvider.restorState(r,function(e){if(e.success){var r=e.data;for(var o in r)r.hasOwnProperty(o)&&(i.state[o]=i.decodeValue(r[o]),window.localStorage.setItem("ext-"+o,r[o]));t(!0)}else n("StateProvider: restoreState failed"),console.error("StateProvider: restoreState failed")})});return t},saveState:function(e){var t=new Promise(function(t,n){var r,i=[],o=Ext.state.Manager.getProvider(),a=o.readLocalStorage();for(var u in a)a.hasOwnProperty(u)&&(r={},r.statefulKey=u,r.statefulValue=o.encodeValue(a[u]),r.statefulUserId=e,i.push(r));Server.StatefulProvider.saveState(i,function(e){e.success?t(!0):n("ServerStateProvider: saveStateForKey failed")})});return t}},stringUtil={formatFName:function(e){var t=e.split(" "),n="";return t.forEach(function(e){e=e.toLowerCase(),n+=e.charAt(0).toUpperCase()+e.substr(1)+" "}),n.trim()},isUUID4:function(e){var t=e.split("-");return 5==t.length&&8==t[0].length&&12==t[4].length}};Ext.define("Utility.tree",{statics:{select:function(e,t){var n,r,i=t;i.isLeaf()?(n=e.getSelectionModel().getSelection(),r=i.parentNode,n.forEach(function(t){r.get("id")==t.get("id")&&e.getSelectionModel().deselect(i);
},this)):(i.eachChild(function(t){e.getSelectionModel().deselect(t)}),e.down("#filterField").setValue(""))},edit:function(e,t,n){var r=t.record;if(!r.get("added")){var i=!1;n.forEach(function(e){r.isModified(e)&&(i=!0)}),i?r.set("modified",!0):r.set("modified",!1)}},filter:function(e,t){e.clearFilter(),Ext.isEmpty(t)?e.clearFilter():e.filterBy(function(e){return!e.isLeaf()||(!(e.get("name")!==t||!e.isLeaf())||void 0)})},moveNode:function(e,t,n){var r,i,o;e.isLeaf()?(i=parseInt(e.get("parentId")),r=e.copy(),Utility.tree.checkIfChange(n,r)?r.set("added",!0):r.set("added",!1),o=t.getNodeById(i),o.appendChild(r),o.expand(),e.remove()):(e.eachChild(function(e){i=parseInt(e.get("parentId")),r=e.copy(),Utility.tree.checkIfChange(n,r)?r.set("added",!0):r.set("added",!1),o=t.getNodeById(i),o.appendChild(r),o.expand()}),e.removeAll())},move:function(e,t,n){var r,e=e,i=e.getStore(),t=t;t.getStore();t.getSelectionModel().hasSelection()&&(r=t.getSelectionModel().getSelection(),r.forEach(function(e){Utility.tree.moveNode(e,i,n)}))},moveAll:function(e,t,n){var r=t.getStore().getNodeById("root"),i=e.getStore();r.eachChild(function(e){e.isLeaf()||Utility.tree.moveNode(e,i,n)})},loadTree:function(e,t,n){var r={text:"Root",expanded:!0,children:[]};e.setRootNode(r),t.forEach(function(t){e.getNodeById("root").appendChild(t)},this);var i=Ext.clone(n);i.forEach(function(t){e.getNodeById(t.parentId).appendChild(t)},this)},checkIfChange:function(e,t){var n=!0;return e.forEach(function(e){e.id===t.get("id")&&(n=!1)},this),n},inEdit:function(e){e.down("#availableBtn").setDisabled(!1),e.down("#allAvailableBtn").setDisabled(!1),e.down("#selectedBtn").setDisabled(!1),e.down("#allSelectedBtn").setDisabled(!1)},quitEdit:function(e){e.down("#availableBtn").setDisabled(!0),e.down("#allAvailableBtn").setDisabled(!0),e.down("#selectedBtn").setDisabled(!0),e.down("#allSelectedBtn").setDisabled(!0)},onSelectSelectedTreePanelEvent:function(e,t){e.inEdition&&(e.down("#availableBtn").setDisabled(!0),e.down("#allAvailableBtn").setDisabled(!0),e.down("#selectedBtn").setDisabled(!1),e.down("#allSelectedBtn").setDisabled(!1),t.getSelectionModel().deselectAll())},onSelectAvailableTreeEvent:function(e,t){e.inEdition&&(e.down("#availableBtn").setDisabled(!1),e.down("#allAvailableBtn").setDisabled(!1),e.down("#selectedBtn").setDisabled(!0),e.down("#allSelectedBtn").setDisabled(!0),t.getSelectionModel().deselectAll())}}}),function(e){for(var t=[],n=0;n<=15;n++)t[n]=n.toString(16);var r=function(){for(var e="",n=1;n<=36;n++)e+=9===n||14===n||19===n||24===n?"-":15===n?4:20===n?t[4*Math.random()|8]:t[15*Math.random()|0];return e};"undefined"!=typeof exports?module.exports=r:e.UUID=r}(this);
Ext.define("Common.ux.window.ChangesHistoryWindow",{extend:"Ext.window.Window",alias:"widget.changesHistoryWindow",id:"historyWindow",height:518,width:586,layout:{type:"fit"},collapseDirection:"right",title:"${history.title}",maximizable:!0,constrain:!0,modal:!0,initComponent:function(){var t=this,e=Ext.create("Ext.data.Store",{storeId:"statusChgStore",fields:[{name:"status"},{dateFormat:"time",name:"lastUpdDate",type:"date"},{name:"userId"}]}),i=Ext.create("Ext.data.Store",{storeId:"usrActStore",fields:[{name:"status"},{name:"comments"},{dateFormat:"time",name:"lastUpdDate",type:"date"},{name:"userId"}]});Ext.applyIf(t,{items:[{xtype:"tabpanel",activeTab:0,listeners:{tabchange:function(t,e){var i,a=t.getActiveTab().items.items[0];a.store.data.length>0?Ext.isDefined(i)&&i.hide():(Ext.isDefined(i)||(i=new Ext.LoadMask({target:a.getView(),msg:"${noDataFoundMsg}",renderTpl:['<div id="{id}-msgWrapEl" data-ref="msgWrapEl" class="{[values.$comp.msgWrapCls]}">','<div id="{id}-msgEl" data-ref="msgEl" class="{[values.$comp.msgCls]} ',Ext.baseCSSPrefix,'mask-msg-inner {childElCls}">','<div id="{id}-msgTextEl" data-ref="msgTextEl">{msg}</div>',"</div>","</div>"]})),i.show())}},items:[{xtype:"panel",layout:{type:"fit"},title:"${chHist.title}",items:[{xtype:"gridpanel",itemId:"statusHistPanel",title:"",store:e,columns:[{xtype:"gridcolumn",minWidth:150,dataIndex:"status",text:"${status}"},{xtype:"gridcolumn",dataIndex:"userId",text:"${chHistTransaction.userId}"},{xtype:"datecolumn",width:120,dataIndex:"lastUpdDate",text:"${chHistTransaction.timeStamp}",format:"d/m/Y H:i"}]}]},{xtype:"panel",layout:{type:"fit"},title:"${history.userAction}",items:[{xtype:"gridpanel",itemId:"userActHistPanel",title:"",store:i,columns:[{xtype:"gridcolumn",minWidth:150,dataIndex:"status",text:"${chHistTransaction.action}"},{xtype:"gridcolumn",dataIndex:"userId",text:"${chHistTransaction.userId}"},{xtype:"gridcolumn",dataIndex:"comments",text:"${chHistTransaction.comment}"},{xtype:"datecolumn",width:120,dataIndex:"lastUpdDate",text:"${chHistTransaction.timeStamp}",format:"d/m/Y H:i"}]}]}]}]}),t.callParent(arguments)}}),Ext.define("Common.ux.window.ChHistWin",{extend:"Ext.window.Window",alias:"widget.chHistWin",id:"histWin",height:520,width:700,layout:{type:"border"},withValidation:!0,title:"${chHist.title}",maximizable:!0,constrain:!0,modal:!0,initComponent:function(){var t=this;t.loadTplDetail=function(e,i){var a=null!=e.data.actionType?e.data.actionType:"",n=t.down("#chHistTpl");n.setTitle(a),"DEL"==e.data.actionTypeCode||"INS"==e.data.actionTypeCode?n.update({twoColumns:i}):n.update({threeColumns:i})};var e=Ext.create("Ext.data.Store",{storeId:"ChgStore",fields:[{name:"actionId"},{name:"actionType"},{name:"reporter"},{name:"repId"},{name:"repUidAndFullname"},{name:"validator"},{name:"valId"},{name:"valUidAndFullname"},{name:"timestamp"},{name:"reporterCmt"},{name:"validatorCmt"},{name:"actionTypeCode"},{name:"recordId"}]}),i=[];i=t.withValidation?[{xtype:"gridcolumn",dataIndex:"actionType",width:75,minWidth:75,text:"${chHist.actionType}"},{xtype:"gridcolumn",dataIndex:"repId",width:70,minWidth:70,text:"${chHist.reporter}",renderer:function(t,e,i,a,n,o,d){return e.tdAttr='data-qtip="'+i.data.repUidAndFullname+'"',i.data.repId}},{xtype:"gridcolumn",dataIndex:"valId",width:70,minWidth:70,text:"${chHist.validator}",renderer:function(t,e,i,a,n,o,d){return e.tdAttr='data-qtip="'+i.data.valUidAndFullname+'"',i.data.valId}},{xtype:"datecolumn",width:100,minWidth:100,dataIndex:"timestamp",text:"${chHist.timestamp}",renderer:function(t,e,i,a,n,o,d){return Ext.Date.format(new Date(t),"d/m/Y H:i")},format:"d/m/Y H:i"},{xtype:"gridcolumn",dataIndex:"reporterCmt",flex:1,text:"${chHist.reporterCmt}"},{xtype:"gridcolumn",dataIndex:"validatorCmt",flex:1,text:"${chHist.validatorCmt}"}]:[{xtype:"gridcolumn",dataIndex:"actionType",width:75,minWidth:75,text:"${chHist.actionType}"},{xtype:"gridcolumn",dataIndex:"repId",width:70,minWidth:70,text:"${chHist.reporter}",renderer:function(t,e,i,a,n,o,d){return e.tdAttr='data-qtip="'+i.data.repUidAndFullname+'"',i.data.repId}},{xtype:"datecolumn",width:100,minWidth:100,dataIndex:"timestamp",text:"${chHist.timestamp}",renderer:function(t,e,i,a,n,o,d){return Ext.Date.format(new Date(t),"d/m/Y H:i")},format:"d/m/Y H:i"},{xtype:"gridcolumn",dataIndex:"reporterCmt",flex:1,text:"${chHist.reporterCmt}"}],Ext.applyIf(t,{items:[{xtype:"container",region:"center",layout:{type:"border"},items:[{xtype:"gridpanel",itemId:"histGridPanel",region:"north",flex:1,split:!0,autoScroll:!0,store:e,forceFit:!0,columns:i,selModel:Ext.create("Ext.selection.RowModel",{}),listeners:{withMask:function(e){t.loadMaskCompRef=new Ext.LoadMask({target:e.getView(),msg:"${noDataFoundMsg}",renderTpl:['<div id="{id}-msgWrapEl" data-ref="msgWrapEl" class="{[values.$comp.msgWrapCls]}">','<div id="{id}-msgEl" data-ref="msgEl" class="{[values.$comp.msgCls]} ',Ext.baseCSSPrefix,'mask-msg-inner {childElCls}">','<div id="{id}-msgTextEl" data-ref="msgTextEl">{msg}</div>',"</div>","</div>"]}),t.loadMaskCompRef.show()},noMask:function(e){Ext.isDefined(t.loadMaskCompRef)&&t.loadMaskCompRef.hide()}}},{xtype:"panel",itemId:"chHistTpl",flex:2,region:"center",tpl:Ext.create("Ext.XTemplate",'<tpl if="twoColumns!=null">',"    ",'    <table class=\'changes_table\' cellspacing="0" cellpadding="0">',"    <tr class='th_row'>","        <th>","            ${chHist.title.property}","        </th>","        <th>","            ${chHist.title.value}","        </th>        ","    <tr>",'    <tpl for="twoColumns">    ',"        <tr class=\"{[(xindex%2) === 0 ? 'odd_row' : 'even_row']}\">","            <td>","                {itemCod}","            </td>","            <td>","                {[this.getFormattedData(values.objectType, values.futureValue)]}","            </td>            ","        </tr>","    </tpl>","\t</table>","<tpl else>",'\t<table class=\'changes_table\' cellspacing="0" cellpadding="0">',"    <tr class='th_row'>","        <th>","            ${chHist.title.property}","        </th>","        <th>","            ${chHist.title.currvalue}","        </th>","        <th>","            ${chHist.title.futvalue}","        </th>","    <tr> ",'    <tpl for="threeColumns">    ',"        <tr class=\"{[(xindex%2) === 0 ? 'odd_row' : 'even_row']}\">","            <td>","                {itemCod}","            </td>","            <td>","                {[this.getFormattedData(values.objectType, values.currentValue)]}","            </td>","            <td class=\"{[values.currentValue!==values.futureValue ? 'changed_elem':'']}\">","                {[this.getFormattedData(values.objectType, values.futureValue)]}","            </td>             ","        </tr>","    </tpl>        ","\t</table>","</tpl>","    ","",{getCheckboxHTML:function(t){return"1"==t?'<img src="../../project-js/ux/images/checkbox_checked.png">':"0"==t?'<img src="../../project-js/ux/images/checkbox_unchecked.png">':void 0},formatDate:function(t){return Ext.Date.format(new Date(t),"d/m/Y")},getFormattedData:function(t,e){if("CHECKBOX"===t)return this.getCheckboxHTML(e);if("DATE"===t)return null!=e?this.formatDate(Ext.Date.parse(e,"d-m-Y")):null;if("TIME"===t)return null!=e?(e=Ext.Date.parse(e,"d-m-Y H:i:s"),this.formatTime(e)):null;if("AMOUNT"!==t)return null!==e&&"LTRIM_VARCHAR2"===t?e.replace(/^0+/,""):e;var i=e.split("#");return i.length>1?MTM.formatting.formatCurrency(i[1],i[0])+" "+i[0]:void 0},formatTime:function(t){return Ext.Date.format(new Date(t),"H:i")}}),autoScroll:!0,bodyCls:"changes_main_panel",title:"${chHist.changes.title}"}]}]}),t.callParent(arguments)},listeners:{close:function(t,e){var i=Ext.ComponentQuery.query("component[itemId=chHistBtn]");Ext.Array.each(i,function(t){t.isDisabled()&&t.setDisabled(!1)})}}}),Ext.define("Common.ux.window.FullScreenWindow",{extend:"Ext.window.Window",layout:{type:"border",padding:5},tools:[{type:"refresh",tooltip:"Refresh form Data",handler:function(t,e,i){}},{type:"help",tooltip:"Get Help",callback:function(t,e,i){}}],maximizable:!0,maximized:!0,height:500,width:500}),Ext.define("Common.ux.window.PromptWindow",{extend:"Ext.window.Window",requires:["Ext.panel.Panel","Ext.form.FieldContainer","Ext.form.Label","Ext.form.field.TextArea","Ext.toolbar.Spacer","Ext.toolbar.Toolbar","Ext.toolbar.Fill","Ext.button.Button"],commentRequired:!1,withClose:!0,hotkey:"Enter",width:400,closeAction:"hide",title:"Prompt Window title",modal:!0,layout:{type:"vbox",align:"stretch",pack:"center"},initComponent:function(){var t=this;Ext.applyIf(t,{bodyCls:["x-window-body-default","x-box-layout-ct","x-closable","x-window-body-closable","x-window-body-default-closable","promptWindow"],items:[{xtype:"panel",border:!1,layout:{type:"vbox",align:"stretch",pack:"center"},items:[{xtype:"fieldcontainer",cls:"fieldSet",margin:"0 0 0 0",padding:"10 10 10 10",layout:{type:"vbox",align:"stretch",pack:"center"},items:[{xtype:"label",flex:1,itemId:"confirmMsg",margin:"5 10 10 10",text:"Confirm action?"},{xtype:"label",itemId:"description",margin:"10 10 10 10",text:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. "},{xtype:"textareafield",stopUpperCase:!0,itemId:"inputText",margin:"0 10 10 10",fieldLabel:"",enforceMaxLength:!0,maxLength:200,selectOnFocus:!0,stripCharsRe:/[\r\n]/},{xtype:"tbspacer",flex:1}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",itemId:"bottomToolbar",items:[{xtype:"tbfill",itemId:"filler"},{xtype:"container",items:[{xtype:"button",itemId:"save",text:"Save",listeners:{click:{fn:t.onButtonClick1,scope:t}}},{xtype:"button",itemId:"cancel",text:"Cancel",listeners:{click:{fn:t.onButtonClick,scope:t}}}]}]}]}],listeners:{afterrender:{fn:t.onWindowAfterRender,scope:t}}}),t.processPromptWindow(t),t.callParent(arguments)},processPromptWindow:function(t){},onButtonClick1:function(t,e,i){var a=this.down("textfield[itemId=inputText]");(!this.commentRequired||this.commentRequired&&0!=a.getValue().trim().length)&&(this.callbackFunction("ok",a.getValue()),this.withClose&&this.close())},onButtonClick:function(t,e,i){var a=this.down("textfield[itemId=inputText]");this.callbackFunction("no",a.getValue()),this.withClose&&this.close()},onWindowAfterRender:function(t,e){t.down("#inputText").focus(!1,200)},setConfirmMsg:function(t){var e=this.down("label[itemId=confirmMsg]");e.setText(t)},setDescription:function(t){var e=this.down("label[itemId=description]");e.setText(t)},setSaveText:function(t){var e=this.down("button[itemId=save]");e.setText(t)},setCancelText:function(t){var e=this.down("button[itemId=cancel]");e.setText(t)}});
Ext.define("Vtype.AdvancedVType",{override:"Ext.form.field.VTypes",phoneNumber:function(e,t){return this.phoneRe.test(value)},phoneRe:/^([1-9]|1[0-9]):([0-5][0-9])(\s[a|p]m)$/i,phoneText:'Not a valid time.  Must be in the format "12:34 PM".',phoneMask:/[\d\s:amp]/i,numSecu:function(e,t){return this.numSecuRe.test(e)},numSecuRe:/^([1-37-8])([0-9]{2})(0[0-9]|[2-35-9][0-9]|[14][0-2])((0[1-9]|[1-8][0-9]|9[0-69]|2[abAB])(00[1-9]|0[1-9][0-9]|[1-8][0-9]{2}|9[0-8][0-9]|990)|(9[78][0-9])(0[1-9]|[1-8][0-9]|90))(00[1-9]|0[1-9][0-9]|[1-9][0-9]{2})$/i,numSecuText:'Numéro de sécurité sociale invalide".',numSecuMask:/[0-9]|A|B/,cleSecu:function(e,t){return this.cleSecuRe.test(value)},cleSecuRe:/^([1-9]|1[0-9]):([0-5][0-9])(\s[a|p]m)$/i,cleSecuText:"invalidKey",cleSecuMask:/[\d\s:amp]/i,frenchZipCode:function(e,t){},filePath:function(e,t){return this.numSecuRe.test(e)},numSecuRe:/^([a-zA-Z]:)?(\/[a-zA-Z0-9_\/-~]+)+\/?$/i,numSecuText:translate("invalidSocialNumber"),password:function(e,t){if(t.initialPassField){var n=t.up("form").down("#"+t.initialPassField);return e==n.getValue()}return!0},passwordText:"Passwords do not match"});